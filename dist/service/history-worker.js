!function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return o(r?r:e)},f,f.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){t.exports={"default":e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":12}],2:[function(e,t,r){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":13}],3:[function(e,t,r){t.exports={"default":e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":14}],4:[function(e,t,r){t.exports={"default":e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":15}],5:[function(e,t,r){t.exports={"default":e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":16}],6:[function(e,t,r){t.exports={"default":e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":17}],7:[function(e,t,r){t.exports={"default":e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":18}],8:[function(e,t,r){"use strict";r["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r.__esModule=!0},{}],9:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/object/define-property")["default"];r["default"]=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),n(e,o.key,o)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r.__esModule=!0},{"babel-runtime/core-js/object/define-property":4}],10:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/object/define-property")["default"];r["default"]=function(e,t,r){return t in e?n(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},r.__esModule=!0},{"babel-runtime/core-js/object/define-property":4}],11:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/array/from")["default"];r["default"]=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return n(e)},r.__esModule=!0},{"babel-runtime/core-js/array/from":1}],12:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/$.core").Array.from},{"../../modules/$.core":24,"../../modules/es6.array.from":69,"../../modules/es6.string.iterator":74}],13:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$.core").Object.assign},{"../../modules/$.core":24,"../../modules/es6.object.assign":71}],14:[function(e,t,r){var n=e("../../modules/$");t.exports=function(e,t){return n.create(e,t)}},{"../../modules/$":47}],15:[function(e,t,r){var n=e("../../modules/$");t.exports=function(e,t,r){return n.setDesc(e,t,r)}},{"../../modules/$":47}],16:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),t.exports=e("../modules/$.core").Promise},{"../modules/$.core":24,"../modules/es6.object.to-string":72,"../modules/es6.promise":73,"../modules/es6.string.iterator":74,"../modules/web.dom.iterable":76}],17:[function(e,t,r){e("../../modules/es6.symbol"),t.exports=e("../../modules/$.core").Symbol},{"../../modules/$.core":24,"../../modules/es6.symbol":75}],18:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/$.wks")("iterator")},{"../../modules/$.wks":67,"../../modules/es6.string.iterator":74,"../../modules/web.dom.iterable":76}],19:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],20:[function(e,t,r){var n=e("./$.is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./$.is-object":39}],21:[function(e,t,r){var n=e("./$.to-object"),o=e("./$.es5-object"),i=e("./$.enum-keys");t.exports=Object.assign||function(e,t){for(var r=n(e,!0),s=arguments.length,a=1;s>a;)for(var u,c=o(arguments[a++]),f=i(c),l=f.length,d=0;l>d;)r[u=f[d++]]=c[u];return r}},{"./$.enum-keys":29,"./$.es5-object":30,"./$.to-object":64}],22:[function(e,t,r){var n=e("./$.cof"),o=e("./$.wks")("toStringTag"),i="Arguments"==n(function(){return arguments}());t.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=(t=Object(e))[o])?r:i?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},{"./$.cof":23,"./$.wks":67}],23:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],24:[function(e,t,r){var n=t.exports={};"number"==typeof __e&&(__e=n)},{}],25:[function(e,t,r){var n=e("./$.a-function");t.exports=function(e,t,r){if(n(e),~r&&void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},{"./$.a-function":19}],26:[function(e,t,r){function n(e,t){return function(){return e.apply(t,arguments)}}function o(e,t,r){var u,c,f,l,d=e&o.G,p=e&o.P,h=d?i:e&o.S?i[t]:(i[t]||{})[a],v=d?s:s[t]||(s[t]={});d&&(r=t);for(u in r)c=!(e&o.F)&&h&&u in h,c&&u in v||(f=c?h[u]:r[u],d&&"function"!=typeof h[u]?l=r[u]:e&o.B&&c?l=n(f,i):e&o.W&&h[u]==f?!function(e){l=function(t){return this instanceof e?new e(t):e(t)},l[a]=e[a]}(f):l=p&&"function"==typeof f?n(Function.call,f):f,v[u]=l,p&&((v[a]||(v[a]={}))[u]=f))}var i=e("./$.global"),s=e("./$.core"),a="prototype";o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,t.exports=o},{"./$.core":24,"./$.global":33}],27:[function(e,t,r){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],28:[function(e,t,r){var n=e("./$.is-object"),o=e("./$.global").document,i=n(o)&&n(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./$.global":33,"./$.is-object":39}],29:[function(e,t,r){var n=e("./$");t.exports=function(e){var t=n.getKeys(e),r=n.isEnum,o=n.getSymbols;if(o)for(var i,s=o(e),a=0;s.length>a;)r.call(e,i=s[a++])&&t.push(i);return t}},{"./$":47}],30:[function(e,t,r){var n=e("./$.cof"),o=Object;t.exports=0 in o("z")?o:function(e){return"String"==n(e)?e.split(""):o(e)}},{"./$.cof":23}],31:[function(e,t,r){var n=e("./$.ctx"),o=e("./$.iter-call"),i=e("./$.is-array-iter"),s=e("./$.an-object"),a=e("./$.to-length"),u=e("./core.get-iterator-method");t.exports=function(e,t,r,c){var f,l,d,p=u(e),h=n(r,c,t?2:1),v=0;if("function"!=typeof p)throw TypeError(e+" is not iterable!");if(i(p))for(f=a(e.length);f>v;v++)t?h(s(l=e[v])[0],l[1]):h(e[v]);else for(d=p.call(e);!(l=d.next()).done;)o(d,h,l.value,t)}},{"./$.an-object":20,"./$.ctx":25,"./$.is-array-iter":38,"./$.iter-call":41,"./$.to-length":63,"./core.get-iterator-method":68}],32:[function(e,t,r){function n(e){try{return s(e)}catch(t){return a.slice()}}var o={}.toString,i=e("./$.to-object"),s=e("./$").getNames,a="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.get=function(e){return a&&"[object Window]"==o.call(e)?n(e):s(i(e))}},{"./$":47,"./$.to-object":64}],33:[function(e,t,r){var n="undefined"!=typeof self&&self.Math==Math?self:Function("return this")();t.exports=n,"number"==typeof __g&&(__g=n)},{}],34:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],35:[function(e,t,r){var n=e("./$"),o=e("./$.property-desc");t.exports=e("./$.support-desc")?function(e,t,r){return n.setDesc(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},{"./$":47,"./$.property-desc":51,"./$.support-desc":59}],36:[function(e,t,r){t.exports=e("./$.global").document&&document.documentElement},{"./$.global":33}],37:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3]);case 5:return n?e(t[0],t[1],t[2],t[3],t[4]):e.call(r,t[0],t[1],t[2],t[3],t[4])}return e.apply(r,t)}},{}],38:[function(e,t,r){var n=e("./$.iterators"),o=e("./$.wks")("iterator");t.exports=function(e){return("Array"in n?n.Array:Array.prototype[o])===e}},{"./$.iterators":46,"./$.wks":67}],39:[function(e,t,r){t.exports=function(e){return null!==e&&("object"==typeof e||"function"==typeof e)}},{}],40:[function(e,t,r){t.exports="keys"in[]&&!("next"in[].keys())},{}],41:[function(e,t,r){function n(e){var t=e["return"];void 0!==t&&o(t.call(e))}var o=e("./$.an-object");t.exports=function(e,t,r,i){try{return i?t(o(r)[0],r[1]):t(r)}catch(s){throw n(e),s}}},{"./$.an-object":20}],42:[function(e,t,r){"use strict";var n=e("./$"),o={};e("./$.hide")(o,e("./$.wks")("iterator"),function(){return this}),t.exports=function(t,r,i){t.prototype=n.create(o,{next:e("./$.property-desc")(1,i)}),e("./$.tag")(t,r+" Iterator")}},{"./$":47,"./$.hide":35,"./$.property-desc":51,"./$.tag":60,"./$.wks":67}],43:[function(e,t,r){"use strict";function n(){return this}var o=e("./$.library"),i=e("./$.def"),s=e("./$.redef"),a=e("./$.hide"),u=e("./$.has"),c=e("./$.wks")("iterator"),f=e("./$.iterators"),l="@@iterator",d="keys",p="values";t.exports=function(t,r,h,v,y,_,m){function g(e){switch(e){case d:return function(){return new h(this,e)};case p:return function(){return new h(this,e)}}return function(){return new h(this,e)}}e("./$.iter-create")(h,r,v);var b,w,S=r+" Iterator",E=t.prototype,x=E[c]||E[l]||y&&E[y],T=x||g(y);if(x){var k=e("./$").getProto(T.call(new t));e("./$.tag")(k,S,!0),!o&&u(E,l)&&a(k,c,n)}if((!o||m)&&a(E,c,T),f[r]=T,f[S]=n,y)if(b={keys:_?T:g(d),values:y==p?T:g(p),entries:y!=p?T:g("entries")},m)for(w in b)w in E||s(E,w,b[w]);else i(i.P+i.F*e("./$.iter-buggy"),r,b)}},{"./$":47,"./$.def":26,"./$.has":34,"./$.hide":35,"./$.iter-buggy":40,"./$.iter-create":42,"./$.iterators":46,"./$.library":49,"./$.redef":52,"./$.tag":60,"./$.wks":67}],44:[function(e,t,r){var n=e("./$.wks")("iterator"),o=!1;try{var i=[7][n]();i["return"]=function(){o=!0},Array.from(i,function(){throw 2})}catch(s){}t.exports=function(e){if(!o)return!1;var t=!1;try{var r=[7],i=r[n]();i.next=function(){t=!0},r[n]=function(){return i},e(r)}catch(s){}return t}},{"./$.wks":67}],45:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],46:[function(e,t,r){t.exports={}},{}],47:[function(e,t,r){var n=Object;t.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},{}],48:[function(e,t,r){var n=e("./$"),o=e("./$.to-object");t.exports=function(e,t){for(var r,i=o(e),s=n.getKeys(i),a=s.length,u=0;a>u;)if(i[r=s[u++]]===t)return r}},{"./$":47,"./$.to-object":64}],49:[function(e,t,r){t.exports=!0},{}],50:[function(e,t,r){var n=e("./$.redef");t.exports=function(e,t){for(var r in t)n(e,r,t[r]);return e}},{"./$.redef":52}],51:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],52:[function(e,t,r){t.exports=e("./$.hide")},{"./$.hide":35}],53:[function(e,t,r){t.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},{}],54:[function(e,t,r){function n(e,t){if(s(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")}var o=e("./$").getDesc,i=e("./$.is-object"),s=e("./$.an-object");t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r){try{r=e("./$.ctx")(Function.call,o(Object.prototype,"__proto__").set,2),r({},[])}catch(i){t=!0}return function(e,o){return n(e,o),t?e.__proto__=o:r(e,o),e}}():void 0),check:n}},{"./$":47,"./$.an-object":20,"./$.ctx":25,"./$.is-object":39}],55:[function(e,t,r){var n=e("./$.global"),o="__core-js_shared__",i=n[o]||(n[o]={});t.exports=function(e){return i[e]||(i[e]={})}},{"./$.global":33}],56:[function(e,t,r){var n=e("./$"),o=e("./$.wks")("species");t.exports=function(t){!e("./$.support-desc")||o in t||n.setDesc(t,o,{configurable:!0,get:function(){return this}})}},{"./$":47,"./$.support-desc":59,"./$.wks":67}],57:[function(e,t,r){t.exports=function(e,t,r){if(!(e instanceof t))throw TypeError(r+": use the 'new' operator!");return e}},{}],58:[function(e,t,r){var n=e("./$.to-integer"),o=e("./$.defined");t.exports=function(e){return function(t,r){var i,s,a=String(o(t)),u=n(r),c=a.length;return 0>u||u>=c?e?"":void 0:(i=a.charCodeAt(u),55296>i||i>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):i:e?a.slice(u,u+2):(i-55296<<10)+(s-56320)+65536)}}},{"./$.defined":27,"./$.to-integer":62}],59:[function(e,t,r){t.exports=!!function(){try{return 2==Object.defineProperty({},"a",{get:function(){return 2}}).a}catch(e){}}()},{}],60:[function(e,t,r){var n=e("./$.has"),o=e("./$.hide"),i=e("./$.wks")("toStringTag");t.exports=function(e,t,r){e&&!n(e=r?e:e.prototype,i)&&o(e,i,t)}},{"./$.has":34,"./$.hide":35,"./$.wks":67}],61:[function(e,t,r){"use strict";function n(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}}function o(e){n.call(e.data)}var i,s,a,u=e("./$.ctx"),c=e("./$.invoke"),f=e("./$.html"),l=e("./$.dom-create"),d=e("./$.global"),p=d.process,h=d.setImmediate,v=d.clearImmediate,y=d.MessageChannel,_=0,m={},g="onreadystatechange";h&&v||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return m[++_]=function(){c("function"==typeof e?e:Function(e),t)},i(_),_},v=function(e){delete m[e]},"process"==e("./$.cof")(p)?i=function(e){p.nextTick(u(n,e,1))}:d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(i=function(e){d.postMessage(e,"*")},d.addEventListener("message",o,!1)):y?(s=new y,a=s.port2,s.port1.onmessage=o,i=u(a.postMessage,a,1)):i=g in l("script")?function(e){f.appendChild(l("script"))[g]=function(){f.removeChild(this),n.call(e)}}:function(e){setTimeout(u(n,e,1),0)}),t.exports={set:h,clear:v}},{"./$.cof":23,"./$.ctx":25,"./$.dom-create":28,"./$.global":33,"./$.html":36,"./$.invoke":37}],62:[function(e,t,r){var n=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},{}],63:[function(e,t,r){var n=e("./$.to-integer"),o=Math.min;t.exports=function(e){return e>0?o(n(e),9007199254740991):0}},{"./$.to-integer":62}],64:[function(e,t,r){var n=e("./$.es5-object"),o=e("./$.defined");t.exports=function(e,t){return(t?Object:n)(o(e))}},{"./$.defined":27,"./$.es5-object":30}],65:[function(e,t,r){var n=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},{}],66:[function(e,t,r){t.exports=function(){}},{}],67:[function(e,t,r){var n=e("./$.shared")("wks"),o=e("./$.global").Symbol;t.exports=function(t){return n[t]||(n[t]=o&&o[t]||(o||e("./$.uid"))("Symbol."+t))}},{"./$.global":33,"./$.shared":55,"./$.uid":65}],68:[function(e,t,r){var n=e("./$.global"),o=e("./$.classof"),i=e("./$.wks")("iterator"),s=e("./$.iterators");t.exports=e("./$.core").getIteratorMethod=function(e){var t=n.Symbol;return void 0!=e?e[t&&t.iterator||"@@iterator"]||e[i]||s[o(e)]:void 0}},{"./$.classof":22,"./$.core":24,"./$.global":33,"./$.iterators":46,"./$.wks":67}],69:[function(e,t,r){var n=e("./$.ctx"),o=e("./$.def"),i=e("./$.to-object"),s=e("./$.iter-call"),a=e("./$.is-array-iter"),u=e("./$.to-length"),c=e("./core.get-iterator-method");o(o.S+o.F*!e("./$.iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,o,f,l=i(e,!0),d="function"==typeof this?this:Array,p=arguments[1],h=void 0!==p,v=0,y=c(l);if(h&&(p=n(p,arguments[2],2)),void 0==y||d==Array&&a(y))for(r=new d(t=u(l.length));t>v;v++)r[v]=h?p(l[v],v):l[v];else for(f=y.call(l),r=new d;!(o=f.next()).done;v++)r[v]=h?s(f,p,[o.value,v],!0):o.value;return r.length=v,r}})},{"./$.ctx":25,"./$.def":26,"./$.is-array-iter":38,"./$.iter-call":41,"./$.iter-detect":44,"./$.to-length":63,"./$.to-object":64,"./core.get-iterator-method":68}],70:[function(e,t,r){var n=e("./$.unscope"),o=e("./$.iter-step"),i=e("./$.iterators"),s=e("./$.to-object");e("./$.iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,r):"values"==t?o(0,e[r]):o(0,[r,e[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},{"./$.iter-define":43,"./$.iter-step":45,"./$.iterators":46,"./$.to-object":64,"./$.unscope":66}],71:[function(e,t,r){var n=e("./$.def");n(n.S,"Object",{assign:e("./$.assign")})},{"./$.assign":21,"./$.def":26}],72:[function(e,t,r){},{}],73:[function(e,t,r){"use strict";function n(e){var t=new R(function(){});return e&&(t.constructor=Object),R.resolve(t)===t}function o(e){return g(e)&&(L?"Promise"==_(e):I in e)}function i(e,t){return h&&e===R&&t===d?!0:T(e,t)}function s(e){var t=b(e)[O];return void 0!=t?t:e}function a(e){var t;return g(e)&&"function"==typeof(t=e.then)?t:!1}function u(e,t){if(!e.n){e.n=!0;var r=e.c;q.call(v,function(){function n(t){var r,n,s=i?t.ok:t.fail;try{s?(i||(e.h=!0),r=s===!0?o:s(o),r===t.P?t.rej(TypeError("Promise-chain cycle")):(n=a(r))?n.call(r,t.res,t.rej):t.res(r)):t.rej(o)}catch(u){t.rej(u)}}for(var o=e.v,i=1==e.s,s=0;r.length>s;)n(r[s++]);r.length=0,e.n=!1,t&&setTimeout(function(){q.call(v,function(){c(e.p)&&(D?j.emit("unhandledRejection",o,e.p):v.console&&console.error&&console.error("Unhandled promise rejection",o)),e.a=void 0})},1)})}}function c(e){var t,r=e[I],n=r.a||r.c,o=0;if(r.h)return!1;for(;n.length>o;)if(t=n[o++],t.fail||!c(t.P))return!1;return!0}function f(e){var t=this;t.d||(t.d=!0,t=t.r||t,t.v=e,t.s=2,t.a=t.c.slice(),u(t,!0))}function l(e){var t,r=this;if(!r.d){r.d=!0,r=r.r||r;try{(t=a(e))?q.call(v,function(){var n={r:r,d:!1};try{t.call(e,y(l,n,1),y(f,n,1))}catch(o){f.call(n,o)}}):(r.v=e,r.s=1,u(r,!1))}catch(n){f.call({r:r,d:!1},n)}}}var d,p=e("./$"),h=e("./$.library"),v=e("./$.global"),y=e("./$.ctx"),_=e("./$.classof"),m=e("./$.def"),g=e("./$.is-object"),b=e("./$.an-object"),w=e("./$.a-function"),S=e("./$.strict-new"),E=e("./$.for-of"),x=e("./$.set-proto").set,T=e("./$.same"),k=e("./$.species"),O=e("./$.wks")("species"),I=e("./$.uid")("record"),A="Promise",j=v.process,D="process"==_(j),q=j&&j.nextTick||e("./$.task").set,R=v[A],L=function(){function t(e){var r=new R(e);return x(r,t.prototype),r}var r=!1;try{if(r=R&&R.resolve&&n(),x(t,R),t.prototype=p.create(R.prototype,{constructor:{value:t}}),t.resolve(5).then(function(){})instanceof t||(r=!1),r&&e("./$.support-desc")){var o=!1;R.resolve(p.setDesc({},"then",{get:function(){o=!0}})),r=o}}catch(i){r=!1}return r}();L||(R=function(e){w(e);var t={p:S(this,R,A),c:[],a:void 0,s:0,d:!1,v:void 0,h:!1,n:!1};this[I]=t;try{e(y(l,t,1),y(f,t,1))}catch(r){f.call(t,r)}},e("./$.mix")(R.prototype,{then:function(e,t){var r=b(b(this).constructor)[O],n={ok:"function"==typeof e?e:!0,fail:"function"==typeof t?t:!1},o=n.P=new(void 0!=r?r:R)(function(e,t){n.res=w(e),n.rej=w(t)}),i=this[I];return i.c.push(n),i.a&&i.a.push(n),i.s&&u(i,!1),o},"catch":function(e){return this.then(void 0,e)}})),m(m.G+m.W+m.F*!L,{Promise:R}),e("./$.tag")(R,A),k(R),k(d=e("./$.core")[A]),m(m.S+m.F*!L,A,{reject:function(e){return new this(function(t,r){r(e)})}}),m(m.S+m.F*(!L||n(!0)),A,{resolve:function(e){return o(e)&&i(e.constructor,this)?e:new this(function(t){t(e)})}}),m(m.S+m.F*!(L&&e("./$.iter-detect")(function(e){R.all(e)["catch"](function(){})})),A,{all:function(e){var t=s(this),r=[];return new t(function(n,o){E(e,!1,r.push,r);var i=r.length,s=Array(i);i?p.each.call(r,function(e,r){t.resolve(e).then(function(e){s[r]=e,--i||n(s)},o)}):n(s)})},race:function(e){var t=s(this);return new t(function(r,n){E(e,!1,function(e){t.resolve(e).then(r,n)})})}})},{"./$":47,"./$.a-function":19,"./$.an-object":20,"./$.classof":22,"./$.core":24,"./$.ctx":25,"./$.def":26,"./$.for-of":31,"./$.global":33,"./$.is-object":39,"./$.iter-detect":44,"./$.library":49,"./$.mix":50,"./$.same":53,"./$.set-proto":54,"./$.species":56,"./$.strict-new":57,"./$.support-desc":59,"./$.tag":60,"./$.task":61,"./$.uid":65,"./$.wks":67}],74:[function(e,t,r){var n=e("./$.string-at")(!0);e("./$.iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./$.iter-define":43,"./$.string-at":58}],75:[function(e,t,r){"use strict";function n(e){var t=N[e]=A(D.prototype);return t._k=e,h&&q&&B(M,e,{configurable:!0,set:function(t){p(this,R)&&p(this[R],e)&&(this[R][e]=!1),B(this,e,k(1,t))}}),t}function o(e,t,r){return r&&p(N,t)?(r.enumerable?(p(e,R)&&e[R][t]&&(e[R][t]=!1),r=A(r,{enumerable:k(0,!1)})):(p(e,R)||I(e,R,k(1,{})),e[R][t]=!0),B(e,t,r)):I(e,t,r)}function i(e,t){x(e);for(var r,n=E(t=T(t)),i=0,s=n.length;s>i;)o(e,r=n[i++],t[r]);return e}function s(e,t){return void 0===t?A(e):i(A(e),t)}function a(e){var t=L.call(this,e);return t||!p(this,e)||!p(N,e)||p(this,R)&&this[R][e]?t:!0}function u(e,t){var r=O(e=T(e),t);return!r||!p(N,t)||p(e,R)&&e[R][t]||(r.enumerable=!0),r}function c(e){for(var t,r=j(T(e)),n=[],o=0;r.length>o;)p(N,t=r[o++])||t==R||n.push(t);return n}function f(e){for(var t,r=j(T(e)),n=[],o=0;r.length>o;)p(N,t=r[o++])&&n.push(N[t]);return n}var l=e("./$"),d=e("./$.global"),p=e("./$.has"),h=e("./$.support-desc"),v=e("./$.def"),y=e("./$.redef"),_=e("./$.shared"),m=e("./$.tag"),g=e("./$.uid"),b=e("./$.wks"),w=e("./$.keyof"),S=e("./$.get-names"),E=e("./$.enum-keys"),x=e("./$.an-object"),T=e("./$.to-object"),k=e("./$.property-desc"),O=l.getDesc,I=l.setDesc,A=l.create,j=S.get,D=d.Symbol,q=!1,R=b("_hidden"),L=l.isEnum,C=_("symbol-registry"),N=_("symbols"),$="function"==typeof D,M=Object.prototype,B=h?function(){try{return A(I({},R,{get:function(){return I(this,R,{value:!1})[R]}}))[R]||I}catch(e){return function(e,t,r){var n=O(M,t);n&&delete M[t],I(e,t,r),n&&e!==M&&I(M,t,n)}}}():I;$||(D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor");return n(g(arguments[0]))},y(D.prototype,"toString",function(){return this._k}),l.create=s,l.isEnum=a,l.getDesc=u,l.setDesc=o,l.setDescs=i,l.getNames=S.get=c,l.getSymbols=f,h&&!e("./$.library")&&y(M,"propertyIsEnumerable",a,!0));var P={"for":function(e){return p(C,e+="")?C[e]:C[e]=D(e)},keyFor:function(e){return w(C,e)},useSetter:function(){q=!0},useSimple:function(){q=!1}};l.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(e){var t=b(e);P[e]=$?t:n(t)}),q=!0,v(v.G+v.W,{Symbol:D}),v(v.S,"Symbol",P),v(v.S+v.F*!$,"Object",{create:s,defineProperty:o,defineProperties:i,getOwnPropertyDescriptor:u,getOwnPropertyNames:c,getOwnPropertySymbols:f}),m(D,"Symbol"),m(Math,"Math",!0),m(d.JSON,"JSON",!0)},{"./$":47,"./$.an-object":20,"./$.def":26,"./$.enum-keys":29,"./$.get-names":32,"./$.global":33,"./$.has":34,"./$.keyof":48,"./$.library":49,"./$.property-desc":51,"./$.redef":52,"./$.shared":55,"./$.support-desc":59,"./$.tag":60,"./$.to-object":64,"./$.uid":65,"./$.wks":67}],76:[function(e,t,r){e("./es6.array.iterator");var n=e("./$.iterators");n.NodeList=n.HTMLCollection=n.Array},{"./$.iterators":46,"./es6.array.iterator":70}],77:[function(e,t,r){(function(r){var n="object"==typeof r?r:"object"==typeof window?window:"object"==typeof self?self:this,o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;n.regeneratorRuntime=void 0,t.exports=e("./runtime"),o?n.regeneratorRuntime=i:delete n.regeneratorRuntime,t.exports={"default":t.exports,__esModule:!0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./runtime":78}],78:[function(e,t,r){(function(r,n){"use strict";var o=e("babel-runtime/core-js/symbol")["default"],i=e("babel-runtime/core-js/symbol/iterator")["default"],s=e("babel-runtime/core-js/object/create")["default"],a=e("babel-runtime/core-js/promise")["default"];!function(e){function n(e,t,r,n){var o=s((t||c).prototype);return o._invoke=v(e,r||null,new m(n||[])),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}function c(){}function f(){}function l(){}function d(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function p(e){this.arg=e}function h(e){function t(t,r){var n=e[t](r),o=n.value;return o instanceof p?a.resolve(o.arg).then(i,s):a.resolve(o).then(function(e){return n.value=e,n})}function n(e,r){var n=o?o.then(function(){return t(e,r)}):new a(function(n){n(t(e,r))});return o=n["catch"](function(e){}),n}"object"==typeof r&&r.domain&&(t=r.domain.bind(t));{var o,i=t.bind(e,"next"),s=t.bind(e,"throw");t.bind(e,"return")}this._invoke=n}function v(e,t,r){var n=k;return function(o,i){if(n===I)throw new Error("Generator is already running");if(n===A){if("throw"===o)throw i;return b()}for(;;){var s=r.delegate;if(s){if("return"===o||"throw"===o&&s.iterator[o]===w){r.delegate=null;var a=s.iterator["return"];if(a){var c=u(a,s.iterator,i);if("throw"===c.type){o="throw",i=c.arg;continue}}if("return"===o)continue}var c=u(s.iterator[o],s.iterator,i);if("throw"===c.type){r.delegate=null,o="throw",i=c.arg;continue}o="next",i=w;var f=c.arg;if(!f.done)return n=O,f;r[s.resultName]=f.value,r.next=s.nextLoc,r.delegate=null}if("next"===o)r.sent=n===O?i:w;else if("throw"===o){if(n===k)throw n=A,i;r.dispatchException(i)&&(o="next",i=w)}else"return"===o&&r.abrupt("return",i);n=I;var c=u(e,t,r);if("normal"===c.type){n=r.done?A:O;var f={value:c.arg,done:r.done};if(c.arg!==j)return f;r.delegate&&"next"===o&&(i=w)}else"throw"===c.type&&(n=A,o="throw",i=c.arg)}}}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function g(e){if(e){var t=e[E];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function o(){for(;++r<e.length;)if(S.call(e,r))return o.value=e[r],o.done=!1,o;return o.value=w,o.done=!0,o};return n.next=n}}return{next:b}}function b(){return{value:w,done:!0}}var w,S=Object.prototype.hasOwnProperty,E="function"==typeof o&&i||"@@iterator",x="object"==typeof t,T=e.regeneratorRuntime;if(T)return void(x&&(t.exports=T));T=e.regeneratorRuntime=x?t.exports:{},T.wrap=n;var k="suspendedStart",O="suspendedYield",I="executing",A="completed",j={},D=l.prototype=c.prototype;f.prototype=D.constructor=l,l.constructor=f,f.displayName="GeneratorFunction",T.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===f||"GeneratorFunction"===(t.displayName||t.name):!1},T.mark=function(e){return e.__proto__=l,e.prototype=s(D),e},T.awrap=function(e){return new p(e)},d(h.prototype),T.async=function(e,t,r,o){var i=new h(n(e,t,r,o));return T.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},d(D),D[E]=function(){return this},D.toString=function(){return"[object Generator]"},T.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},T.values=g,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=w,this.done=!1,this.delegate=null,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&S.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=w)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return i.type="throw",i.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=S.call(o,"catchLoc"),a=S.call(o,"finallyLoc");if(s&&a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&S.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?this.next=o.finallyLoc:this.complete(i),j},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),j}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:g(e),resultName:t,nextLoc:r},j}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:void 0)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:81,"babel-runtime/core-js/object/create":3,"babel-runtime/core-js/promise":5,"babel-runtime/core-js/symbol":6,"babel-runtime/core-js/symbol/iterator":7}],79:[function(e,t,r){arguments[4][72][0].apply(r,arguments)},{dup:72}],80:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],a(r))return!1;if(o(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,i=new Array(n-1),u=1;n>u;u++)i[u-1]=arguments[u];r.apply(this,i)}else if(s(r)){for(n=arguments.length,i=new Array(n-1),u=1;n>u;u++)i[u-1]=arguments[u];for(c=r.slice(),n=c.length,u=0;n>u;u++)c[u].apply(this,i)}return!0},n.prototype.addListener=function(e,t){var r;if(!o(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var r;r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace());

}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,i,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],i=r.length,n=-1,r===t||o(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(a=i;a-->0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(0>n)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],o(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?o(e._events[t])?1:e._events[t].length:0}},{}],81:[function(e,t,r){function n(){f=!1,a.length?c=a.concat(c):l=-1,c.length&&o()}function o(){if(!f){var e=setTimeout(n);f=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a[l].run();l=-1,t=c.length}a=null,f=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var a,u=t.exports={},c=[],f=!1,l=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new i(e,t)),1!==c.length||f||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],82:[function(e,t,r){!function(e,n){"object"==typeof r&&"undefined"!=typeof t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.Immutable=n()}(this,function(){"use strict";function e(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function t(e){return e.value=!1,e}function r(e){e&&(e.value=!0)}function n(){}function o(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),o=0;r>o;o++)n[o]=e[o+t];return n}function i(e){return void 0===e.size&&(e.size=e.__iterate(a)),e.size}function s(e,t){return t>=0?+t:i(e)+ +t}function a(){return!0}function u(e,t,r){return(0===e||void 0!==r&&-r>=e)&&(void 0===t||void 0!==r&&t>=r)}function c(e,t){return l(e,t,0)}function f(e,t){return l(e,t,t)}function l(e,t,r){return void 0===e?r:0>e?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}function d(e){return y(e)?e:A(e)}function p(e){return _(e)?e:j(e)}function h(e){return m(e)?e:D(e)}function v(e){return y(e)&&!g(e)?e:q(e)}function y(e){return!(!e||!e[hr])}function _(e){return!(!e||!e[vr])}function m(e){return!(!e||!e[yr])}function g(e){return _(e)||m(e)}function b(e){return!(!e||!e[_r])}function w(e){this.next=e}function S(e,t,r,n){var o=0===e?t:1===e?r:[t,r];return n?n.value=o:n={value:o,done:!1},n}function E(){return{value:void 0,done:!0}}function x(e){return!!O(e)}function T(e){return e&&"function"==typeof e.next}function k(e){var t=O(e);return t&&t.call(e)}function O(e){var t=e&&(wr&&e[wr]||e[Sr]);return"function"==typeof t?t:void 0}function I(e){return e&&"number"==typeof e.length}function A(e){return null===e||void 0===e?M():y(e)?e.toSeq():z(e)}function j(e){return null===e||void 0===e?M().toKeyedSeq():y(e)?_(e)?e.toSeq():e.fromEntrySeq():B(e)}function D(e){return null===e||void 0===e?M():y(e)?_(e)?e.entrySeq():e.toIndexedSeq():P(e)}function q(e){return(null===e||void 0===e?M():y(e)?_(e)?e.entrySeq():e:P(e)).toSetSeq()}function R(e){this._array=e,this.size=e.length}function L(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function C(e){this._iterable=e,this.size=e.length||e.size}function N(e){this._iterator=e,this._iteratorCache=[]}function $(e){return!(!e||!e[xr])}function M(){return Tr||(Tr=new R([]))}function B(e){var t=Array.isArray(e)?new R(e).fromEntrySeq():T(e)?new N(e).fromEntrySeq():x(e)?new C(e).fromEntrySeq():"object"==typeof e?new L(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function P(e){var t=F(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function z(e){var t=F(e)||"object"==typeof e&&new L(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function F(e){return I(e)?new R(e):T(e)?new N(e):x(e)?new C(e):void 0}function U(e,t,r,n){var o=e._cache;if(o){for(var i=o.length-1,s=0;i>=s;s++){var a=o[r?i-s:s];if(t(a[1],n?a[0]:s,e)===!1)return s+1}return s}return e.__iterateUncached(t,r)}function K(e,t,r,n){var o=e._cache;if(o){var i=o.length-1,s=0;return new w(function(){var e=o[r?i-s:s];return s++>i?E():S(t,n?e[0]:s-1,e[1])})}return e.__iteratorUncached(t,r)}function J(){throw TypeError("Abstract")}function W(){}function H(){}function V(){}function G(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return"function"==typeof e.equals&&"function"==typeof t.equals&&e.equals(t)?!0:!1}function Q(e,t){return t?X(t,e,"",{"":e}):Y(e)}function X(e,t,r,n){return Array.isArray(t)?e.call(n,r,D(t).map(function(r,n){return X(e,r,n,t)})):Z(t)?e.call(n,r,j(t).map(function(r,n){return X(e,r,n,t)})):t}function Y(e){return Array.isArray(e)?D(e).map(Y).toList():Z(e)?j(e).map(Y).toMap():e}function Z(e){return e&&(e.constructor===Object||void 0===e.constructor)}function ee(e){return e>>>1&1073741824|3221225471&e}function te(e){if(e===!1||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(e=e.valueOf(),e===!1||null===e||void 0===e))return 0;if(e===!0)return 1;var t=typeof e;if("number"===t){var r=0|e;for(r!==e&&(r^=4294967295*e);e>4294967295;)e/=4294967295,r^=e;return ee(r)}return"string"===t?e.length>Rr?re(e):ne(e):"function"==typeof e.hashCode?e.hashCode():oe(e)}function re(e){var t=Nr[e];return void 0===t&&(t=ne(e),Cr===Lr&&(Cr=0,Nr={}),Cr++,Nr[e]=t),t}function ne(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return ee(t)}function oe(e){var t;if(jr&&(t=kr.get(e),void 0!==t))return t;if(t=e[qr],void 0!==t)return t;if(!Ar){if(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[qr],void 0!==t)return t;if(t=ie(e),void 0!==t)return t}if(t=++Dr,1073741824&Dr&&(Dr=0),jr)kr.set(e,t);else{if(void 0!==Ir&&Ir(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(Ar)Object.defineProperty(e,qr,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[qr]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[qr]=t}}return t}function ie(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function se(e,t){if(!e)throw new Error(t)}function ae(e){se(e!==1/0,"Cannot perform this action with an infinite size.")}function ue(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function ce(e){this._iter=e,this.size=e.size}function fe(e){this._iter=e,this.size=e.size}function le(e){this._iter=e,this.size=e.size}function de(e){var t=Re(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.contains(t)},t.contains=function(t){return e.has(t)},t.cacheResult=Le,t.__iterateUncached=function(t,r){var n=this;return e.__iterate(function(e,r){return t(r,e,n)!==!1},r)},t.__iteratorUncached=function(t,r){if(t===br){var n=e.__iterator(t,r);return new w(function(){var e=n.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===gr?mr:gr,r)},t}function pe(e,t,r){var n=Re(e);return n.size=e.size,n.has=function(t){return e.has(t)},n.get=function(n,o){var i=e.get(n,lr);return i===lr?o:t.call(r,i,n,e)},n.__iterateUncached=function(n,o){var i=this;return e.__iterate(function(e,o,s){return n(t.call(r,e,o,s),o,i)!==!1},o)},n.__iteratorUncached=function(n,o){var i=e.__iterator(br,o);return new w(function(){var o=i.next();if(o.done)return o;var s=o.value,a=s[0];return S(n,a,t.call(r,s[1],a,e),o)})},n}function he(e,t){var r=Re(e);return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var t=de(e);return t.reverse=function(){return e.flip()},t}),r.get=function(r,n){return e.get(t?r:-1-r,n)},r.has=function(r){return e.has(t?r:-1-r)},r.contains=function(t){return e.contains(t)},r.cacheResult=Le,r.__iterate=function(t,r){var n=this;return e.__iterate(function(e,r){return t(e,r,n)},!r)},r.__iterator=function(t,r){return e.__iterator(t,!r)},r}function ve(e,t,r,n){var o=Re(e);return n&&(o.has=function(n){var o=e.get(n,lr);return o!==lr&&!!t.call(r,o,n,e)},o.get=function(n,o){var i=e.get(n,lr);return i!==lr&&t.call(r,i,n,e)?i:o}),o.__iterateUncached=function(o,i){var s=this,a=0;return e.__iterate(function(e,i,u){return t.call(r,e,i,u)?(a++,o(e,n?i:a-1,s)):void 0},i),a},o.__iteratorUncached=function(o,i){var s=e.__iterator(br,i),a=0;return new w(function(){for(;;){var i=s.next();if(i.done)return i;var u=i.value,c=u[0],f=u[1];if(t.call(r,f,c,e))return S(o,n?c:a++,f,i)}})},o}function ye(e,t,r){var n=$e().asMutable();return e.__iterate(function(o,i){n.update(t.call(r,o,i,e),0,function(e){return e+1})}),n.asImmutable()}function _e(e,t,r){var n=_(e),o=(b(e)?Et():$e()).asMutable();e.__iterate(function(i,s){o.update(t.call(r,i,s,e),function(e){return e=e||[],e.push(n?[s,i]:i),e})});var i=qe(e);return o.map(function(t){return Ae(e,i(t))})}function me(e,t,r,n){var o=e.size;if(u(t,r,o))return e;var i=c(t,o),a=f(r,o);if(i!==i||a!==a)return me(e.toSeq().cacheResult(),t,r,n);var l=a-i;0>l&&(l=0);var d=Re(e);return d.size=0===l?l:e.size&&l||void 0,!n&&$(e)&&l>=0&&(d.get=function(t,r){return t=s(this,t),t>=0&&l>t?e.get(t+i,r):r}),d.__iterateUncached=function(t,r){var o=this;if(0===l)return 0;if(r)return this.cacheResult().__iterate(t,r);var s=0,a=!0,u=0;return e.__iterate(function(e,r){return a&&(a=s++<i)?void 0:(u++,t(e,n?r:u-1,o)!==!1&&u!==l)}),u},d.__iteratorUncached=function(t,r){if(l&&r)return this.cacheResult().__iterator(t,r);var o=l&&e.__iterator(t,r),s=0,a=0;return new w(function(){for(;s++<i;)o.next();if(++a>l)return E();var e=o.next();return n||t===gr?e:t===mr?S(t,a-1,void 0,e):S(t,a-1,e.value[1],e)})},d}function ge(e,t,r){var n=Re(e);return n.__iterateUncached=function(n,o){var i=this;if(o)return this.cacheResult().__iterate(n,o);var s=0;return e.__iterate(function(e,o,a){return t.call(r,e,o,a)&&++s&&n(e,o,i)}),s},n.__iteratorUncached=function(n,o){var i=this;if(o)return this.cacheResult().__iterator(n,o);var s=e.__iterator(br,o),a=!0;return new w(function(){if(!a)return E();var e=s.next();if(e.done)return e;var o=e.value,u=o[0],c=o[1];return t.call(r,c,u,i)?n===br?e:S(n,u,c,e):(a=!1,E())})},n}function be(e,t,r,n){var o=Re(e);return o.__iterateUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterate(o,i);var a=!0,u=0;return e.__iterate(function(e,i,c){return a&&(a=t.call(r,e,i,c))?void 0:(u++,o(e,n?i:u-1,s))}),u},o.__iteratorUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterator(o,i);var a=e.__iterator(br,i),u=!0,c=0;return new w(function(){var e,i,f;do{if(e=a.next(),e.done)return n||o===gr?e:o===mr?S(o,c++,void 0,e):S(o,c++,e.value[1],e);var l=e.value;i=l[0],f=l[1],u&&(u=t.call(r,f,i,s))}while(u);return o===br?e:S(o,i,f,e)})},o}function we(e,t){var r=_(e),n=[e].concat(t).map(function(e){return y(e)?r&&(e=p(e)):e=r?B(e):P(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===n.length)return e;if(1===n.length){var o=n[0];if(o===e||r&&_(o)||m(e)&&m(o))return o}var i=new R(n);return r?i=i.toKeyedSeq():m(e)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=n.reduce(function(e,t){if(void 0!==e){var r=t.size;if(void 0!==r)return e+r}},0),i}function Se(e,t,r){var n=Re(e);return n.__iterateUncached=function(n,o){function i(e,u){var c=this;e.__iterate(function(e,o){return(!t||t>u)&&y(e)?i(e,u+1):n(e,r?o:s++,c)===!1&&(a=!0),!a},o)}var s=0,a=!1;return i(e,0),s},n.__iteratorUncached=function(n,o){var i=e.__iterator(n,o),s=[],a=0;return new w(function(){for(;i;){var e=i.next();if(e.done===!1){var u=e.value;if(n===br&&(u=u[1]),t&&!(s.length<t)||!y(u))return r?e:S(n,a++,u,e);s.push(i),i=u.__iterator(n,o)}else i=s.pop()}return E()})},n}function Ee(e,t,r){var n=qe(e);return e.toSeq().map(function(o,i){return n(t.call(r,o,i,e))}).flatten(!0)}function xe(e,t){var r=Re(e);return r.size=e.size&&2*e.size-1,r.__iterateUncached=function(r,n){var o=this,i=0;return e.__iterate(function(e,n){return(!i||r(t,i++,o)!==!1)&&r(e,i++,o)!==!1},n),i},r.__iteratorUncached=function(r,n){var o,i=e.__iterator(gr,n),s=0;return new w(function(){return(!o||s%2)&&(o=i.next(),o.done)?o:s%2?S(r,s++,t):S(r,s++,o.value,o)})},r}function Te(e,t,r){t||(t=Ce);var n=_(e),o=0,i=e.toSeq().map(function(t,n){return[n,t,o++,r?r(t,n,e):t]}).toArray();return i.sort(function(e,r){return t(e[3],r[3])||e[2]-r[2]}).forEach(n?function(e,t){i[t].length=2}:function(e,t){i[t]=e[1]}),n?j(i):m(e)?D(i):q(i)}function ke(e,t,r){if(t||(t=Ce),r){var n=e.toSeq().map(function(t,n){return[t,r(t,n,e)]}).reduce(function(e,r){return Oe(t,e[1],r[1])?r:e});return n&&n[0]}return e.reduce(function(e,r){return Oe(t,e,r)?r:e})}function Oe(e,t,r){var n=e(r,t);return 0===n&&r!==t&&(void 0===r||null===r||r!==r)||n>0}function Ie(e,t,r){var n=Re(e);return n.size=new R(r).map(function(e){return e.size}).min(),n.__iterate=function(e,t){for(var r,n=this.__iterator(gr,t),o=0;!(r=n.next()).done&&e(r.value,o++,this)!==!1;);return o},n.__iteratorUncached=function(e,n){var o=r.map(function(e){return e=d(e),k(n?e.reverse():e)}),i=0,s=!1;return new w(function(){var r;return s||(r=o.map(function(e){return e.next()}),s=r.some(function(e){return e.done})),s?E():S(e,i++,t.apply(null,r.map(function(e){return e.value})))})},n}function Ae(e,t){return $(e)?t:e.constructor(t)}function je(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function De(e){return ae(e.size),i(e)}function qe(e){return _(e)?p:m(e)?h:v}function Re(e){return Object.create((_(e)?j:m(e)?D:q).prototype)}function Le(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):A.prototype.cacheResult.call(this)}function Ce(e,t){return e>t?1:t>e?-1:0}function Ne(e){var t=k(e);if(!t){if(!I(e))throw new TypeError("Expected iterable or array-like: "+e);t=k(d(e))}return t}function $e(e){return null===e||void 0===e?Ve():Me(e)?e:Ve().withMutations(function(t){var r=p(e);ae(r.size),r.forEach(function(e,r){return t.set(r,e)})})}function Me(e){return!(!e||!e[$r])}function Be(e,t){this.ownerID=e,this.entries=t}function Pe(e,t,r){this.ownerID=e,this.bitmap=t,this.nodes=r}function ze(e,t,r){this.ownerID=e,this.count=t,this.nodes=r}function Fe(e,t,r){this.ownerID=e,this.keyHash=t,this.entries=r}function Ue(e,t,r){this.ownerID=e,this.keyHash=t,this.entry=r}function Ke(e,t,r){this._type=t,this._reverse=r,this._stack=e._root&&We(e._root)}function Je(e,t){return S(e,t[0],t[1])}function We(e,t){return{node:e,index:0,__prev:t}}function He(e,t,r,n){var o=Object.create(Mr);return o.size=e,o._root=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}function Ve(){return Br||(Br=He(0))}function Ge(e,r,n){var o,i;if(e._root){var s=t(dr),a=t(pr);if(o=Qe(e._root,e.__ownerID,0,void 0,r,n,s,a),!a.value)return e;i=e.size+(s.value?n===lr?-1:1:0)}else{if(n===lr)return e;i=1,o=new Be(e.__ownerID,[[r,n]])}return e.__ownerID?(e.size=i,e._root=o,e.__hash=void 0,e.__altered=!0,e):o?He(i,o):Ve()}function Qe(e,t,n,o,i,s,a,u){return e?e.update(t,n,o,i,s,a,u):s===lr?e:(r(u),r(a),new Ue(t,o,[i,s]))}function Xe(e){return e.constructor===Ue||e.constructor===Fe}function Ye(e,t,r,n,o){if(e.keyHash===n)return new Fe(t,n,[e.entry,o]);var i,s=(0===r?e.keyHash:e.keyHash>>>r)&fr,a=(0===r?n:n>>>r)&fr,u=s===a?[Ye(e,t,r+ur,n,o)]:(i=new Ue(t,n,o),a>s?[e,i]:[i,e]);return new Pe(t,1<<s|1<<a,u)}function Ze(e,t,r,o){e||(e=new n);for(var i=new Ue(e,te(r),[r,o]),s=0;s<t.length;s++){var a=t[s];i=i.update(e,0,void 0,a[0],a[1])}return i}function et(e,t,r,n){for(var o=0,i=0,s=new Array(r),a=0,u=1,c=t.length;c>a;a++,u<<=1){var f=t[a];void 0!==f&&a!==n&&(o|=u,s[i++]=f)}return new Pe(e,o,s)}function tt(e,t,r,n,o){for(var i=0,s=new Array(cr),a=0;0!==r;a++,r>>>=1)s[a]=1&r?t[i++]:void 0;return s[n]=o,new ze(e,i+1,s)}function rt(e,t,r){for(var n=[],o=0;o<r.length;o++){var i=r[o],s=p(i);y(i)||(s=s.map(function(e){return Q(e)})),n.push(s)}return ot(e,t,n)}function nt(e){return function(t,r,n){return t&&t.mergeDeepWith&&y(r)?t.mergeDeepWith(e,r):e?e(t,r,n):r}}function ot(e,t,r){return r=r.filter(function(e){return 0!==e.size}),0===r.length?e:0!==e.size||e.__ownerID||1!==r.length?e.withMutations(function(e){for(var n=t?function(r,n){e.update(n,lr,function(e){return e===lr?r:t(e,r,n)})}:function(t,r){e.set(r,t)},o=0;o<r.length;o++)r[o].forEach(n)}):e.constructor(r[0])}function it(e,t,r,n){var o=e===lr,i=t.next();if(i.done){var s=o?r:e,a=n(s);return a===s?e:a}se(o||e&&e.set,"invalid keyPath");var u=i.value,c=o?lr:e.get(u,lr),f=it(c,t,r,n);return f===c?e:f===lr?e.remove(u):(o?Ve():e).set(u,f)}function st(e){return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,127&e}function at(e,t,r,n){var i=n?e:o(e);return i[t]=r,i}function ut(e,t,r,n){var o=e.length+1;if(n&&t+1===o)return e[t]=r,e;for(var i=new Array(o),s=0,a=0;o>a;a++)a===t?(i[a]=r,s=-1):i[a]=e[a+s];return i}function ct(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var o=new Array(n),i=0,s=0;n>s;s++)s===t&&(i=1),o[s]=e[s+i];return o}function ft(e){var t=vt();if(null===e||void 0===e)return t;if(lt(e))return e;var r=h(e),n=r.size;return 0===n?t:(ae(n),n>0&&cr>n?ht(0,n,ur,null,new dt(r.toArray())):t.withMutations(function(e){e.setSize(n),r.forEach(function(t,r){return e.set(r,t)})}))}function lt(e){return!(!e||!e[Ur])}function dt(e,t){this.array=e,this.ownerID=t}function pt(e,t){function r(e,t,r){return 0===t?n(e,r):o(e,t,r)}function n(e,r){var n=r===a?u&&u.array:e&&e.array,o=r>i?0:i-r,c=s-r;return c>cr&&(c=cr),function(){if(o===c)return Wr;var e=t?--c:o++;return n&&n[e]}}function o(e,n,o){var a,u=e&&e.array,c=o>i?0:i-o>>n,f=(s-o>>n)+1;return f>cr&&(f=cr),function(){for(;;){if(a){var e=a();if(e!==Wr)return e;a=null}if(c===f)return Wr;var i=t?--f:c++;a=r(u&&u[i],n-ur,o+(i<<n))}}}var i=e._origin,s=e._capacity,a=St(s),u=e._tail;return r(e._root,e._level,0)}function ht(e,t,r,n,o,i,s){var a=Object.create(Kr);return a.size=t-e,a._origin=e,a._capacity=t,a._level=r,a._root=n,a._tail=o,a.__ownerID=i,a.__hash=s,a.__altered=!1,a}function vt(){return Jr||(Jr=ht(0,0,ur))}function yt(e,r,n){if(r=s(e,r),r>=e.size||0>r)return e.withMutations(function(e){0>r?bt(e,r).set(0,n):bt(e,0,r+1).set(r,n)});r+=e._origin;var o=e._tail,i=e._root,a=t(pr);return r>=St(e._capacity)?o=_t(o,e.__ownerID,0,r,n,a):i=_t(i,e.__ownerID,e._level,r,n,a),a.value?e.__ownerID?(e._root=i,e._tail=o,e.__hash=void 0,e.__altered=!0,e):ht(e._origin,e._capacity,e._level,i,o):e}function _t(e,t,n,o,i,s){var a=o>>>n&fr,u=e&&a<e.array.length;if(!u&&void 0===i)return e;var c;if(n>0){var f=e&&e.array[a],l=_t(f,t,n-ur,o,i,s);return l===f?e:(c=mt(e,t),c.array[a]=l,c)}return u&&e.array[a]===i?e:(r(s),c=mt(e,t),void 0===i&&a===c.array.length-1?c.array.pop():c.array[a]=i,c)}function mt(e,t){return t&&e&&t===e.ownerID?e:new dt(e?e.array.slice():[],t)}function gt(e,t){if(t>=St(e._capacity))return e._tail;if(t<1<<e._level+ur){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&fr],n-=ur;return r}}function bt(e,t,r){var o=e.__ownerID||new n,i=e._origin,s=e._capacity,a=i+t,u=void 0===r?s:0>r?s+r:i+r;if(a===i&&u===s)return e;if(a>=u)return e.clear();for(var c=e._level,f=e._root,l=0;0>a+l;)f=new dt(f&&f.array.length?[void 0,f]:[],o),c+=ur,l+=1<<c;l&&(a+=l,i+=l,u+=l,s+=l);for(var d=St(s),p=St(u);p>=1<<c+ur;)f=new dt(f&&f.array.length?[f]:[],o),c+=ur;var h=e._tail,v=d>p?gt(e,u-1):p>d?new dt([],o):h;if(h&&p>d&&s>a&&h.array.length){f=mt(f,o);for(var y=f,_=c;_>ur;_-=ur){var m=d>>>_&fr;y=y.array[m]=mt(y.array[m],o)}y.array[d>>>ur&fr]=h}if(s>u&&(v=v&&v.removeAfter(o,0,u)),a>=p)a-=p,u-=p,c=ur,f=null,v=v&&v.removeBefore(o,0,a);else if(a>i||d>p){for(l=0;f;){var g=a>>>c&fr;if(g!==p>>>c&fr)break;g&&(l+=(1<<c)*g),c-=ur,f=f.array[g]}f&&a>i&&(f=f.removeBefore(o,c,a-l)),f&&d>p&&(f=f.removeAfter(o,c,p-l)),l&&(a-=l,u-=l)}return e.__ownerID?(e.size=u-a,e._origin=a,e._capacity=u,e._level=c,e._root=f,e._tail=v,e.__hash=void 0,e.__altered=!0,e):ht(a,u,c,f,v)}function wt(e,t,r){for(var n=[],o=0,i=0;i<r.length;i++){var s=r[i],a=h(s);a.size>o&&(o=a.size),y(s)||(a=a.map(function(e){return Q(e)})),n.push(a)}return o>e.size&&(e=e.setSize(o)),ot(e,t,n)}function St(e){return cr>e?0:e-1>>>ur<<ur}function Et(e){return null===e||void 0===e?kt():xt(e)?e:kt().withMutations(function(t){var r=p(e);ae(r.size),r.forEach(function(e,r){return t.set(r,e)})})}function xt(e){return Me(e)&&b(e)}function Tt(e,t,r,n){var o=Object.create(Et.prototype);return o.size=e?e.size:0,o._map=e,o._list=t,o.__ownerID=r,o.__hash=n,o}function kt(){return Hr||(Hr=Tt(Ve(),vt()))}function Ot(e,t,r){var n,o,i=e._map,s=e._list,a=i.get(t),u=void 0!==a;if(r===lr){if(!u)return e;s.size>=cr&&s.size>=2*i.size?(o=s.filter(function(e,t){return void 0!==e&&a!==t}),n=o.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(n.__ownerID=o.__ownerID=e.__ownerID)):(n=i.remove(t),o=a===s.size-1?s.pop():s.set(a,void 0))}else if(u){if(r===s.get(a)[1])return e;n=i,o=s.set(a,[t,r])}else n=i.set(t,s.size),o=s.set(s.size,[t,r]);return e.__ownerID?(e.size=n.size,e._map=n,e._list=o,e.__hash=void 0,e):Tt(n,o)}function It(e){return null===e||void 0===e?Dt():At(e)?e:Dt().unshiftAll(e)}function At(e){return!(!e||!e[Vr])}function jt(e,t,r,n){var o=Object.create(Gr);return o.size=e,o._head=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}function Dt(){return Qr||(Qr=jt(0))}function qt(e){return null===e||void 0===e?Nt():Rt(e)?e:Nt().withMutations(function(t){var r=v(e);ae(r.size),r.forEach(function(e){return t.add(e)})})}function Rt(e){return!(!e||!e[Xr])}function Lt(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function Ct(e,t){var r=Object.create(Yr);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function Nt(){return Zr||(Zr=Ct(Ve()))}function $t(e){return null===e||void 0===e?Pt():Mt(e)?e:Pt().withMutations(function(t){var r=v(e);ae(r.size),r.forEach(function(e){return t.add(e)})})}function Mt(e){return Rt(e)&&b(e)}function Bt(e,t){var r=Object.create(en);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}function Pt(){return tn||(tn=Bt(kt()))}function zt(e,t){var r,n=function(i){if(i instanceof n)return i;if(!(this instanceof n))return new n(i);if(!r){r=!0;var s=Object.keys(e);Kt(o,s),o.size=s.length,o._name=t,o._keys=s,o._defaultValues=e}this._map=$e(i)},o=n.prototype=Object.create(rn);return o.constructor=n,n}function Ft(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._map=t,n.__ownerID=r,n}function Ut(e){return e._name||e.constructor.name||"Record"}function Kt(e,t){try{t.forEach(Jt.bind(void 0,e))}catch(r){}}function Jt(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){se(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}function Wt(e,t){if(e===t)return!0;if(!y(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||_(e)!==_(t)||m(e)!==m(t)||b(e)!==b(t))return!1;if(0===e.size&&0===t.size)return!0;var r=!g(e);if(b(e)){var n=e.entries();return t.every(function(e,t){var o=n.next().value;return o&&G(o[1],e)&&(r||G(o[0],t))})&&n.next().done}var o=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{o=!0;var i=e;e=t,t=i}var s=!0,a=t.__iterate(function(t,n){return(r?e.has(t):o?G(t,e.get(n,lr)):G(e.get(n,lr),t))?void 0:(s=!1,!1)});return s&&e.size===a}function Ht(e,t,r){if(!(this instanceof Ht))return new Ht(e,t,r);if(se(0!==r,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),r=void 0===r?1:Math.abs(r),e>t&&(r=-r),this._start=e,this._end=t,this._step=r,this.size=Math.max(0,Math.ceil((t-e)/r-1)+1),0===this.size){if(nn)return nn;nn=this}}function Vt(e,t){if(!(this instanceof Vt))return new Vt(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(on)return on;on=this}}function Gt(e,t){var r=function(r){e.prototype[r]=t[r]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function Qt(e,t){return t}function Xt(e,t){return[t,e]}function Yt(e){return function(){return!e.apply(this,arguments)}}function Zt(e){return function(){return-e.apply(this,arguments)}}function er(e){return"string"==typeof e?JSON.stringify(e):e}function tr(){return o(arguments)}function rr(e,t){return t>e?1:e>t?-1:0}function nr(e){if(e.size===1/0)return 0;var t=b(e),r=_(e),n=t?1:0,o=e.__iterate(r?t?function(e,t){n=31*n+ir(te(e),te(t))|0}:function(e,t){n=n+ir(te(e),te(t))|0}:t?function(e){n=31*n+te(e)|0}:function(e){n=n+te(e)|0});return or(o,n)}function or(e,t){return t=Or(t,3432918353),t=Or(t<<15|t>>>-15,461845907),t=Or(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Or(t^t>>>16,2246822507),t=Or(t^t>>>13,3266489909),t=ee(t^t>>>16)}function ir(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var sr=Array.prototype.slice,ar="delete",ur=5,cr=1<<ur,fr=cr-1,lr={},dr={value:!1},pr={value:!1};e(p,d),e(h,d),e(v,d),d.isIterable=y,d.isKeyed=_,d.isIndexed=m,d.isAssociative=g,d.isOrdered=b,d.Keyed=p,d.Indexed=h,d.Set=v;var hr="@@__IMMUTABLE_ITERABLE__@@",vr="@@__IMMUTABLE_KEYED__@@",yr="@@__IMMUTABLE_INDEXED__@@",_r="@@__IMMUTABLE_ORDERED__@@",mr=0,gr=1,br=2,wr="function"==typeof Symbol&&Symbol.iterator,Sr="@@iterator",Er=wr||Sr;w.prototype.toString=function(){return"[Iterator]"},w.KEYS=mr,w.VALUES=gr,w.ENTRIES=br,w.prototype.inspect=w.prototype.toSource=function(){return this.toString()},w.prototype[Er]=function(){return this},e(A,d),A.of=function(){return A(arguments)},A.prototype.toSeq=function(){return this},A.prototype.toString=function(){return this.__toString("Seq {","}")},A.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},A.prototype.__iterate=function(e,t){return U(this,e,t,!0)},A.prototype.__iterator=function(e,t){return K(this,e,t,!0)},e(j,A),j.prototype.toKeyedSeq=function(){return this},e(D,A),D.of=function(){return D(arguments)},D.prototype.toIndexedSeq=function(){return this},D.prototype.toString=function(){return this.__toString("Seq [","]")},D.prototype.__iterate=function(e,t){return U(this,e,t,!1)},D.prototype.__iterator=function(e,t){return K(this,e,t,!1)},e(q,A),q.of=function(){return q(arguments)},q.prototype.toSetSeq=function(){return this},A.isSeq=$,A.Keyed=j,A.Set=q,A.Indexed=D;var xr="@@__IMMUTABLE_SEQ__@@";A.prototype[xr]=!0,e(R,D),R.prototype.get=function(e,t){return this.has(e)?this._array[s(this,e)]:t},R.prototype.__iterate=function(e,t){for(var r=this._array,n=r.length-1,o=0;n>=o;o++)if(e(r[t?n-o:o],o,this)===!1)return o+1;return o},R.prototype.__iterator=function(e,t){var r=this._array,n=r.length-1,o=0;return new w(function(){return o>n?E():S(e,o,r[t?n-o++:o++])})},e(L,j),L.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},L.prototype.has=function(e){return this._object.hasOwnProperty(e)},L.prototype.__iterate=function(e,t){for(var r=this._object,n=this._keys,o=n.length-1,i=0;o>=i;i++){var s=n[t?o-i:i];if(e(r[s],s,this)===!1)return i+1}return i},L.prototype.__iterator=function(e,t){var r=this._object,n=this._keys,o=n.length-1,i=0;return new w(function(){var s=n[t?o-i:i];return i++>o?E():S(e,s,r[s])})},L.prototype[_r]=!0,e(C,D),C.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var r=this._iterable,n=k(r),o=0;if(T(n))for(var i;!(i=n.next()).done&&e(i.value,o++,this)!==!1;);return o},C.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=this._iterable,n=k(r);if(!T(n))return new w(E);var o=0;return new w(function(){var t=n.next();return t.done?t:S(e,o++,t.value)})},e(N,D),N.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var r=this._iterator,n=this._iteratorCache,o=0;o<n.length;)if(e(n[o],o++,this)===!1)return o;for(var i;!(i=r.next()).done;){var s=i.value;if(n[o]=s,e(s,o++,this)===!1)break}return o},N.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var r=this._iterator,n=this._iteratorCache,o=0;return new w(function(){if(o>=n.length){var t=r.next();if(t.done)return t;n[o]=t.value}return S(e,o,n[o++])})};var Tr;e(J,d),e(W,J),e(H,J),e(V,J),J.Keyed=W,J.Indexed=H,J.Set=V;var kr,Or="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){e=0|e,t=0|t;var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16>>>0)|0},Ir=Object.isExtensible,Ar=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}(),jr="function"==typeof WeakMap;jr&&(kr=new WeakMap);var Dr=0,qr="__immutablehash__";"function"==typeof Symbol&&(qr=Symbol(qr));var Rr=16,Lr=255,Cr=0,Nr={};e(ue,j),ue.prototype.get=function(e,t){return this._iter.get(e,t)},ue.prototype.has=function(e){return this._iter.has(e)},ue.prototype.valueSeq=function(){return this._iter.valueSeq()},ue.prototype.reverse=function(){var e=this,t=he(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},ue.prototype.map=function(e,t){var r=this,n=pe(this,e,t);return this._useKeys||(n.valueSeq=function(){return r._iter.toSeq().map(e,t)}),n},ue.prototype.__iterate=function(e,t){var r,n=this;return this._iter.__iterate(this._useKeys?function(t,r){return e(t,r,n)}:(r=t?De(this):0,function(o){return e(o,t?--r:r++,n)}),t)},ue.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var r=this._iter.__iterator(gr,t),n=t?De(this):0;return new w(function(){var o=r.next();return o.done?o:S(e,t?--n:n++,o.value,o)})},ue.prototype[_r]=!0,e(ce,D),ce.prototype.contains=function(e){return this._iter.contains(e)},ce.prototype.__iterate=function(e,t){var r=this,n=0;return this._iter.__iterate(function(t){return e(t,n++,r)},t)},ce.prototype.__iterator=function(e,t){var r=this._iter.__iterator(gr,t),n=0;return new w(function(){var t=r.next();return t.done?t:S(e,n++,t.value,t)})},e(fe,q),fe.prototype.has=function(e){return this._iter.contains(e)},fe.prototype.__iterate=function(e,t){var r=this;return this._iter.__iterate(function(t){return e(t,t,r)},t)},fe.prototype.__iterator=function(e,t){var r=this._iter.__iterator(gr,t);return new w(function(){var t=r.next();return t.done?t:S(e,t.value,t.value,t)})},e(le,j),le.prototype.entrySeq=function(){return this._iter.toSeq()},le.prototype.__iterate=function(e,t){
var r=this;return this._iter.__iterate(function(t){if(t){je(t);var n=y(t);return e(n?t.get(1):t[1],n?t.get(0):t[0],r)}},t)},le.prototype.__iterator=function(e,t){var r=this._iter.__iterator(gr,t);return new w(function(){for(;;){var t=r.next();if(t.done)return t;var n=t.value;if(n){je(n);var o=y(n);return S(e,o?n.get(0):n[0],o?n.get(1):n[1],t)}}})},ce.prototype.cacheResult=ue.prototype.cacheResult=fe.prototype.cacheResult=le.prototype.cacheResult=Le,e($e,W),$e.prototype.toString=function(){return this.__toString("Map {","}")},$e.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},$e.prototype.set=function(e,t){return Ge(this,e,t)},$e.prototype.setIn=function(e,t){return this.updateIn(e,lr,function(){return t})},$e.prototype.remove=function(e){return Ge(this,e,lr)},$e.prototype.deleteIn=function(e){return this.updateIn(e,function(){return lr})},$e.prototype.update=function(e,t,r){return 1===arguments.length?e(this):this.updateIn([e],t,r)},$e.prototype.updateIn=function(e,t,r){r||(r=t,t=void 0);var n=it(this,Ne(e),t,r);return n===lr?void 0:n},$e.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Ve()},$e.prototype.merge=function(){return rt(this,void 0,arguments)},$e.prototype.mergeWith=function(e){var t=sr.call(arguments,1);return rt(this,e,t)},$e.prototype.mergeIn=function(e){var t=sr.call(arguments,1);return this.updateIn(e,Ve(),function(e){return e.merge.apply(e,t)})},$e.prototype.mergeDeep=function(){return rt(this,nt(void 0),arguments)},$e.prototype.mergeDeepWith=function(e){var t=sr.call(arguments,1);return rt(this,nt(e),t)},$e.prototype.mergeDeepIn=function(e){var t=sr.call(arguments,1);return this.updateIn(e,Ve(),function(e){return e.mergeDeep.apply(e,t)})},$e.prototype.sort=function(e){return Et(Te(this,e))},$e.prototype.sortBy=function(e,t){return Et(Te(this,t,e))},$e.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},$e.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new n)},$e.prototype.asImmutable=function(){return this.__ensureOwner()},$e.prototype.wasAltered=function(){return this.__altered},$e.prototype.__iterator=function(e,t){return new Ke(this,e,t)},$e.prototype.__iterate=function(e,t){var r=this,n=0;return this._root&&this._root.iterate(function(t){return n++,e(t[1],t[0],r)},t),n},$e.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?He(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},$e.isMap=Me;var $r="@@__IMMUTABLE_MAP__@@",Mr=$e.prototype;Mr[$r]=!0,Mr[ar]=Mr.remove,Mr.removeIn=Mr.deleteIn,Be.prototype.get=function(e,t,r,n){for(var o=this.entries,i=0,s=o.length;s>i;i++)if(G(r,o[i][0]))return o[i][1];return n},Be.prototype.update=function(e,t,n,i,s,a,u){for(var c=s===lr,f=this.entries,l=0,d=f.length;d>l&&!G(i,f[l][0]);l++);var p=d>l;if(p?f[l][1]===s:c)return this;if(r(u),(c||!p)&&r(a),!c||1!==f.length){if(!p&&!c&&f.length>=Pr)return Ze(e,f,i,s);var h=e&&e===this.ownerID,v=h?f:o(f);return p?c?l===d-1?v.pop():v[l]=v.pop():v[l]=[i,s]:v.push([i,s]),h?(this.entries=v,this):new Be(e,v)}},Pe.prototype.get=function(e,t,r,n){void 0===t&&(t=te(r));var o=1<<((0===e?t:t>>>e)&fr),i=this.bitmap;return 0===(i&o)?n:this.nodes[st(i&o-1)].get(e+ur,t,r,n)},Pe.prototype.update=function(e,t,r,n,o,i,s){void 0===r&&(r=te(n));var a=(0===t?r:r>>>t)&fr,u=1<<a,c=this.bitmap,f=0!==(c&u);if(!f&&o===lr)return this;var l=st(c&u-1),d=this.nodes,p=f?d[l]:void 0,h=Qe(p,e,t+ur,r,n,o,i,s);if(h===p)return this;if(!f&&h&&d.length>=zr)return tt(e,d,c,a,h);if(f&&!h&&2===d.length&&Xe(d[1^l]))return d[1^l];if(f&&h&&1===d.length&&Xe(h))return h;var v=e&&e===this.ownerID,y=f?h?c:c^u:c|u,_=f?h?at(d,l,h,v):ct(d,l,v):ut(d,l,h,v);return v?(this.bitmap=y,this.nodes=_,this):new Pe(e,y,_)},ze.prototype.get=function(e,t,r,n){void 0===t&&(t=te(r));var o=(0===e?t:t>>>e)&fr,i=this.nodes[o];return i?i.get(e+ur,t,r,n):n},ze.prototype.update=function(e,t,r,n,o,i,s){void 0===r&&(r=te(n));var a=(0===t?r:r>>>t)&fr,u=o===lr,c=this.nodes,f=c[a];if(u&&!f)return this;var l=Qe(f,e,t+ur,r,n,o,i,s);if(l===f)return this;var d=this.count;if(f){if(!l&&(d--,Fr>d))return et(e,c,d,a)}else d++;var p=e&&e===this.ownerID,h=at(c,a,l,p);return p?(this.count=d,this.nodes=h,this):new ze(e,d,h)},Fe.prototype.get=function(e,t,r,n){for(var o=this.entries,i=0,s=o.length;s>i;i++)if(G(r,o[i][0]))return o[i][1];return n},Fe.prototype.update=function(e,t,n,i,s,a,u){void 0===n&&(n=te(i));var c=s===lr;if(n!==this.keyHash)return c?this:(r(u),r(a),Ye(this,e,t,n,[i,s]));for(var f=this.entries,l=0,d=f.length;d>l&&!G(i,f[l][0]);l++);var p=d>l;if(p?f[l][1]===s:c)return this;if(r(u),(c||!p)&&r(a),c&&2===d)return new Ue(e,this.keyHash,f[1^l]);var h=e&&e===this.ownerID,v=h?f:o(f);return p?c?l===d-1?v.pop():v[l]=v.pop():v[l]=[i,s]:v.push([i,s]),h?(this.entries=v,this):new Fe(e,this.keyHash,v)},Ue.prototype.get=function(e,t,r,n){return G(r,this.entry[0])?this.entry[1]:n},Ue.prototype.update=function(e,t,n,o,i,s,a){var u=i===lr,c=G(o,this.entry[0]);return(c?i===this.entry[1]:u)?this:(r(a),u?void r(s):c?e&&e===this.ownerID?(this.entry[1]=i,this):new Ue(e,this.keyHash,[o,i]):(r(s),Ye(this,e,t,te(o),[o,i])))},Be.prototype.iterate=Fe.prototype.iterate=function(e,t){for(var r=this.entries,n=0,o=r.length-1;o>=n;n++)if(e(r[t?o-n:n])===!1)return!1},Pe.prototype.iterate=ze.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,o=r.length-1;o>=n;n++){var i=r[t?o-n:n];if(i&&i.iterate(e,t)===!1)return!1}},Ue.prototype.iterate=function(e,t){return e(this.entry)},e(Ke,w),Ke.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var r,n=t.node,o=t.index++;if(n.entry){if(0===o)return Je(e,n.entry)}else if(n.entries){if(r=n.entries.length-1,r>=o)return Je(e,n.entries[this._reverse?r-o:o])}else if(r=n.nodes.length-1,r>=o){var i=n.nodes[this._reverse?r-o:o];if(i){if(i.entry)return Je(e,i.entry);t=this._stack=We(i,t)}continue}t=this._stack=this._stack.__prev}return E()};var Br,Pr=cr/4,zr=cr/2,Fr=cr/4;e(ft,H),ft.of=function(){return this(arguments)},ft.prototype.toString=function(){return this.__toString("List [","]")},ft.prototype.get=function(e,t){if(e=s(this,e),0>e||e>=this.size)return t;e+=this._origin;var r=gt(this,e);return r&&r.array[e&fr]},ft.prototype.set=function(e,t){return yt(this,e,t)},ft.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},ft.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=ur,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):vt()},ft.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(r){bt(r,0,t+e.length);for(var n=0;n<e.length;n++)r.set(t+n,e[n])})},ft.prototype.pop=function(){return bt(this,0,-1)},ft.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){bt(t,-e.length);for(var r=0;r<e.length;r++)t.set(r,e[r])})},ft.prototype.shift=function(){return bt(this,1)},ft.prototype.merge=function(){return wt(this,void 0,arguments)},ft.prototype.mergeWith=function(e){var t=sr.call(arguments,1);return wt(this,e,t)},ft.prototype.mergeDeep=function(){return wt(this,nt(void 0),arguments)},ft.prototype.mergeDeepWith=function(e){var t=sr.call(arguments,1);return wt(this,nt(e),t)},ft.prototype.setSize=function(e){return bt(this,0,e)},ft.prototype.slice=function(e,t){var r=this.size;return u(e,t,r)?this:bt(this,c(e,r),f(t,r))},ft.prototype.__iterator=function(e,t){var r=0,n=pt(this,t);return new w(function(){var t=n();return t===Wr?E():S(e,r++,t)})},ft.prototype.__iterate=function(e,t){for(var r,n=0,o=pt(this,t);(r=o())!==Wr&&e(r,n++,this)!==!1;);return n},ft.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?ht(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},ft.isList=lt;var Ur="@@__IMMUTABLE_LIST__@@",Kr=ft.prototype;Kr[Ur]=!0,Kr[ar]=Kr.remove,Kr.setIn=Mr.setIn,Kr.deleteIn=Kr.removeIn=Mr.removeIn,Kr.update=Mr.update,Kr.updateIn=Mr.updateIn,Kr.mergeIn=Mr.mergeIn,Kr.mergeDeepIn=Mr.mergeDeepIn,Kr.withMutations=Mr.withMutations,Kr.asMutable=Mr.asMutable,Kr.asImmutable=Mr.asImmutable,Kr.wasAltered=Mr.wasAltered,dt.prototype.removeBefore=function(e,t,r){if(r===t?1<<t:0||0===this.array.length)return this;var n=r>>>t&fr;if(n>=this.array.length)return new dt([],e);var o,i=0===n;if(t>0){var s=this.array[n];if(o=s&&s.removeBefore(e,t-ur,r),o===s&&i)return this}if(i&&!o)return this;var a=mt(this,e);if(!i)for(var u=0;n>u;u++)a.array[u]=void 0;return o&&(a.array[n]=o),a},dt.prototype.removeAfter=function(e,t,r){if(r===t?1<<t:0||0===this.array.length)return this;var n=r-1>>>t&fr;if(n>=this.array.length)return this;var o,i=n===this.array.length-1;if(t>0){var s=this.array[n];if(o=s&&s.removeAfter(e,t-ur,r),o===s&&i)return this}if(i&&!o)return this;var a=mt(this,e);return i||a.array.pop(),o&&(a.array[n]=o),a};var Jr,Wr={};e(Et,$e),Et.of=function(){return this(arguments)},Et.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Et.prototype.get=function(e,t){var r=this._map.get(e);return void 0!==r?this._list.get(r)[1]:t},Et.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):kt()},Et.prototype.set=function(e,t){return Ot(this,e,t)},Et.prototype.remove=function(e){return Ot(this,e,lr)},Et.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Et.prototype.__iterate=function(e,t){var r=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],r)},t)},Et.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},Et.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),r=this._list.__ensureOwner(e);return e?Tt(t,r,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=r,this)},Et.isOrderedMap=xt,Et.prototype[_r]=!0,Et.prototype[ar]=Et.prototype.remove;var Hr;e(It,H),It.of=function(){return this(arguments)},It.prototype.toString=function(){return this.__toString("Stack [","]")},It.prototype.get=function(e,t){var r=this._head;for(e=s(this,e);r&&e--;)r=r.next;return r?r.value:t},It.prototype.peek=function(){return this._head&&this._head.value},It.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,r=arguments.length-1;r>=0;r--)t={value:arguments[r],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):jt(e,t)},It.prototype.pushAll=function(e){if(e=h(e),0===e.size)return this;ae(e.size);var t=this.size,r=this._head;return e.reverse().forEach(function(e){t++,r={value:e,next:r}}),this.__ownerID?(this.size=t,this._head=r,this.__hash=void 0,this.__altered=!0,this):jt(t,r)},It.prototype.pop=function(){return this.slice(1)},It.prototype.unshift=function(){return this.push.apply(this,arguments)},It.prototype.unshiftAll=function(e){return this.pushAll(e)},It.prototype.shift=function(){return this.pop.apply(this,arguments)},It.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Dt()},It.prototype.slice=function(e,t){if(u(e,t,this.size))return this;var r=c(e,this.size),n=f(t,this.size);if(n!==this.size)return H.prototype.slice.call(this,e,t);for(var o=this.size-r,i=this._head;r--;)i=i.next;return this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):jt(o,i)},It.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?jt(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},It.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var r=0,n=this._head;n&&e(n.value,r++,this)!==!1;)n=n.next;return r},It.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var r=0,n=this._head;return new w(function(){if(n){var t=n.value;return n=n.next,S(e,r++,t)}return E()})},It.isStack=At;var Vr="@@__IMMUTABLE_STACK__@@",Gr=It.prototype;Gr[Vr]=!0,Gr.withMutations=Mr.withMutations,Gr.asMutable=Mr.asMutable,Gr.asImmutable=Mr.asImmutable,Gr.wasAltered=Mr.wasAltered;var Qr;e(qt,V),qt.of=function(){return this(arguments)},qt.fromKeys=function(e){return this(p(e).keySeq())},qt.prototype.toString=function(){return this.__toString("Set {","}")},qt.prototype.has=function(e){return this._map.has(e)},qt.prototype.add=function(e){return Lt(this,this._map.set(e,!0))},qt.prototype.remove=function(e){return Lt(this,this._map.remove(e))},qt.prototype.clear=function(){return Lt(this,this._map.clear())},qt.prototype.union=function(){var e=sr.call(arguments,0);return e=e.filter(function(e){return 0!==e.size}),0===e.length?this:0!==this.size||this.__ownerID||1!==e.length?this.withMutations(function(t){for(var r=0;r<e.length;r++)v(e[r]).forEach(function(e){return t.add(e)})}):this.constructor(e[0])},qt.prototype.intersect=function(){var e=sr.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return v(e)});var t=this;return this.withMutations(function(r){t.forEach(function(t){e.every(function(e){return e.contains(t)})||r.remove(t)})})},qt.prototype.subtract=function(){var e=sr.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return v(e)});var t=this;return this.withMutations(function(r){t.forEach(function(t){e.some(function(e){return e.contains(t)})&&r.remove(t)})})},qt.prototype.merge=function(){return this.union.apply(this,arguments)},qt.prototype.mergeWith=function(e){var t=sr.call(arguments,1);return this.union.apply(this,t)},qt.prototype.sort=function(e){return $t(Te(this,e))},qt.prototype.sortBy=function(e,t){return $t(Te(this,t,e))},qt.prototype.wasAltered=function(){return this._map.wasAltered()},qt.prototype.__iterate=function(e,t){var r=this;return this._map.__iterate(function(t,n){return e(n,n,r)},t)},qt.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},qt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},qt.isSet=Rt;var Xr="@@__IMMUTABLE_SET__@@",Yr=qt.prototype;Yr[Xr]=!0,Yr[ar]=Yr.remove,Yr.mergeDeep=Yr.merge,Yr.mergeDeepWith=Yr.mergeWith,Yr.withMutations=Mr.withMutations,Yr.asMutable=Mr.asMutable,Yr.asImmutable=Mr.asImmutable,Yr.__empty=Nt,Yr.__make=Ct;var Zr;e($t,qt),$t.of=function(){return this(arguments)},$t.fromKeys=function(e){return this(p(e).keySeq())},$t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},$t.isOrderedSet=Mt;var en=$t.prototype;en[_r]=!0,en.__empty=Pt,en.__make=Bt;var tn;e(zt,W),zt.prototype.toString=function(){return this.__toString(Ut(this)+" {","}")},zt.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},zt.prototype.get=function(e,t){if(!this.has(e))return t;var r=this._defaultValues[e];return this._map?this._map.get(e,r):r},zt.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=Ft(this,Ve()))},zt.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+Ut(this));var r=this._map&&this._map.set(e,t);return this.__ownerID||r===this._map?this:Ft(this,r)},zt.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:Ft(this,t)},zt.prototype.wasAltered=function(){return this._map.wasAltered()},zt.prototype.__iterator=function(e,t){var r=this;return p(this._defaultValues).map(function(e,t){return r.get(t)}).__iterator(e,t)},zt.prototype.__iterate=function(e,t){var r=this;return p(this._defaultValues).map(function(e,t){return r.get(t)}).__iterate(e,t)},zt.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?Ft(this,t,e):(this.__ownerID=e,this._map=t,this)};var rn=zt.prototype;rn[ar]=rn.remove,rn.deleteIn=rn.removeIn=Mr.removeIn,rn.merge=Mr.merge,rn.mergeWith=Mr.mergeWith,rn.mergeIn=Mr.mergeIn,rn.mergeDeep=Mr.mergeDeep,rn.mergeDeepWith=Mr.mergeDeepWith,rn.mergeDeepIn=Mr.mergeDeepIn,rn.setIn=Mr.setIn,rn.update=Mr.update,rn.updateIn=Mr.updateIn,rn.withMutations=Mr.withMutations,rn.asMutable=Mr.asMutable,rn.asImmutable=Mr.asImmutable,e(Ht,D),Ht.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Ht.prototype.get=function(e,t){return this.has(e)?this._start+s(this,e)*this._step:t},Ht.prototype.contains=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},Ht.prototype.slice=function(e,t){return u(e,t,this.size)?this:(e=c(e,this.size),t=f(t,this.size),e>=t?new Ht(0,0):new Ht(this.get(e,this._end),this.get(t,this._end),this._step))},Ht.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step===0){var r=t/this._step;if(r>=0&&r<this.size)return r}return-1},Ht.prototype.lastIndexOf=function(e){return this.indexOf(e)},Ht.prototype.__iterate=function(e,t){for(var r=this.size-1,n=this._step,o=t?this._start+r*n:this._start,i=0;r>=i;i++){if(e(o,i,this)===!1)return i+1;o+=t?-n:n}return i},Ht.prototype.__iterator=function(e,t){var r=this.size-1,n=this._step,o=t?this._start+r*n:this._start,i=0;return new w(function(){var s=o;return o+=t?-n:n,i>r?E():S(e,i++,s)})},Ht.prototype.equals=function(e){return e instanceof Ht?this._start===e._start&&this._end===e._end&&this._step===e._step:Wt(this,e)};var nn;e(Vt,D),Vt.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},Vt.prototype.get=function(e,t){return this.has(e)?this._value:t},Vt.prototype.contains=function(e){return G(this._value,e)},Vt.prototype.slice=function(e,t){var r=this.size;return u(e,t,r)?this:new Vt(this._value,f(t,r)-c(e,r))},Vt.prototype.reverse=function(){return this},Vt.prototype.indexOf=function(e){return G(this._value,e)?0:-1},Vt.prototype.lastIndexOf=function(e){return G(this._value,e)?this.size:-1},Vt.prototype.__iterate=function(e,t){for(var r=0;r<this.size;r++)if(e(this._value,r,this)===!1)return r+1;return r},Vt.prototype.__iterator=function(e,t){var r=this,n=0;return new w(function(){return n<r.size?S(e,n++,r._value):E()})},Vt.prototype.equals=function(e){return e instanceof Vt?G(this._value,e._value):Wt(e)};var on;d.Iterator=w,Gt(d,{toArray:function(){ae(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,r){e[r]=t}),e},toIndexedSeq:function(){return new ce(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new ue(this,!0)},toMap:function(){return $e(this.toKeyedSeq())},toObject:function(){ae(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e},toOrderedMap:function(){return Et(this.toKeyedSeq())},toOrderedSet:function(){return $t(_(this)?this.valueSeq():this)},toSet:function(){return qt(_(this)?this.valueSeq():this)},toSetSeq:function(){return new fe(this)},toSeq:function(){return m(this)?this.toIndexedSeq():_(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return It(_(this)?this.valueSeq():this)},toList:function(){return ft(_(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var e=sr.call(arguments,0);return Ae(this,we(this,e))},contains:function(e){return this.some(function(t){return G(t,e)})},entries:function(){return this.__iterator(br)},every:function(e,t){ae(this.size);var r=!0;return this.__iterate(function(n,o,i){return e.call(t,n,o,i)?void 0:(r=!1,!1)}),r},filter:function(e,t){return Ae(this,ve(this,e,t,!0))},find:function(e,t,r){var n=this.findEntry(e,t);return n?n[1]:r},findEntry:function(e,t){var r;return this.__iterate(function(n,o,i){return e.call(t,n,o,i)?(r=[o,n],!1):void 0}),r},findLastEntry:function(e,t){return this.toSeq().reverse().findEntry(e,t)},forEach:function(e,t){return ae(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){ae(this.size),e=void 0!==e?""+e:",";var t="",r=!0;return this.__iterate(function(n){r?r=!1:t+=e,t+=null!==n&&void 0!==n?n.toString():""}),t},keys:function(){return this.__iterator(mr)},map:function(e,t){return Ae(this,pe(this,e,t))},reduce:function(e,t,r){ae(this.size);var n,o;return arguments.length<2?o=!0:n=t,this.__iterate(function(t,i,s){o?(o=!1,n=t):n=e.call(r,n,t,i,s)}),n},reduceRight:function(e,t,r){var n=this.toKeyedSeq().reverse();return n.reduce.apply(n,arguments)},reverse:function(){return Ae(this,he(this,!0))},slice:function(e,t){return Ae(this,me(this,e,t,!0))},some:function(e,t){return!this.every(Yt(e),t)},sort:function(e){return Ae(this,Te(this,e))},values:function(){return this.__iterator(gr)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return i(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return ye(this,e,t)},equals:function(e){return Wt(this,e)},entrySeq:function(){var e=this;if(e._cache)return new R(e._cache);var t=e.toSeq().map(Xt).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Yt(e),t)},findLast:function(e,t,r){return this.toKeyedSeq().reverse().find(e,t,r)},first:function(){return this.find(a)},flatMap:function(e,t){return Ae(this,Ee(this,e,t))},flatten:function(e){return Ae(this,Se(this,e,!0))},fromEntrySeq:function(){return new le(this)},get:function(e,t){return this.find(function(t,r){return G(r,e)},void 0,t)},getIn:function(e,t){for(var r,n=this,o=Ne(e);!(r=o.next()).done;){var i=r.value;if(n=n&&n.get?n.get(i,lr):lr,n===lr)return t}return n},groupBy:function(e,t){return _e(this,e,t)},has:function(e){return this.get(e,lr)!==lr},hasIn:function(e){return this.getIn(e,lr)!==lr},isSubset:function(e){return e="function"==typeof e.contains?e:d(e),this.every(function(t){return e.contains(t)})},isSuperset:function(e){return e.isSubset(this)},keySeq:function(){return this.toSeq().map(Qt).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(e){return ke(this,e)},maxBy:function(e,t){return ke(this,t,e)},min:function(e){return ke(this,e?Zt(e):rr)},minBy:function(e,t){return ke(this,t?Zt(t):rr,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return Ae(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return Ae(this,be(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Yt(e),t)},sortBy:function(e,t){return Ae(this,Te(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return Ae(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return Ae(this,ge(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Yt(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=nr(this))}});var sn=d.prototype;sn[hr]=!0,sn[Er]=sn.values,sn.__toJS=sn.toArray,sn.__toStringMapper=er,sn.inspect=sn.toSource=function(){return this.toString()},sn.chain=sn.flatMap,function(){try{Object.defineProperty(sn,"length",{get:function(){if(!d.noLengthWarning){var e;try{throw new Error}catch(t){e=t.stack}if(-1===e.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+e),this.size}}})}catch(e){}}(),Gt(p,{flip:function(){return Ae(this,de(this))},findKey:function(e,t){var r=this.findEntry(e,t);return r&&r[0]},findLastKey:function(e,t){return this.toSeq().reverse().findKey(e,t)},keyOf:function(e){return this.findKey(function(t){return G(t,e)})},lastKeyOf:function(e){return this.findLastKey(function(t){return G(t,e)})},mapEntries:function(e,t){var r=this,n=0;return Ae(this,this.toSeq().map(function(o,i){return e.call(t,[i,o],n++,r)}).fromEntrySeq())},mapKeys:function(e,t){var r=this;return Ae(this,this.toSeq().flip().map(function(n,o){return e.call(t,n,o,r)}).flip())}});var an=p.prototype;an[vr]=!0,an[Er]=sn.entries,an.__toJS=sn.toObject,an.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+er(e)},Gt(h,{toKeyedSeq:function(){return new ue(this,!1)},filter:function(e,t){return Ae(this,ve(this,e,t,!1))},findIndex:function(e,t){var r=this.findEntry(e,t);return r?r[0]:-1},indexOf:function(e){var t=this.toKeyedSeq().keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){return this.toSeq().reverse().indexOf(e)},reverse:function(){return Ae(this,he(this,!1))},slice:function(e,t){return Ae(this,me(this,e,t,!1))},splice:function(e,t){var r=arguments.length;if(t=Math.max(0|t,0),0===r||2===r&&!t)return this;e=c(e,this.size);var n=this.slice(0,e);return Ae(this,1===r?n:n.concat(o(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var r=this.toKeyedSeq().findLastKey(e,t);return void 0===r?-1:r},first:function(){return this.get(0)},flatten:function(e){return Ae(this,Se(this,e,!1))},get:function(e,t){return e=s(this,e),0>e||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,r){return r===e},void 0,t)},has:function(e){return e=s(this,e),e>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Ae(this,xe(this,e))},interleave:function(){var e=[this].concat(o(arguments)),t=Ie(this.toSeq(),D.of,e),r=t.flatten(!0);return t.size&&(r.size=t.size*e.length),Ae(this,r)},last:function(){return this.get(-1)},skipWhile:function(e,t){return Ae(this,be(this,e,t,!1))},zip:function(){var e=[this].concat(o(arguments));return Ae(this,Ie(this,tr,e))},zipWith:function(e){var t=o(arguments);return t[0]=this,Ae(this,Ie(this,e,t))}}),h.prototype[yr]=!0,h.prototype[_r]=!0,Gt(v,{get:function(e,t){return this.has(e)?e:t},contains:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),v.prototype.has=sn.contains,Gt(j,p.prototype),Gt(D,h.prototype),Gt(q,v.prototype),Gt(W,p.prototype),Gt(H,h.prototype),Gt(V,v.prototype);var un={Iterable:d,Seq:A,Collection:J,Map:$e,OrderedMap:Et,List:ft,Stack:It,Set:qt,OrderedSet:$t,Record:zt,Range:Ht,Repeat:Vt,is:G,fromJS:Q};return un})},{}],83:[function(e,t,r){(function(r){"use strict";function n(e,t){for(var r=0;r<e.length;r++)if(t(e[r],r)===!0)return e[r];return!1}function o(e){return function(t,r){t||r[0]&&r[0].error?e(t||r[0]):e(null,r.length?r[0]:r)}}function i(e){for(var t=0;t<e.length;t++){var r=e[t];if(r._deleted)delete r._attachments;else if(r._attachments)for(var n=Object.keys(r._attachments),o=0;o<n.length;o++){var i=n[o];r._attachments[i]=l.pick(r._attachments[i],["data","digest","content_type","length","revpos","stub"])}}}function s(e,t){var r=l.compare(e._id,t._id);if(0!==r)return r;var n=e._revisions?e._revisions.start:0,o=t._revisions?t._revisions.start:0;return l.compare(n,o)}function a(e){var t={},r=[];return d.traverseRevTree(e,function(e,n,o,i){var s=n+"-"+o;return e&&(t[s]=0),void 0!==i&&r.push({from:i,to:s}),s}),r.reverse(),r.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}function u(e,t,r){var n="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&n.reverse(),!n.length)return e._allDocs({limit:0},r);var o={offset:t.skip};return _.all(n.map(function(r){var n=l.extend(!0,{key:r,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete n[e]}),new _(function(t,i){e._allDocs(n,function(e,n){return e?i(e):(o.total_rows=n.total_rows,void t(n.rows[0]||{key:r,error:"not_found"}))})})})).then(function(e){return o.rows=e,o})}function c(e){var t=e._compactionQueue[0],n=t.opts,o=t.callback;e.get("_local/compaction")["catch"](function(){return!1}).then(function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,function(t,n){t?o(t):o(null,n),r.nextTick(function(){e._compactionQueue.shift(),e._compactionQueue.length&&c(e)})})})}function f(){h.call(this)}var l=e("./utils"),d=e("./merge"),p=e("./deps/errors"),h=e("events").EventEmitter,v=e("./deps/upsert"),y=e("./changes"),_=l.Promise,m=e("./deps/docs/isDeleted"),g=e("./deps/docs/isLocalId");l.inherits(f,h),t.exports=f,f.prototype.post=l.adapterFun("post",function(e,t,r){return"function"==typeof t&&(r=t,t={}),"object"!=typeof e||Array.isArray(e)?r(p.error(p.NOT_AN_OBJECT)):void this.bulkDocs({docs:[e]},t,o(r))}),f.prototype.put=l.adapterFun("put",l.getArguments(function(e){var t,r,n,i,s=e.shift(),a="_id"in s;if("object"!=typeof s||Array.isArray(s))return(i=e.pop())(p.error(p.NOT_AN_OBJECT));for(s=l.clone(s);;)if(t=e.shift(),r=typeof t,"string"!==r||a?"string"!==r||!a||"_rev"in s?"object"===r?n=t:"function"===r&&(i=t):s._rev=t:(s._id=t,a=!0),!e.length)break;n=n||{};var u=l.invalidIdError(s._id);return u?i(u):g(s._id)&&"function"==typeof this._putLocal?s._deleted?this._removeLocal(s,i):this._putLocal(s,i):void this.bulkDocs({docs:[s]},n,o(i))})),f.prototype.putAttachment=l.adapterFun("putAttachment",function(e,t,r,n,o,i){function s(e){return e._attachments=e._attachments||{},e._attachments[t]={content_type:o,data:n},a.put(e)}var a=this;return"function"==typeof o&&(i=o,o=n,n=r,r=null),"undefined"==typeof o&&(o=n,n=r,r=null),a.get(e).then(function(e){if(e._rev!==r)throw p.error(p.REV_CONFLICT);return s(e)},function(t){if(t.reason===p.MISSING_DOC.message)return s({_id:e});throw t})}),f.prototype.removeAttachment=l.adapterFun("removeAttachment",function(e,t,r,n){var o=this;o.get(e,function(e,i){return e?void n(e):i._rev!==r?void n(p.error(p.REV_CONFLICT)):i._attachments?(delete i._attachments[t],0===Object.keys(i._attachments).length&&delete i._attachments,void o.put(i,n)):n()})}),f.prototype.remove=l.adapterFun("remove",function(e,t,r,n){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof r&&(n=r,r={})):(i=e,"function"==typeof t?(n=t,r={}):(n=r,r=t)),r=l.clone(r||{}),r.was_delete=!0;var s={_id:i._id,_rev:i._rev||r.rev};return s._deleted=!0,g(s._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,n):void this.bulkDocs({docs:[s]},r,o(n))}),f.prototype.revsDiff=l.adapterFun("revsDiff",function(e,t,r){function n(e,t){a.has(e)||a.set(e,{missing:[]}),a.get(e).missing.push(t)}function o(t,r){var o=e[t].slice(0);d.traverseRevTree(r,function(e,r,i,s,a){var u=r+"-"+i,c=o.indexOf(u);-1!==c&&(o.splice(c,1),"available"!==a.status&&n(t,u))}),o.forEach(function(e){n(t,e)})}"function"==typeof t&&(r=t,t={}),t=l.clone(t);var i=Object.keys(e);if(!i.length)return r(null,{});var s=0,a=new l.Map;i.map(function(t){this._getRevisionTree(t,function(n,u){if(n&&404===n.status&&"missing"===n.message)a.set(t,{missing:e[t]});else{if(n)return r(n);o(t,u)}if(++s===i.length){var c={};return a.forEach(function(e,t){c[t]=e}),r(null,c)}})},this)}),f.prototype.compactDocument=l.adapterFun("compactDocument",function(e,t,r){var n=this;this._getRevisionTree(e,function(o,i){if(o)return r(o);var s=a(i),u=[],c=[];Object.keys(s).forEach(function(e){s[e]>t&&u.push(e)}),d.traverseRevTree(i,function(e,t,r,n,o){var i=t+"-"+r;"available"===o.status&&-1!==u.indexOf(i)&&c.push(i)}),n._doCompaction(e,c,r)})}),f.prototype.compact=l.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={});var r=this;e=l.clone(e||{}),r._compactionQueue=r._compactionQueue||[],r._compactionQueue.push({opts:e,callback:t}),1===r._compactionQueue.length&&c(r)}),f.prototype._compact=function(e,t){function r(e){s.push(o.compactDocument(e.id,0))}function n(e){var r=e.last_seq;_.all(s).then(function(){return v(o,"_local/compaction",function(e){return!e.last_seq||e.last_seq<r?(e.last_seq=r,
e):!1})}).then(function(){t(null,{ok:!0})})["catch"](t)}var o=this,i={returnDocs:!1,last_seq:e.last_seq||0},s=[];o.changes(i).on("change",r).on("complete",n).on("error",t)},f.prototype.get=l.adapterFun("get",function(e,t,r){function o(){var n=[],o=i.length;return o?void i.forEach(function(i){s.get(e,{rev:i,revs:t.revs,attachments:t.attachments},function(e,t){n.push(e?{missing:i}:{ok:t}),o--,o||r(null,n)})}):r(null,n)}if("function"==typeof t&&(r=t,t={}),"string"!=typeof e)return r(p.error(p.INVALID_ID));if(g(e)&&"function"==typeof this._getLocal)return this._getLocal(e,r);var i=[],s=this;if(!t.open_revs)return this._get(e,t,function(e,o){if(t=l.clone(t),e)return r(e);var i=o.doc,a=o.metadata,u=o.ctx;if(t.conflicts){var c=d.collectConflicts(a);c.length&&(i._conflicts=c)}if(m(a,i._rev)&&(i._deleted=!0),t.revs||t.revs_info){var f=d.rootToLeaf(a.rev_tree),p=n(f,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])}),h=p.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1,v=p.ids.length-h;if(p.ids.splice(h,v),p.ids.reverse(),t.revs&&(i._revisions={start:p.pos+p.ids.length-1,ids:p.ids.map(function(e){return e.id})}),t.revs_info){var y=p.pos+p.ids.length;i._revs_info=p.ids.map(function(e){return y--,{rev:y+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&i._attachments){var _=i._attachments,g=Object.keys(_).length;if(0===g)return r(null,i);Object.keys(_).forEach(function(e){this._getAttachment(_[e],{binary:t.binary,ctx:u},function(t,n){var o=i._attachments[e];o.data=n,delete o.stub,delete o.length,--g||r(null,i)})},s)}else{if(i._attachments)for(var b in i._attachments)i._attachments.hasOwnProperty(b)&&(i._attachments[b].stub=!0);r(null,i)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){return e?r(e):(i=d.collectLeaves(t).map(function(e){return e.rev}),void o())});else{if(!Array.isArray(t.open_revs))return r(p.error(p.UNKNOWN_ERROR,"function_clause"));i=t.open_revs;for(var a=0;a<i.length;a++){var u=i[a];if("string"!=typeof u||!/^\d+-/.test(u))return r(p.error(p.INVALID_REV))}o()}}),f.prototype.getAttachment=l.adapterFun("getAttachment",function(e,t,r,n){var o=this;r instanceof Function&&(n=r,r={}),r=l.clone(r),this._get(e,r,function(e,i){return e?n(e):i.doc._attachments&&i.doc._attachments[t]?(r.ctx=i.ctx,r.binary=!0,o._getAttachment(i.doc._attachments[t],r,n),void 0):n(p.error(p.MISSING_DOC))})}),f.prototype.allDocs=l.adapterFun("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e=l.clone(e),e.skip="undefined"!=typeof e.skip?e.skip:0,"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(r)return void t(p.error(p.QUERY_PARSE_ERROR,"Query parameter `"+r+"` is not compatible with multi-get"));if("http"!==this.type())return u(this,e,t)}return this._allDocs(e,t)}),f.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new y(this,e,t)},f.prototype.close=l.adapterFun("close",function(e){return this._closed=!0,this._close(e)}),f.prototype.info=l.adapterFun("info",function(e){var t=this;this._info(function(r,n){return r?e(r):(n.db_name=n.db_name||t._db_name,n.auto_compaction=!(!t.auto_compaction||"http"===t.type()),n.adapter=t.type(),void e(null,n))})}),f.prototype.id=l.adapterFun("id",function(e){return this._id(e)}),f.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},f.prototype.bulkDocs=l.adapterFun("bulkDocs",function(e,t,r){if("function"==typeof t&&(r=t,t={}),t=l.clone(t),Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(p.error(p.MISSING_BULK_DOCS));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return r(p.error(p.NOT_AN_OBJECT));return e=l.clone(e),"new_edits"in t||(t.new_edits="new_edits"in e?e.new_edits:!0),t.new_edits||"http"===this.type()||e.docs.sort(s),i(e.docs),this._bulkDocs(e,t,function(e,n){return e?r(e):(t.new_edits||(n=n.filter(function(e){return e.error})),void r(null,n))})}),f.prototype.registerDependentDatabase=l.adapterFun("registerDependentDatabase",function(e,t){function r(t){return t.dependentDbs=t.dependentDbs||{},t.dependentDbs[e]?!1:(t.dependentDbs[e]=!0,t)}var n=new this.constructor(e,this.__opts);v(this,"_local/_pouch_dependentDbs",r,function(e){return e?t(e):t(null,{db:n})})}),f.prototype.destroy=l.adapterFun("destroy",function(e){function t(){r._destroy(function(t,n){return t?e(t):(r.emit("destroyed"),void e(null,n||{ok:!0}))})}var r=this,n="use_prefix"in r?r.use_prefix:!0;r.get("_local/_pouch_dependentDbs",function(o,i){if(o)return 404!==o.status?e(o):t();var s=i.dependentDbs,a=r.constructor,u=Object.keys(s).map(function(e){var t=n?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,r.__opts).destroy()});_.all(u).then(t,function(t){e(t)})})})}).call(this,e("_process"))},{"./changes":96,"./deps/docs/isDeleted":119,"./deps/docs/isLocalId":120,"./deps/errors":129,"./deps/upsert":137,"./merge":149,"./utils":160,_process:81,events:80}],84:[function(e,t,r){"use strict";t.exports={idb:e("./adapters/idb"),websql:e("./adapters/websql")}},{"./adapters/idb":90,"./adapters/websql":94}],85:[function(e,t,r){"use strict";function n(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];r.data=p(r.data,r.content_type)})}function o(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function i(e){return e._attachments&&Object.keys(e._attachments)?v.all(Object.keys(e._attachments).map(function(t){var r=e._attachments[t];return r.data&&"string"!=typeof r.data?E(r.data).then(function(e){r.data=e}):void 0})):v.resolve()}function s(e,t){var r=h.parseUri(e);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var n=r.path.replace(/(^\/|\/$)/g,"").split("/");if(r.db=n.pop(),r.path=n.join("/"),t=t||{},t=y(t),r.headers=t.headers||t.ajax&&t.ajax.headers||{},t.auth||r.auth){var o=t.auth||r.auth,i=m(o.username+":"+o.password);r.headers.Authorization="Basic "+i}return t.headers&&(r.headers=t.headers),r}function a(e,t){return u(e,e.db+"/"+t)}function u(e,t){var r=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+r+t}function c(e,t){function r(e,t){var r=h.extend(!0,y(O),e);return w(r.method+" "+r.url),h.ajax(r,t)}function c(e){return new v(function(t,n){r(e,function(e,r){return e?n(e):void t(r)})})}function p(e){return e.split("/").map(encodeURIComponent).join("/")}var _=this,m=s;e.getHost&&(m=e.getHost);var T=m(e.name,e),k=a(T,"");_.getUrl=function(){return k},_.getHeaders=function(){return y(T.headers)};var O=e.ajax||{};e=y(e);var I=function(){r({headers:y(T.headers),method:"PUT",url:k},function(e){e&&401===e.status?r({headers:y(T.headers),method:"HEAD",url:k},function(e){e?t(e):t(null,_)}):e&&412!==e.status?t(e):t(null,_)})};e.skipSetup||r({headers:y(T.headers),method:"GET",url:k},function(e){e?404===e.status?(h.explain404("PouchDB is just detecting if the remote DB exists."),I()):t(e):t(null,_)}),_.type=function(){return"http"},_.id=h.adapterFun("id",function(e){r({headers:y(T.headers),method:"GET",url:u(T,"")},function(t,r){if(t)return e(t);var n=r.uuid+T.db;e(null,n)})}),_.request=h.adapterFun("request",function(e,t){e.headers=T.headers,e.url=a(T,e.url),r(e,t)}),_.compact=h.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=y(e),r({headers:y(T.headers),url:a(T,"_compact"),method:"POST"},function(){function r(){_.info(function(n,o){o.compact_running?setTimeout(r,e.interval||200):t(null,{ok:!0})})}r()})}),_._info=function(e){r({headers:y(T.headers),method:"GET",url:a(T,"")},function(t,r){return t?e(t):(r.host=a(T,""),void e(null,r))})},_.get=h.adapterFun("get",function(e,t,r){function n(e){var r=e._attachments,n=r&&Object.keys(r);return r&&n.length?v.all(n.map(function(n){var i=r[n],s=o(e._id)+"/"+p(n)+"?rev="+e._rev;return c({headers:y(T.headers),method:"GET",url:a(T,s),binary:!0}).then(function(e){return t.binary?e:E(e)}).then(function(e){delete i.stub,delete i.length,i.data=e})})):void 0}function i(e){return Array.isArray(e)?v.all(e.map(function(e){return e.ok?n(e.ok):void 0})):n(e)}"function"==typeof t&&(r=t,t={}),t=y(t);var s=[];t.revs&&s.push("revs=true"),t.revs_info&&s.push("revs_info=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.push("open_revs="+t.open_revs)),t.rev&&s.push("rev="+t.rev),t.conflicts&&s.push("conflicts="+t.conflicts),s=s.join("&"),s=""===s?"":"?"+s,e=o(e);var u={headers:y(T.headers),method:"GET",url:a(T,e+s)},f=t.ajax||{};h.extend(!0,u,f),c(u).then(function(e){return v.resolve().then(function(){return t.attachments?i(e):void 0}).then(function(){r(null,e)})})["catch"](r)}),_.remove=h.adapterFun("remove",function(e,t,n,i){var s;"string"==typeof t?(s={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(s=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var u=s._rev||n.rev;r({headers:y(T.headers),method:"DELETE",url:a(T,o(s._id))+"?rev="+u},i)}),_.getAttachment=h.adapterFun("getAttachment",function(e,t,n,i){"function"==typeof n&&(i=n,n={});var s=n.rev?"?rev="+n.rev:"",u=a(T,o(e))+"/"+p(t)+s;r({headers:y(T.headers),method:"GET",url:u,binary:!0},i)}),_.removeAttachment=h.adapterFun("removeAttachment",function(e,t,n,i){var s=a(T,o(e)+"/"+p(t))+"?rev="+n;r({headers:y(T.headers),method:"DELETE",url:s},i)}),_.putAttachment=h.adapterFun("putAttachment",function(e,t,n,i,s,u){"function"==typeof s&&(u=s,s=i,i=n,n=null);var c=o(e)+"/"+p(t),f=a(T,c);if(n&&(f+="?rev="+n),"string"==typeof i){var l;try{l=g(i)}catch(h){return u(b.error(b.BAD_ARG,"Attachments need to be base64 encoded"))}i=l?d(l,s):""}var v={headers:y(T.headers),method:"PUT",url:f,processData:!1,body:i,timeout:O.timeout||6e4};v.headers["Content-Type"]=s,r(v,u)}),_.put=h.adapterFun("put",h.getArguments(function(e){var t,r,n,s=e.shift(),u="_id"in s,f=e.pop();return"object"!=typeof s||Array.isArray(s)?f(b.error(b.NOT_AN_OBJECT)):(s=y(s),void i(s).then(function(){for(;;)if(t=e.shift(),r=typeof t,"string"!==r||u?"string"!==r||!u||"_rev"in s?"object"===r&&(n=y(t)):s._rev=t:(s._id=t,u=!0),!e.length)break;n=n||{},x.invalidIdError(s._id);var i=[];n&&"undefined"!=typeof n.new_edits&&i.push("new_edits="+n.new_edits),i=i.join("&"),""!==i&&(i="?"+i);var l={headers:y(T.headers),method:"PUT",url:a(T,o(s._id))+i,body:s};return v.resolve().then(function(){var e=s._attachments&&Object.keys(s._attachments).filter(function(e){return!s._attachments[e].stub}).length;if(e){var t=S(s);l.body=t.body,l.processData=!1,l.headers=h.extend(l.headers,t.headers)}})["catch"](function(){throw new Error("Did you forget to base64-encode an attachment?")}).then(function(){return c(l)}).then(function(e){e.ok=!0,f(null,e)})})["catch"](f))})),_.post=h.adapterFun("post",function(e,t,r){return"function"==typeof t&&(r=t,t={}),t=y(t),"object"!=typeof e?r(b.error(b.NOT_AN_OBJECT)):("_id"in e||(e._id=h.uuid()),void _.put(e,t,function(e,t){return e?r(e):(t.ok=!0,void r(null,t))}))}),_._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,v.all(e.docs.map(i)).then(function(){r({headers:y(T.headers),method:"POST",url:a(T,"_bulk_docs"),body:e},function(e,t){return e?n(e):(t.forEach(function(e){e.ok=!0}),void n(null,t))})})["catch"](n)},_.allDocs=h.adapterFun("allDocs",function(e,t){"function"==typeof e&&(t=e,e={}),e=y(e);var r,o=[],i="GET";if(e.conflicts&&o.push("conflicts=true"),e.descending&&o.push("descending=true"),e.include_docs&&o.push("include_docs=true"),e.attachments&&o.push("attachments=true"),e.key&&o.push("key="+encodeURIComponent(JSON.stringify(e.key))),e.startkey&&o.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&o.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),"undefined"!=typeof e.inclusive_end&&o.push("inclusive_end="+!!e.inclusive_end),"undefined"!=typeof e.limit&&o.push("limit="+e.limit),"undefined"!=typeof e.skip&&o.push("skip="+e.skip),o=o.join("&"),""!==o&&(o="?"+o),"undefined"!=typeof e.keys){var s="keys="+encodeURIComponent(JSON.stringify(e.keys));s.length+o.length+1<=l?o+=(-1!==o.indexOf("?")?"&":"?")+s:(i="POST",r=JSON.stringify({keys:e.keys}))}c({headers:y(T.headers),method:i,url:a(T,"_all_docs"+o),body:r}).then(function(r){e.include_docs&&e.attachments&&e.binary&&r.rows.forEach(n),t(null,r)})["catch"](t)}),_._changes=function(e){var t="batch_size"in e?e.batch_size:f;e=y(e),e.timeout=e.timeout||O.timeout||3e4;var o,i={timeout:e.timeout-5e3},s="undefined"!=typeof e.limit?e.limit:!1;o="returnDocs"in e?e.returnDocs:!0;var u=s;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter,"_view"===e.filter&&e.view&&"string"==typeof e.view&&(i.view=e.view)),e.query_params&&"object"==typeof e.query_params)for(var c in e.query_params)e.query_params.hasOwnProperty(c)&&(i[c]=e.query_params[c]);var d,p="GET";if(e.doc_ids){i.filter="_doc_ids";var v=JSON.stringify(e.doc_ids);v.length<l?i.doc_ids=v:(p="POST",d={doc_ids:e.doc_ids})}if(e.continuous&&_._useSSE)return _.sse(e,i,o);var m,g,w=function(n,o){if(!e.aborted){i.since=n,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?s&&(i.limit=u):i.limit=!s||u>t?t:u;var c="?"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&"),f={headers:y(T.headers),method:p,url:a(T,"_changes"+c),timeout:e.timeout,body:d};g=n,e.aborted||(m=r(f,o))}},S=10,E=0,x={results:[]},k=function(r,i){if(!e.aborted){var a=0;if(i&&i.results){a=i.results.length,x.last_seq=i.last_seq;var c={};c.query=e.query_params,i.results=i.results.filter(function(t){u--;var r=h.filterChange(e)(t);return r&&(e.include_docs&&e.attachments&&e.binary&&n(t),o&&x.results.push(t),e.onChange(t)),r})}else if(r)return e.aborted=!0,void h.call(e.complete,r);i&&i.last_seq&&(g=i.last_seq);var f=s&&0>=u||i&&t>a||e.descending;if((!e.continuous||s&&0>=u)&&f)h.call(e.complete,null,x);else{r?E+=1:E=0;var l=1<<E,d=S*l,p=e.maximumWait||3e4;if(d>p)return void h.call(e.complete,r||b.error(b.UNKNOWN_ERROR));setTimeout(function(){w(g,k)},d)}}};return w(e.since||0,k),{cancel:function(){e.aborted=!0,m&&m.abort()}}},_.sse=function(e,t,r){function n(t){var n=JSON.parse(t.data);r&&c.results.push(n),c.last_seq=n.seq,h.call(e.onChange,n)}function o(t){return u.removeEventListener("message",n,!1),l===!1?(_._useSSE=!1,void(f=_._changes(e))):(u.close(),void h.call(e.complete,t))}t.feed="eventsource",t.since=e.since||0,t.limit=e.limit,delete t.timeout;var i="?"+Object.keys(t).map(function(e){return e+"="+t[e]}).join("&"),s=a(T,"_changes"+i),u=new EventSource(s),c={results:[],last_seq:!1},f=!1,l=!1;return u.addEventListener("message",n,!1),u.onopen=function(){l=!0},u.onerror=o,{cancel:function(){return f?f.cancel():(u.removeEventListener("message",n,!1),void u.close())}}},_._useSSE=!1,_.revsDiff=h.adapterFun("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),r({headers:y(T.headers),method:"POST",url:a(T,"_revs_diff"),body:JSON.stringify(e)},n)}),_._close=function(e){e()},_._destroy=function(t){r({url:a(T,""),method:"DELETE",headers:y(T.headers)},function(r,n){return r?(_.emit("error",r),t(r)):(_.emit("destroyed"),_.constructor.emit("destroyed",e.name),void t(null,n))})}}var f=25,l=1800,d=e("../../deps/binary/binaryStringToBlobOrBuffer"),p=e("../../deps/binary/base64StringToBlobOrBuffer"),h=e("../../utils"),v=h.Promise,y=h.clone,_=e("../../deps/binary/base64"),m=_.btoa,g=_.atob,b=e("../../deps/errors"),w=e("debug")("pouchdb:http"),S=e("../../deps/ajax/multipart"),E=e("../../deps/binary/blobOrBufferToBase64"),x=e("../../deps/docs/parseDoc");c.valid=function(){return!0},t.exports=c},{"../../deps/ajax/multipart":105,"../../deps/binary/base64":109,"../../deps/binary/base64StringToBlobOrBuffer":110,"../../deps/binary/binaryStringToBlobOrBuffer":112,"../../deps/binary/blobOrBufferToBase64":114,"../../deps/docs/parseDoc":123,"../../deps/errors":129,"../../utils":160,debug:163}],86:[function(e,t,r){"use strict";function n(e,t,r,n,o){try{if(e&&t)return o?IDBKeyRange.bound(t,e,!r,!1):IDBKeyRange.bound(e,t,!1,!r);if(e)return o?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return o?IDBKeyRange.lowerBound(t,!r):IDBKeyRange.upperBound(t,!r);if(n)return IDBKeyRange.only(n)}catch(i){return{error:i}}return null}function o(e,t,r,n){return"DataError"===r.name&&0===r.code?n(null,{total_rows:e._meta.docCount,offset:t.skip,rows:[]}):void n(a.error(a.IDB_ERROR,r.name,r.message))}function i(e,t,r,i){function a(e,i){function a(t,r,n){var o=t.id+"::"+n;L.get(o).onsuccess=function(n){r.doc=p(n.target.result),e.conflicts&&(r.doc._conflicts=s.collectConflicts(t)),v(r.doc,e,j)}}function u(t,r,n){var o={id:n.id,key:n.id,value:{rev:r}},i=n.deleted;if("ok"===e.deleted)C.push(o),i?(o.value.deleted=!0,o.doc=null):e.include_docs&&a(n,o,r);else if(!i&&E--<=0&&(C.push(o),e.include_docs&&a(n,o,r),0===--x))return;t["continue"]()}function c(e){N=t._meta.docCount;var r=e.target.result;if(r){var n=h(r.value),o=n.winningRev;u(r,o,n)}}function m(){i(null,{total_rows:N,offset:e.skip,rows:C})}function g(){e.attachments?y(C,e.binary).then(m):m()}var b="startkey"in e?e.startkey:!1,w="endkey"in e?e.endkey:!1,S="key"in e?e.key:!1,E=e.skip||0,x="number"==typeof e.limit?e.limit:-1,T=e.inclusive_end!==!1,k="descending"in e&&e.descending?"prev":null,O=n(b,w,T,S,k);if(O&&O.error)return o(t,e,O.error,i);var I=[d,l];e.attachments&&I.push(f);var A=_(r,I,"readonly");if(A.error)return i(A.error);var j=A.txn,D=j.objectStore(d),q=j.objectStore(l),R=k?D.openCursor(O,k):D.openCursor(O),L=q.index("_doc_id_rev"),C=[],N=0;j.oncomplete=g,R.onsuccess=c}function u(e,r){return 0===e.limit?r(null,{total_rows:t._meta.docCount,offset:e.skip,rows:[]}):void a(e,r)}u(e,i)}var s=e("../../merge"),a=e("../../deps/errors"),u=e("./utils"),c=e("./constants"),f=c.ATTACH_STORE,l=c.BY_SEQ_STORE,d=c.DOC_STORE,p=u.decodeDoc,h=u.decodeMetadata,v=u.fetchAttachmentsIfNecessary,y=u.postProcessAttachments,_=u.openTransactionSafely;t.exports=i},{"../../deps/errors":129,"../../merge":149,"./constants":89,"./utils":91}],87:[function(e,t,r){"use strict";function n(e,t){return new o.Promise(function(r,n){var s=i([""],{type:"image/png"});e.objectStore(a).put(s,"key"),e.oncomplete=function(){var e=t.transaction([a],"readwrite"),i=e.objectStore(a).get("key");i.onerror=n,i.onsuccess=function(e){var t=e.target.result,n=URL.createObjectURL(t);o.ajax({url:n,cache:!0,binary:!0},function(e,t){e&&405===e.status?r(!0):(r(!(!t||"image/png"!==t.type)),e&&404===e.status&&o.explain404("PouchDB is just detecting blob URL support.")),URL.revokeObjectURL(n)})}}})["catch"](function(){return!1})}var o=e("../../utils"),i=e("../../deps/binary/blob"),s=e("./constants"),a=s.DETECT_BLOB_SUPPORT_STORE;t.exports=n},{"../../deps/binary/blob":113,"../../utils":160,"./constants":89}],88:[function(e,t,r){"use strict";function n(e,t,r,n,c,f){function S(){var e=[h,p,d,y,v,l],t=w(n,e,"readwrite");return t.error?f(t.error):(L=t.txn,L.onerror=b(f),L.ontimeout=b(f),L.oncomplete=T,C=L.objectStore(h),N=L.objectStore(p),$=L.objectStore(d),M=L.objectStore(l),void O(function(e){return e?(H=!0,f(e)):void x()}))}function E(){a(P,r,W,L,J,I,t)}function x(){function e(){++r===P.length&&E()}function t(t){var r=m(t.target.result);r&&W.set(r.id,r),e()}if(P.length)for(var r=0,n=0,o=P.length;o>n;n++){var i=P[n];if(i._id&&u(i._id))e();else{var s=C.get(i.metadata.id);s.onsuccess=t}}}function T(){H||(c.notify(r._meta.name),r._meta.docCount+=z,f(null,J))}function k(e,t){var r=$.get(e);r.onsuccess=function(r){if(r.target.result)t();else{var n=i.error(i.MISSING_STUB,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}function O(e){function t(){++o===r.length&&e(n)}var r=[];if(P.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,o=0;r.forEach(function(e){k(e,function(e){e&&!n&&(n=e),t()})})}function I(e,t,r,n,o,i,s,a){z+=i;var u=e.data;u._id=e.metadata.id,u._rev=e.metadata.rev,n&&(u._deleted=!0);var c=u._attachments&&Object.keys(u._attachments).length;return c?D(e,t,r,o,s,a):void j(e,t,r,o,s,a)}function A(e){var t=o.compactTree(e.metadata);_(t,e.metadata.id,L)}function j(e,t,n,o,i,s){function a(i){o&&r.auto_compaction&&A(e),l.seq=i.target.result,delete l.rev;var s=g(l,t,n),a=C.put(s);a.onsuccess=c}function u(e){e.preventDefault(),e.stopPropagation();var t=N.index("_doc_id_rev"),r=t.getKey(f._doc_id_rev);r.onsuccess=function(e){var t=N.put(f,e.target.result);t.onsuccess=a}}function c(){J[i]={ok:!0,id:l.id,rev:t},W.set(e.metadata.id,e.metadata),q(e,l.seq,s)}var f=e.data,l=e.metadata;f._doc_id_rev=l.id+"::"+l.rev,delete f._id,delete f._rev;var d=N.put(f);d.onsuccess=a,d.onerror=u}function D(e,t,r,n,o,i){function s(){c===f.length&&j(e,t,r,n,o,i)}function a(){c++,s()}var u=e.data,c=0,f=Object.keys(u._attachments);f.forEach(function(t){var r=e.data._attachments[t];if(r.stub)c++,s();else{var n=r.data;delete r.data;var o=r.digest;R(o,n,a)}})}function q(e,t,r){function n(){++i===s.length&&r()}function o(r){var o=e.data._attachments[r].digest,i=M.put({seq:t,digestSeq:o+"::"+t});i.onsuccess=n,i.onerror=function(e){e.preventDefault(),e.stopPropagation(),n()}}var i=0,s=Object.keys(e.data._attachments||{});if(!s.length)return r();for(var a=0;a<s.length;a++)o(s[a])}function R(e,t,r){var n=$.count(e);n.onsuccess=function(n){var o=n.target.result;if(o)return r();var i={digest:e,body:t},s=$.put(i);s.onsuccess=r}}for(var L,C,N,$,M,B,P=e.docs,z=0,F=0,U=P.length;U>F;F++){var K=P[F];K._id&&u(K._id)||(K=P[F]=o.parseDoc(K,t.new_edits),K.error&&!B&&(B=K))}if(B)return f(B);var J=new Array(P.length),W=new o.Map,H=!1,V=r._meta.blobSupport?"blob":"base64";s(P,V,function(e){return e?f(e):void S()})}var o=e("../../utils"),i=e("../../deps/errors"),s=e("../../deps/docs/preprocessAttachments"),a=e("../../deps/docs/processDocs"),u=e("../../deps/docs/isLocalId"),c=e("./utils"),f=e("./constants"),l=f.ATTACH_AND_SEQ_STORE,d=f.ATTACH_STORE,p=f.BY_SEQ_STORE,h=f.DOC_STORE,v=f.LOCAL_STORE,y=f.META_STORE,_=c.compactRevs,m=c.decodeMetadata,g=c.encodeMetadata,b=c.idbError,w=c.openTransactionSafely;t.exports=n},{"../../deps/docs/isLocalId":120,"../../deps/docs/preprocessAttachments":124,"../../deps/docs/processDocs":125,"../../deps/errors":129,"../../utils":160,"./constants":89,"./utils":91}],89:[function(e,t,r){"use strict";r.ADAPTER_VERSION=5,r.DOC_STORE="document-store",r.BY_SEQ_STORE="by-sequence",r.ATTACH_STORE="attach-store",r.ATTACH_AND_SEQ_STORE="attach-seq-store",r.META_STORE="meta-store",r.LOCAL_STORE="local-store",r.DETECT_BLOB_SUPPORT_STORE="detect-blob-support"},{}],90:[function(e,t,r){(function(r){"use strict";function n(e,t){var r=this;L.queue.push({action:function(t){o(r,e,t)},callback:t}),T()}function o(e,t,o){function l(e){var t=e.createObjectStore(S,{keyPath:"id"});e.createObjectStore(b,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(g,{keyPath:"digest"}),e.createObjectStore(x,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(w),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(E,{keyPath:"_id"});var r=e.createObjectStore(m,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}function d(e,t){var r=e.objectStore(S);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var o=n.value,i=u(o);o.deletedOrLocal=i?"1":"0",r.put(o),n["continue"]()}else t()}}function T(e){e.createObjectStore(E,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function L(e,t){var r=e.objectStore(E),n=e.objectStore(S),o=e.objectStore(b),i=n.openCursor();i.onsuccess=function(e){var i=e.target.result;if(i){var s=i.value,u=s.id,f=c(u),l=a.winningRev(s);if(f){var d=u+"::"+l,p=u+"::",h=u+"::~",v=o.index("_doc_id_rev"),y=IDBKeyRange.bound(p,h,!1,!1),_=v.openCursor(y);_.onsuccess=function(e){if(_=e.target.result){var t=_.value;t._doc_id_rev===d&&r.put(t),o["delete"](_.primaryKey),_["continue"]()}else n["delete"](i.primaryKey),i["continue"]()}}else i["continue"]()}else t&&t()}}function $(e){var t=e.createObjectStore(m,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function M(e,t){var r=e.objectStore(b),n=e.objectStore(g),o=e.objectStore(m),i=n.count();i.onsuccess=function(e){var n=e.target.result;return n?void(r.openCursor().onsuccess=function(e){var r=e.target.result;if(!r)return t();for(var n=r.value,i=r.primaryKey,s=Object.keys(n._attachments||{}),a={},u=0;u<s.length;u++){var c=n._attachments[s[u]];a[c.digest]=!0}var f=Object.keys(a);for(u=0;u<f.length;u++){var l=f[u];o.put({seq:i,digestSeq:l+"::"+i})}r["continue"]()}):t()}}function B(e){function t(e){return e.data?I(e):(e.deleted="1"===e.deletedOrLocal,e)}var r=e.objectStore(b),n=e.objectStore(S),o=n.openCursor();o.onsuccess=function(e){function o(){var e=u.id+"::",t=u.id+"::￿",n=r.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t)),o=0;n.onsuccess=function(e){var t=e.target.result;if(!t)return u.seq=o,i();var r=t.primaryKey;r>o&&(o=r),t["continue"]()}}function i(){var e=A(u,u.winningRev,u.deleted),t=n.put(e);t.onsuccess=function(){s["continue"]()}}var s=e.target.result;if(s){var u=t(s.value);return u.winningRev=u.winningRev||a.winningRev(u),u.seq?i():void o()}}}var P=t.name,z=null;e._meta=null,e.type=function(){return"idb"},e._id=s.toPromise(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(t,r,o){p(t,r,e,z,n.Changes,o)},e._get=function(e,t,r){function n(){r(a,{doc:o,metadata:i,ctx:c})}var o,i,a,c;if(t=s.clone(t),t.ctx)c=t.ctx;else{var l=C(z,[S,b,g],"readonly");if(l.error)return r(l.error);c=l.txn}c.objectStore(S).get(e).onsuccess=function(e){if(i=I(e.target.result),!i)return a=f.error(f.MISSING_DOC,"missing"),n();if(u(i)&&!t.rev)return a=f.error(f.MISSING_DOC,"deleted"),n();var r=c.objectStore(b),s=t.rev||i.winningRev,l=i.id+"::"+s;r.index("_doc_id_rev").get(l).onsuccess=function(e){return o=e.target.result,o&&(o=O(o)),o?void n():(a=f.error(f.MISSING_DOC,"missing"),n())}}},e._getAttachment=function(e,t,r){var n;if(t=s.clone(t),t.ctx)n=t.ctx;else{var o=C(z,[S,b,g],"readonly");if(o.error)return r(o.error);n=o.txn}var i=e.digest,a=e.content_type;n.objectStore(g).get(i).onsuccess=function(e){var n=e.target.result.body;R(n,a,t.binary,function(e){r(null,e)})}},e._info=function(t){if(null===z||!N[P]){var r=new Error("db isn't open");return r.id="idbNull",t(r)}var n,o,i=C(z,[b],"readonly");if(i.error)return t(i.error);var s=i.txn,a=s.objectStore(b).openCursor(null,"prev");a.onsuccess=function(t){var r=t.target.result;n=r?r.key:0,o=e._meta.docCount},s.oncomplete=function(){t(null,{doc_count:o,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(t,r){h(t,e,z,r)},e._changes=function(t){function r(e){function r(){return a.seq!==s?e["continue"]():(l=s,a.winningRev===i._rev?o(i):void n())}function n(){var e=i._id+"::"+a.winningRev,t=v.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,e+"￿"));t.onsuccess=function(e){o(O(e.target.result.value))}}function o(r){var n=t.processChange(r,a,t);n.seq=a.seq,w(n)&&(m++,p&&_.push(n),t.attachments&&t.include_docs?j(r,t,h,function(){q([n],t.binary).then(function(){t.onChange(n)})}):t.onChange(n)),m!==d&&e["continue"]()}var i=O(e.value),s=e.key;if(c&&!c.has(i._id))return e["continue"]();var a;return(a=E.get(i._id))?r():void(y.get(i._id).onsuccess=function(e){a=I(e.target.result),E.set(i._id,a),r()})}function o(e){var t=e.target.result;t&&r(t)}function i(){var e=[S,b];t.attachments&&e.push(g);var r=C(z,e,"readonly");if(r.error)return t.complete(r.error);h=r.txn,h.onerror=D(t.complete),h.oncomplete=a,v=h.objectStore(b),y=h.objectStore(S);var n;n=f?v.openCursor(null,f):v.openCursor(IDBKeyRange.lowerBound(t.since,!0)),n.onsuccess=o}function a(){function e(){t.complete(null,{results:_,last_seq:l})}!t.continuous&&t.attachments?q(_).then(e):e()}if(t=s.clone(t),t.continuous){var u=P+":"+s.uuid();return n.Changes.addListener(P,u,e,t),n.Changes.notify(P),{cancel:function(){n.Changes.removeListener(P,u)}}}var c=t.doc_ids&&new s.Set(t.doc_ids),f=t.descending?"prev":null;t.since=t.since||0;var l=t.since,d="limit"in t?t.limit:-1;0===d&&(d=1);var p;p="returnDocs"in t?t.returnDocs:!0;var h,v,y,_=[],m=0,w=s.filterChange(t),E=new s.Map;i()},e._close=function(e){return null===z?e(f.error(f.NOT_OPEN)):(z.close(),delete N[P],z=null,void e())},e._getRevisionTree=function(e,t){var r=C(z,[S],"readonly");if(r.error)return t(r.error);var n=r.txn,o=n.objectStore(S).get(e);o.onsuccess=function(e){var r=I(e.target.result);r?t(null,r.rev_tree):t(f.error(f.MISSING_DOC))}},e._doCompaction=function(e,t,r){var n=[S,b,g,m],o=C(z,n,"readwrite");if(o.error)return r(o.error);var i=o.txn,u=i.objectStore(S);u.get(e).onsuccess=function(r){var n=I(r.target.result);a.traverseRevTree(n.rev_tree,function(e,r,n,o,i){var s=r+"-"+n;-1!==t.indexOf(s)&&(i.status="missing")}),k(t,e,i);var o=n.winningRev,s=n.deleted;i.objectStore(S).put(A(n,o,s))},i.onerror=D(r),i.oncomplete=function(){s.call(r)}},e._getLocal=function(e,t){var r=C(z,[E],"readonly");if(r.error)return t(r.error);var n=r.txn,o=n.objectStore(E).get(e);o.onerror=D(t),o.onsuccess=function(e){var r=e.target.result;r?(delete r._doc_id_rev,t(null,r)):t(f.error(f.MISSING_DOC))}},e._putLocal=function(e,t,r){"function"==typeof t&&(r=t,t={}),delete e._revisions;var n=e._rev,o=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var i,s=t.ctx;if(!s){var a=C(z,[E],"readwrite");if(a.error)return r(a.error);s=a.txn,s.onerror=D(r),s.oncomplete=function(){i&&r(null,i)}}var u,c=s.objectStore(E);n?(u=c.get(o),u.onsuccess=function(o){var s=o.target.result;if(s&&s._rev===n){var a=c.put(e);a.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,i)}}else r(f.error(f.REV_CONFLICT))}):(u=c.add(e),u.onerror=function(e){r(f.error(f.REV_CONFLICT)),e.preventDefault(),e.stopPropagation()},u.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&r(null,i)})},e._removeLocal=function(e,t,r){"function"==typeof t&&(r=t,t={});var n=t.ctx;if(!n){var o=C(z,[E],"readwrite");if(o.error)return r(o.error);n=o.txn,n.oncomplete=function(){i&&r(null,i)}}var i,s=e._id,a=n.objectStore(E),u=a.get(s);u.onerror=D(r),u.onsuccess=function(n){var o=n.target.result;o&&o._rev===e._rev?(a["delete"](s),i={ok:!0,id:s,rev:"0-0"},t.ctx&&r(null,i)):r(f.error(f.MISSING_DOC))}},e._destroy=function(e){n.Changes.removeAllListeners(P),n.openReqList[P]&&n.openReqList[P].result&&(n.openReqList[P].result.close(),delete N[P]);var t=indexedDB.deleteDatabase(P);t.onsuccess=function(){n.openReqList[P]&&(n.openReqList[P]=null),y()&&P in localStorage&&delete localStorage[P],e(null,{ok:!0})},t.onerror=D(e)};var F=N[P];if(F)return z=F.idb,e._meta=F.global,void r.nextTick(function(){o(null,e)});var U=indexedDB.open(P,_);"openReqList"in n||(n.openReqList={}),n.openReqList[P]=U,U.onupgradeneeded=function(e){function t(){var e=o[i-1];i++,e&&e(n,t)}var r=e.target.result;if(e.oldVersion<1)return l(r);var n=e.currentTarget.transaction;e.oldVersion<3&&T(r),e.oldVersion<4&&$(r);var o=[d,L,M,B],i=e.oldVersion;t()},U.onsuccess=function(t){z=t.target.result,z.onversionchange=function(){z.close(),delete N[P]},z.onabort=function(){z.close(),delete N[P]};var r=z.transaction([x,w,S],"readwrite"),n=r.objectStore(x).get(x),a=null,u=null,c=null;n.onsuccess=function(t){var n=function(){null!==a&&null!==u&&null!==c&&(e._meta={name:P,instanceId:c,blobSupport:a,docCount:u},N[P]={idb:z,global:e._meta},o(null,e))},f=t.target.result||{id:x};P+"_id"in f?(c=f[P+"_id"],n()):(c=s.uuid(),f[P+"_id"]=c,r.objectStore(x).put(f).onsuccess=function(){n()}),i||(i=v(r,z)),i.then(function(e){a=e,n()});var l=r.objectStore(S).index("deletedOrLocal");l.count(IDBKeyRange.only("0")).onsuccess=function(e){
u=e.target.result,n()}}},U.onerror=function(e){var t="Failed to open indexedDB, are you in private browsing mode?";console.error(t),o(f.error(f.IDB_ERROR,t))}}var i,s=e("../../utils"),a=e("../../merge"),u=e("../../deps/docs/isDeleted"),c=e("../../deps/docs/isLocalId"),f=e("../../deps/errors"),l=e("./utils"),d=e("./constants"),p=e("./bulkDocs"),h=e("./allDocs"),v=e("./blobSupport"),y=e("../../deps/env/hasLocalStorage"),_=d.ADAPTER_VERSION,m=d.ATTACH_AND_SEQ_STORE,g=d.ATTACH_STORE,b=d.BY_SEQ_STORE,w=d.DETECT_BLOB_SUPPORT_STORE,S=d.DOC_STORE,E=d.LOCAL_STORE,x=d.META_STORE,T=l.applyNext,k=l.compactRevs,O=l.decodeDoc,I=l.decodeMetadata,A=l.encodeMetadata,j=l.fetchAttachmentsIfNecessary,D=l.idbError,q=l.postProcessAttachments,R=l.readBlobData,L=l.taskQueue,C=l.openTransactionSafely,N={};n.valid=function(){var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!e&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},n.Changes=new s.Changes,t.exports=n}).call(this,e("_process"))},{"../../deps/docs/isDeleted":119,"../../deps/docs/isLocalId":120,"../../deps/env/hasLocalStorage":127,"../../deps/errors":129,"../../merge":149,"../../utils":160,"./allDocs":86,"./blobSupport":87,"./bulkDocs":88,"./constants":89,"./utils":91,_process:81}],91:[function(e,t,r){(function(t){"use strict";function n(e,t,r){try{e.apply(t,r)}catch(n){"undefined"!=typeof PouchDB&&PouchDB.emit("error",n)}}var o=e("../../deps/errors"),i=e("../../utils"),s=e("../../deps/binary/base64"),a=s.btoa,u=e("./constants"),c=e("../../deps/binary/readAsBinaryString"),f=e("../../deps/binary/base64StringToBlobOrBuffer"),l=e("../../deps/binary/blob");r.taskQueue={running:!1,queue:[]},r.applyNext=function(){if(!r.taskQueue.running&&r.taskQueue.queue.length){r.taskQueue.running=!0;var e=r.taskQueue.queue.shift();e.action(function(o,i){n(e.callback,this,[o,i]),r.taskQueue.running=!1,t.nextTick(r.applyNext)})}},r.idbError=function(e){return function(t){var r=t.target&&t.target.error&&t.target.error.name||t.target;e(o.error(o.IDB_ERROR,r,t.type))}},r.encodeMetadata=function(e,t,r){return{data:i.safeJsonStringify(e),winningRev:t,deletedOrLocal:r?"1":"0",seq:e.seq,id:e.id}},r.decodeMetadata=function(e){if(!e)return null;var t=i.safeJsonParse(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t},r.decodeDoc=function(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e},r.readBlobData=function(e,t,r,n){r?n(e?"string"!=typeof e?e:f(e,t):l([""],{type:t})):e?"string"!=typeof e?c(e,function(e){n(a(e))}):n(e):n("")},r.fetchAttachmentsIfNecessary=function(e,t,r,n){function o(){++a===s.length&&n&&n()}function i(e,t){var n=e._attachments[t],i=n.digest,s=r.objectStore(u.ATTACH_STORE).get(i);s.onsuccess=function(e){n.body=e.target.result.body,o()}}var s=Object.keys(e._attachments||{});if(!s.length)return n&&n();var a=0;s.forEach(function(r){t.attachments&&t.include_docs?i(e,r):(e._attachments[r].stub=!0,o())})},r.postProcessAttachments=function(e,t){return i.Promise.all(e.map(function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return i.Promise.all(n.map(function(n){var o=e.doc._attachments[n];if("body"in o){var s=o.body,a=o.content_type;return new i.Promise(function(u){r.readBlobData(s,a,t,function(t){e.doc._attachments[n]=i.extend(i.pick(o,["digest","content_type"]),{data:t}),u()})})}}))}}))},r.compactRevs=function(e,t,r){function n(){f--,f||o()}function o(){i.length&&i.forEach(function(e){var t=c.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::￿",!1,!1));t.onsuccess=function(t){var r=t.target.result;r||a["delete"](e)}})}var i=[],s=r.objectStore(u.BY_SEQ_STORE),a=r.objectStore(u.ATTACH_STORE),c=r.objectStore(u.ATTACH_AND_SEQ_STORE),f=e.length;e.forEach(function(e){var r=s.index("_doc_id_rev"),o=t+"::"+e;r.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return n();s["delete"](t);var r=c.index("seq").openCursor(IDBKeyRange.only(t));r.onsuccess=function(e){var t=e.target.result;if(t){var r=t.value.digestSeq.split("::")[0];i.push(r),c["delete"](t.primaryKey),t["continue"]()}else n()}}})},r.openTransactionSafely=function(e,t,r){try{return{txn:e.transaction(t,r)}}catch(n){return{error:n}}}}).call(this,e("_process"))},{"../../deps/binary/base64":109,"../../deps/binary/base64StringToBlobOrBuffer":110,"../../deps/binary/blob":113,"../../deps/binary/readAsBinaryString":117,"../../deps/errors":129,"../../utils":160,"./constants":89,_process:81}],92:[function(e,t,r){"use strict";function n(e,t,r,n,f,g){function b(){return q?g(q):(f.notify(r._name),r._docCount=-1,void g(null,R))}function w(e,t){var r="SELECT count(*) as cnt FROM "+p+" WHERE digest=?";D.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var o=i.error(i.MISSING_STUB,"unknown stub attachment with digest "+e);t(o)}else t()})}function S(e){function t(){++o===r.length&&e(n)}var r=[];if(A.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,o=0;r.forEach(function(e){w(e,function(e){e&&!n&&(n=e),t()})})}function E(e,t,n,i,s,a,u,c){function f(){function t(e,t){function n(){return++i===s.length&&t(),!1}function o(t){var o="INSERT INTO "+h+" (digest, seq) VALUES (?,?)",i=[r._attachments[t].digest,e];D.executeSql(o,i,n,n)}var i=0,s=Object.keys(r._attachments||{});if(!s.length)return t();for(var a=0;a<s.length;a++)o(s[a])}var r=e.data,n=i?1:0,o=r._id,s=r._rev,a=y(r),u="INSERT INTO "+d+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[o,s,a,n];D.executeSql(u,c,function(e,r){var n=r.insertId;t(n,function(){b(e,n)})},function(){var e=v("seq",d,null,"doc_id=? AND rev=?");return D.executeSql(e,[o,s],function(e,r){var i=r.rows.item(0).seq,u="UPDATE "+d+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[a,n,o,s];e.executeSql(u,c,function(e){t(i,function(){b(e,i)})})}),!1})}function p(e){w||(e?(w=e,c(w)):S===E.length&&f())}function m(e){S++,p(e)}function g(){if(s&&r.auto_compaction){var t=e.metadata.id,n=o.compactTree(e.metadata);_(n,t,D)}}function b(r,n){g(),e.metadata.seq=n,delete e.metadata.rev;var i=s?"UPDATE "+l+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+d+" WHERE doc_id="+l+".id AND rev=?) WHERE id=?":"INSERT INTO "+l+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",a=o.safeJsonStringify(e.metadata),f=e.metadata.id,p=s?[a,n,t,f]:[f,n,n,a];r.executeSql(i,p,function(){R[u]={ok:!0,id:e.metadata.id,rev:t},L.set(f,e.metadata),c()})}var w=null,S=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var E=Object.keys(e.data._attachments||{});i&&(e.data._deleted=!0),E.forEach(function(t){var r=e.data._attachments[t];if(r.stub)S++,p();else{var n=r.data;delete r.data;var o=r.digest;k(o,n,m)}}),E.length||f()}function x(){u(A,r,L,D,R,E,t)}function T(e){function t(){++r===A.length&&e()}if(!A.length)return e();var r=0;A.forEach(function(e){if(e._id&&a(e._id))return t();var r=e.metadata.id;D.executeSql("SELECT json FROM "+l+" WHERE id = ?",[r],function(e,n){if(n.rows.length){var i=o.safeJsonParse(n.rows.item(0).json);L.set(r,i)}t()})})}function k(e,t,r){var n="SELECT digest FROM "+p+" WHERE digest=?";D.executeSql(n,[e],function(o,i){return i.rows.length?r():(n="INSERT INTO "+p+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(n,[e,c.escapeBlob(t)],function(){r()},function(){return r(),!1}))})}var O=t.new_edits,I=e.docs,A=I.map(function(e){if(e._id&&a(e._id))return e;var t=o.parseDoc(e,O);return t}),j=A.filter(function(e){return e.error});if(j.length)return g(j[0]);var D,q,R=new Array(A.length),L=new o.Map;s(A,"binary",function(e){return e?g(e):void n.transaction(function(e){D=e,S(function(e){e?q=e:T(x)})},m(g),b)})}var o=e("../../utils"),i=e("../../deps/errors"),s=e("../../deps/docs/preprocessAttachments"),a=e("../../deps/docs/isLocalId"),u=e("../../deps/docs/processDocs"),c=e("./utils"),f=e("./constants"),l=f.DOC_STORE,d=f.BY_SEQ_STORE,p=f.ATTACH_STORE,h=f.ATTACH_AND_SEQ_STORE,v=c.select,y=c.stringifyDoc,_=c.compactRevs,m=c.unknownError;t.exports=n},{"../../deps/docs/isLocalId":120,"../../deps/docs/preprocessAttachments":124,"../../deps/docs/processDocs":125,"../../deps/errors":129,"../../utils":160,"./constants":93,"./utils":95}],93:[function(e,t,r){"use strict";function n(e){return"'"+e+"'"}r.ADAPTER_VERSION=7,r.DOC_STORE=n("document-store"),r.BY_SEQ_STORE=n("by-sequence"),r.ATTACH_STORE=n("attach-store"),r.LOCAL_STORE=n("local-store"),r.META_STORE=n("metadata-store"),r.ATTACH_AND_SEQ_STORE=n("attach-seq-store")},{}],94:[function(e,t,r){"use strict";function n(e,t,r,n,o){function s(){++c===u.length&&o&&o()}function a(e,o){var a=e._attachments[o],u={binary:t.binary,ctx:n};r._getAttachment(a,u,function(t,r){e._attachments[o]=i.extend(i.pick(a,["digest","content_type"]),{data:r}),s()})}var u=Object.keys(e._attachments||{});if(!u.length)return o&&o();var c=0;u.forEach(function(r){t.attachments&&t.include_docs?a(e,r):(e._attachments[r].stub=!0,s())})}function o(e,t){function r(){d()&&(window.localStorage["_pouch__websqldb_"+X._name]=!0),t(null,X)}function p(e,t){e.executeSql(L),e.executeSql("ALTER TABLE "+m+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(q),e.executeSql("ALTER TABLE "+_+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+_+" (local, id)");var r="SELECT "+_+".winningseq AS seq, "+_+".json AS metadata FROM "+m+" JOIN "+_+" ON "+m+".seq = "+_+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],o=[],i=0;i<r.rows.length;i++){var s=r.rows.item(i),c=s.seq,f=JSON.parse(s.metadata);a(f)&&n.push(c),u(f.id)&&o.push(f.id)}e.executeSql("UPDATE "+_+"SET local = 1 WHERE id IN "+E(o.length),o,function(){e.executeSql("UPDATE "+m+" SET deleted = 1 WHERE seq IN "+E(n.length),n,t)})})})})}function B(e,t){var r="CREATE TABLE IF NOT EXISTS "+b+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+_+".id AS id, "+m+".json AS data FROM "+m+" JOIN "+_+" ON "+m+".seq = "+_+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){function n(){if(!o.length)return t(e);var r=o.shift(),i=JSON.parse(r.data)._rev;e.executeSql("INSERT INTO "+b+" (id, rev, json) VALUES (?,?,?)",[r.id,i,r.data],function(e){e.executeSql("DELETE FROM "+_+" WHERE id=?",[r.id],function(e){e.executeSql("DELETE FROM "+m+" WHERE seq=?",[r.seq],function(){n()})})})}for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i));n()})})}function P(e,t){function r(r){function n(){if(!r.length)return t(e);var o=r.shift(),i=f(o.hex,Q),s=i.lastIndexOf("::"),a=i.substring(0,s),u=i.substring(s+2),c="UPDATE "+m+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(c,[a,u,i],function(){n()})}n()}var n="ALTER TABLE "+m+" ADD COLUMN doc_id";e.executeSql(n,[],function(e){var t="ALTER TABLE "+m+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(R,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+m;e.executeSql(t,[],function(e,t){for(var n=[],o=0;o<t.rows.length;o++)n.push(t.rows.item(o));r(n)})})})})}function z(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+g;e.executeSql(r,[],function(e,r){function n(){var r=k(M+", "+_+".id AS id",[_,m],$,null,_+".id ");r+=" LIMIT "+s+" OFFSET "+i,i+=s,e.executeSql(r,[],function(e,r){function o(e,t){var r=i[e]=i[e]||[];-1===r.indexOf(t)&&r.push(t)}if(!r.rows.length)return t(e);for(var i={},s=0;s<r.rows.length;s++)for(var a=r.rows.item(s),u=T(a.data,a.id,a.rev),c=Object.keys(u._attachments||{}),f=0;f<c.length;f++){var l=u._attachments[c[f]];o(l.digest,a.seq)}var d=[];if(Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(t){d.push([e,t])})}),!d.length)return n();var p=0;d.forEach(function(t){var r="INSERT INTO "+S+" (digest, seq) VALUES (?,?)";e.executeSql(r,t,function(){++p===d.length&&n()})})})}var o=r.rows.item(0).cnt;if(!o)return t(e);var i=0,s=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+S+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(N,[],function(e){e.executeSql(C,[],r)})})}function F(e,t){var r="ALTER TABLE "+g+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function U(e,t){var r="ALTER TABLE "+_+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+_+" SET max_seq=(SELECT MAX(seq) FROM "+m+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+_+" (max_seq)";e.executeSql(r,[],t)})})}function K(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,r){var n=r.rows.item(0).hex;Q=2===n.length?"UTF-8":"UTF-16",t()})}function J(){for(;ee.length>0;){var e=ee.pop();e(null,Y)}}function W(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+w+" (dbid, db_version INTEGER)",n="CREATE TABLE IF NOT EXISTS "+g+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",o="CREATE TABLE IF NOT EXISTS "+S+" (digest, seq INTEGER)",s="CREATE TABLE IF NOT EXISTS "+_+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",a="CREATE TABLE IF NOT EXISTS "+m+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",u="CREATE TABLE IF NOT EXISTS "+b+" (id UNIQUE, rev, json)";e.executeSql(n),e.executeSql(u),e.executeSql(o,[],function(){e.executeSql(C),e.executeSql(N)}),e.executeSql(s,[],function(){e.executeSql(L),e.executeSql(a,[],function(){e.executeSql(q),e.executeSql(R),e.executeSql(r,[],function(){var t="INSERT INTO "+w+" (db_version, dbid) VALUES (?,?)";Y=i.uuid();var r=[y,Y];e.executeSql(t,r,function(){J()})})})})}else{var c=function(){var r=y>t;r&&e.executeSql("UPDATE "+w+" SET db_version = "+y);var n="SELECT dbid FROM "+w;e.executeSql(n,[],function(e,t){Y=t.rows.item(0).dbid,J()})},f=[p,B,P,z,F,U,c],l=t,d=function(e){f[l-1](e,d),l++};d(e)}}function H(){te.transaction(function(e){K(e,function(){V(e)})},I(t),r)}function V(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+w;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+w,[],function(e,t){var r=t.rows.item(0).db_version;W(e,r)}):e.executeSql("ALTER TABLE "+w+" ADD COLUMN db_version INTEGER",[],function(){W(e,1)}):W(e,0)})}function G(e,t){if(-1!==X._docCount)return t(X._docCount);var r=k("COUNT("+_+".id) AS 'num'",[_,m],$,m+".deleted=0");e.executeSql(r,[],function(e,r){X._docCount=r.rows.item(0).num,t(X._docCount)})}var Q,X=this,Y=null,Z=A(e),ee=[];X._docCount=-1,X._name=e.name;var te=j({name:X._name,version:D,description:X._name,size:Z,location:e.location,createFromLocation:e.createFromLocation,androidDatabaseImplementation:e.androidDatabaseImplementation});return te?("function"!=typeof te.readTransaction&&(te.readTransaction=te.transaction),i.isCordova()?window.addEventListener(X._name+"_pouch",function re(){window.removeEventListener(X._name+"_pouch",re,!1),H()},!1):H(),X.type=function(){return"websql"},X._id=i.toPromise(function(e){e(null,Y)}),X._info=function(e){te.readTransaction(function(t){G(t,function(r){var n="SELECT MAX(seq) AS seq FROM "+m;t.executeSql(n,[],function(t,n){var o=n.rows.item(0).seq||0;e(null,{doc_count:r,update_seq:o,sqlite_plugin:te._sqlitePlugin,websql_encoding:Q})})})},I(e))},X._bulkDocs=function(e,t,r){v(e,t,X,te,o.Changes,r)},X._get=function(e,t,r){function n(){r(a,{doc:o,metadata:s,ctx:l})}t=i.clone(t);var o,s,a;if(!t.ctx)return void te.readTransaction(function(n){t.ctx=n,X._get(e,t,r)});var u,f,l=t.ctx;t.rev?(u=k(M,[_,m],_+".id="+m+".doc_id",[m+".doc_id=?",m+".rev=?"]),f=[e,t.rev]):(u=k(M,[_,m],$,_+".id=?"),f=[e]),l.executeSql(u,f,function(e,r){if(!r.rows.length)return a=c.error(c.MISSING_DOC,"missing"),n();var u=r.rows.item(0);return s=i.safeJsonParse(u.metadata),u.deleted&&!t.rev?(a=c.error(c.MISSING_DOC,"deleted"),n()):(o=T(u.data,s.id,u.rev),void n())})},X._allDocs=function(e,t){var r,o=[],a="startkey"in e?e.startkey:!1,u="endkey"in e?e.endkey:!1,c="key"in e?e.key:!1,f="descending"in e?e.descending:!1,l="limit"in e?e.limit:-1,d="skip"in e?e.skip:0,p=e.inclusive_end!==!1,h=[],v=[];if(c!==!1)v.push(_+".id = ?"),h.push(c);else if(a!==!1||u!==!1){if(a!==!1&&(v.push(_+".id "+(f?"<=":">=")+" ?"),h.push(a)),u!==!1){var y=f?">":"<";p&&(y+="="),v.push(_+".id "+y+" ?"),h.push(u)}c!==!1&&(v.push(_+".id = ?"),h.push(c))}"ok"!==e.deleted&&v.push(m+".deleted = 0"),te.readTransaction(function(t){G(t,function(a){if(r=a,0!==l){var u=k(M,[_,m],$,v,_+".id "+(f?"DESC":"ASC"));u+=" LIMIT "+l+" OFFSET "+d,t.executeSql(u,h,function(t,r){for(var a=0,u=r.rows.length;u>a;a++){var c=r.rows.item(a),f=i.safeJsonParse(c.metadata),l=f.id,d=T(c.data,l,c.rev),p=d._rev,h={id:l,key:l,value:{rev:p}};if(e.include_docs&&(h.doc=d,h.doc._rev=p,e.conflicts&&(h.doc._conflicts=s.collectConflicts(f)),n(h.doc,e,X,t)),c.deleted){if("ok"!==e.deleted)continue;h.value.deleted=!0,h.doc=null}o.push(h)}})}})},I(t),function(){t(null,{total_rows:r,offset:e.skip,rows:o})})},X._changes=function(e){function t(){var t=_+".json AS metadata, "+_+".max_seq AS maxSeq, "+m+".json AS winningDoc, "+m+".rev AS winningRev ",r=_+" JOIN "+m,o=_+".id="+m+".doc_id AND "+_+".winningseq="+m+".seq",l=["maxSeq > ?"],d=[e.since];e.doc_ids&&(l.push(_+".id IN "+E(e.doc_ids.length)),d=d.concat(e.doc_ids));var p="maxSeq "+(s?"DESC":"ASC"),h=k(t,r,o,l,p),v=i.filterChange(e);e.view||e.filter||(h+=" LIMIT "+a);var y=e.since||0;te.readTransaction(function(t){t.executeSql(h,d,function(t,r){function o(t){return function(){e.onChange(t)}}for(var s=0,l=r.rows.length;l>s;s++){var d=r.rows.item(s),p=i.safeJsonParse(d.metadata);y=d.maxSeq;var h=T(d.winningDoc,p.id,d.winningRev),_=e.processChange(h,p,e);if(_.seq=d.maxSeq,v(_)&&(f++,u&&c.push(_),e.attachments&&e.include_docs?n(h,e,X,t,o(_)):o(_)()),f===a)break}})},I(e.complete),function(){e.continuous||e.complete(null,{results:c,last_seq:y})})}if(e=i.clone(e),e.continuous){var r=X._name+":"+i.uuid();return o.Changes.addListener(X._name,r,X,e),o.Changes.notify(X._name),{cancel:function(){o.Changes.removeListener(X._name,r)}}}var s=e.descending;e.since=e.since&&!s?e.since:0;var a="limit"in e?e.limit:-1;0===a&&(a=1);var u;u="returnDocs"in e?e.returnDocs:!0;var c=[],f=0;t()},X._close=function(e){e()},X._getAttachment=function(e,t,r){var n,o=t.ctx,s=e.digest,a=e.content_type,u="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+g+" WHERE digest=?";o.executeSql(u,[s],function(e,o){var s=o.rows.item(0),u=s.escaped?h.unescapeBlob(s.body):f(s.body,Q);n=t.binary?l(u,a):i.btoa(u),r(null,n)})},X._getRevisionTree=function(e,t){te.readTransaction(function(r){var n="SELECT json AS metadata FROM "+_+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=i.safeJsonParse(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(c.error(c.MISSING_DOC))})})},X._doCompaction=function(e,t,r){return t.length?void te.transaction(function(r){var n="SELECT json AS metadata FROM "+_+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var o=i.safeJsonParse(n.rows.item(0).metadata);s.traverseRevTree(o.rev_tree,function(e,r,n,o,i){var s=r+"-"+n;-1!==t.indexOf(s)&&(i.status="missing")});var a="UPDATE "+_+" SET json = ? WHERE id = ?";r.executeSql(a,[i.safeJsonStringify(o),e])}),O(t,e,r)},I(r),function(){r()}):r()},X._getLocal=function(e,t){te.readTransaction(function(r){var n="SELECT json, rev FROM "+b+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var o=n.rows.item(0),i=T(o.json,e,o.rev);t(null,i)}else t(c.error(c.MISSING_DOC))})})},X._putLocal=function(e,t,r){function n(e){var n,f;i?(n="UPDATE "+b+" SET rev=?, json=? WHERE id=? AND rev=?",f=[o,u,s,i]):(n="INSERT INTO "+b+" (id, rev, json) VALUES (?,?,?)",f=[s,o,u]),e.executeSql(n,f,function(e,n){n.rowsAffected?(a={ok:!0,id:s,rev:o},t.ctx&&r(null,a)):r(c.error(c.REV_CONFLICT))},function(){return r(c.error(c.REV_CONFLICT)),!1})}"function"==typeof t&&(r=t,t={}),delete e._revisions;var o,i=e._rev,s=e._id;o=e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var a,u=x(e);t.ctx?n(t.ctx):te.transaction(n,I(r),function(){a&&r(null,a)})},X._removeLocal=function(e,t,r){function n(n){var i="DELETE FROM "+b+" WHERE id=? AND rev=?",s=[e._id,e._rev];n.executeSql(i,s,function(n,i){return i.rowsAffected?(o={ok:!0,id:e._id,rev:"0-0"},void(t.ctx&&r(null,o))):r(c.error(c.MISSING_DOC))})}"function"==typeof t&&(r=t,t={});var o;t.ctx?n(t.ctx):te.transaction(n,I(r),function(){o&&r(null,o)})},void(X._destroy=function(e){o.Changes.removeAllListeners(X._name),te.transaction(function(e){var t=[_,m,g,w,b,S];t.forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},I(e),function(){d()&&(delete window.localStorage["_pouch__websqldb_"+X._name],delete window.localStorage[X._name]),e(null,{ok:!0})})})):t(c.error(c.UNKNOWN_ERROR))}var i=e("../../utils"),s=e("../../merge"),a=e("../../deps/docs/isDeleted"),u=e("../../deps/docs/isLocalId"),c=e("../../deps/errors"),f=e("../../deps/parseHex"),l=e("../../deps/binary/binaryStringToBlobOrBuffer"),d=e("../../deps/env/hasLocalStorage"),p=e("./constants"),h=e("./utils"),v=e("./bulkDocs"),y=p.ADAPTER_VERSION,_=p.DOC_STORE,m=p.BY_SEQ_STORE,g=p.ATTACH_STORE,b=p.LOCAL_STORE,w=p.META_STORE,S=p.ATTACH_AND_SEQ_STORE,E=h.qMarks,x=h.stringifyDoc,T=h.unstringifyDoc,k=h.select,O=h.compactRevs,I=h.unknownError,A=h.getSize,j=h.openDB,D=1,q="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+m+" (seq, deleted)",R="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+m+" (doc_id, rev)",L="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+_+" (winningseq)",C="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+S+" (seq)",N="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+S+" (digest, seq)",$=m+".seq = "+_+".winningseq",M=m+".seq AS seq, "+m+".deleted AS deleted, "+m+".json AS data, "+m+".rev AS rev, "+_+".json AS metadata";o.valid=h.valid,o.Changes=new i.Changes,t.exports=o},{"../../deps/binary/binaryStringToBlobOrBuffer":112,"../../deps/docs/isDeleted":119,"../../deps/docs/isLocalId":120,"../../deps/env/hasLocalStorage":127,"../../deps/errors":129,"../../deps/parseHex":132,"../../merge":149,"../../utils":160,"./bulkDocs":92,"./constants":93,"./utils":95}],95:[function(e,t,r){"use strict";function n(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function o(e){return e.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function i(e){return delete e._id,delete e._rev,JSON.stringify(e)}function s(e,t,r){return e=JSON.parse(e),e._id=t,e._rev=r,e}function a(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function u(e,t,r,n,o){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function c(e,t,r){function n(){++i===e.length&&o()}function o(){if(s.length){var e="SELECT DISTINCT digest AS digest FROM "+b+" WHERE seq IN "+a(s.length);r.executeSql(e,s,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var o="DELETE FROM "+b+" WHERE seq IN ("+s.map(function(){return"?"}).join(",")+")";e.executeSql(o,s,function(e){var t="SELECT digest FROM "+b+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new v.Set,o=0;o<t.rows.length;o++)n.add(t.rows.item(o).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+b+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+g+" WHERE digest=?",[t]))})})})}})}}if(e.length){var i=0,s=[];e.forEach(function(e){var o="SELECT seq FROM "+m+" WHERE doc_id=? AND rev=?";r.executeSql(o,[t,e],function(e,t){if(!t.rows.length)return n();var r=t.rows.item(0).seq;s.push(r),e.executeSql("DELETE FROM "+m+" WHERE seq=?",[r],n)})})}}function f(e){return function(t){var r=t&&t.constructor.toString().match(/function ([^\(]+)/),n=r&&r[1]||t.type,o=t.target||t.message;e(y.error(y.WSQ_ERROR,o,n))}}function l(e){if("size"in e)return 1e6*e.size;var t=/Android/.test(window.navigator.userAgent);return t?5e6:1}function d(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(e){return openDatabase(e.name,e.version,e.description,e.size)}:void 0}function p(e){var t=d(),r=w[e.name];return r||(r=w[e.name]=t(e),r._sqlitePlugin="undefined"!=typeof sqlitePlugin),r}function h(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}var v=e("../../utils"),y=e("../../deps/errors"),_=e("./constants"),m=_.BY_SEQ_STORE,g=_.ATTACH_STORE,b=_.ATTACH_AND_SEQ_STORE,w={};t.exports={escapeBlob:n,unescapeBlob:o,stringifyDoc:i,unstringifyDoc:s,qMarks:a,select:u,compactRevs:c,unknownError:f,getSize:l,openDB:p,valid:h}},{"../../deps/errors":129,"../../utils":160,"./constants":93}],96:[function(e,t,r){"use strict";function n(e,t,r){function n(){o.cancel()}c.call(this);var o=this;this.db=e,t=t?i.clone(t):{};var s=t.complete=i.once(function(t,r){t?o.emit("error",t):o.emit("complete",r),o.removeAllListeners(),e.removeListener("destroyed",n)});r&&(o.on("complete",function(e){r(null,e)}),o.on("error",function(e){r(e)})),e.once("destroyed",n),t.onChange=function(e){t.isCancelled||(o.emit("change",e),o.startSeq&&o.startSeq<=e.seq&&(o.startSeq=!1),e.deleted?o.emit("delete",e):1===e.changes.length&&"1-"===e.changes[0].rev.slice(0,2)?o.emit("create",e):o.emit("update",e))};var a=new i.Promise(function(e,r){t.complete=function(t,n){t?r(t):e(n)}});o.once("cancel",function(){e.removeListener("destroyed",n),t.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this["catch"]=a["catch"].bind(a),this.then(function(e){s(null,e)},s),e.taskqueue.isReady?o.doChanges(t):e.taskqueue.addTask(function(){o.isCancelled?o.emit("cancel"):o.doChanges(t)})}function o(e,t,r){var n=[{rev:e._rev}];"all_docs"===r.style&&(n=a.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var o={id:t.id,changes:n,doc:e};return s(t,e._rev)&&(o.deleted=!0),r.conflicts&&(o.doc._conflicts=a.collectConflicts(t),o.doc._conflicts.length||delete o.doc._conflicts),o}var i=e("./utils"),s=e("./deps/docs/isDeleted"),a=e("./merge"),u=e("./deps/errors"),c=e("events").EventEmitter,f=e("./evalFilter"),l=e("./evalView"),d=e("./deps/docs/parseDdocFunctionName"),p=e("./deps/docs/normalizeDdocFunctionName");t.exports=n,i.inherits(n,c),n.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},n.prototype.doChanges=function(e){var t=this,r=e.complete;if(e=i.clone(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=o,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"===e.since)return void this.db.info().then(function(n){return t.isCancelled?void r(null,{status:"cancelled"}):(e.since=n.update_seq,void t.doChanges(e))},r);if(e.continuous&&"now"!==e.since&&this.db.info().then(function(e){t.startSeq=e.update_seq},function(e){if("idbNull"!==e.id)throw e}),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=p(e.view):e.filter=p(e.filter),"http"!==this.db.type()&&!e.doc_ids))return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=r;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var s=t.cancel;t.cancel=i.getArguments(function(e){n.cancel(),s.apply(this,e)})}},n.prototype.filterChanges=function(e){var t=this,r=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var n=u.error(u.BAD_REQUEST,"`view` filter parameter not found or invalid.");return r(n)}var o=d(e.view);this.db.get("_design/"+o[0],function(n,i){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(u.generateErrorFromResponse(n));var s=i&&i.views&&i.views[o[1]]&&i.views[o[1]].map;return s?(e.filter=l(s),void t.doChanges(e)):r(u.error(u.MISSING_DOC,i.views?"missing json key: "+o[1]:"missing json key: views"))})}else{var i=d(e.filter);if(!i)return r(u.error(u.BAD_REQUEST,"`filter` filter parameter invalid."));this.db.get("_design/"+i[0],function(n,o){if(t.isCancelled)return r(null,{status:"cancelled"});if(n)return r(u.generateErrorFromResponse(n));var s=o&&o.filters&&o.filters[i[1]];return s?(e.filter=f(s),void t.doChanges(e)):r(u.error(u.MISSING_DOC,o&&o.filters?"missing json key: "+i[1]:"missing json key: filters"))})}}},{"./deps/docs/isDeleted":119,"./deps/docs/normalizeDdocFunctionName":121,"./deps/docs/parseDdocFunctionName":122,"./deps/errors":129,"./evalFilter":139,"./evalView":140,"./merge":149,"./utils":160,events:80}],97:[function(e,t,r){"use strict";function n(e){a()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):u()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function o(){i.call(this),this._listeners={},n(this)}var i=e("events").EventEmitter,s=e("inherits"),a=e("./deps/env/isChromeApp"),u=e("./deps/env/hasLocalStorage"),c=e("./deps/pick"),f=e("./deps/call");s(o,i),o.prototype.addListener=function(e,t,r,n){function o(){if(i._listeners[t]){if(s)return void(s="waiting");s=!0;var e=c(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,f(n.onChange,e))}).on("complete",function(){"waiting"===s&&setTimeout(function(){o()},0),s=!1}).on("error",function(){s=!1})}}if(!this._listeners[t]){var i=this,s=!1;this._listeners[t]=o,this.on(e,o)}},o.prototype.removeListener=function(e,t){t in this._listeners&&i.prototype.removeListener.call(this,e,this._listeners[t])},o.prototype.notifyLocalWindows=function(e){a()?chrome.storage.local.set({dbName:e}):u()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},o.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},t.exports=o},{"./deps/call":118,"./deps/env/hasLocalStorage":127,"./deps/env/isChromeApp":128,"./deps/pick":134,events:80,inherits:166}],98:[function(e,t,r){(function(r,n){"use strict";function o(e){e&&n.debug&&console.error(e)}function i(e,t){function r(r){r===t.originalName&&(e.removeListener("destroyed",n),e.emit("destroyed",e))}function n(){s.removeListener("destroyed",r),s.emit("destroyed",t.originalName),s.emit(t.originalName,"destroyed")}s.once("destroyed",r),e.once("destroyed",n)}function s(e,t,n){if(!(this instanceof s))return new s(e,t,n);var d=this;("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),e&&"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=o),e=e||t.name,t=t?c.clone(t):{},delete t.name,this.__opts=t;var p=n;d.auto_compaction=t.auto_compaction,d.prefix=s.prefix,u.call(d),d.taskqueue=new f;var h=new l(function(o,u){n=function(e,t){return e?u(e):(delete t.then,void o(t))},t=c.clone(t);var f,l,p=t.name||e;return function(){try{if("string"!=typeof p)throw l=new Error("Missing/invalid DB name"),l.code=400,l;if(f=s.parseAdapter(p,t),t.originalName=p,t.name=f.name,t.prefix&&"http"!==f.adapter&&"https"!==f.adapter&&(t.name=t.prefix+t.name),t.adapter=t.adapter||f.adapter,d._adapter=t.adapter,a("pouchdb:adapter")("Picked adapter: "+t.adapter),d._db_name=p,!s.adapters[t.adapter])throw l=new Error("Adapter is missing"),l.code=404,l;if(!s.adapters[t.adapter].valid())throw l=new Error("Invalid Adapter"),l.code=404,l}catch(e){d.taskqueue.fail(e)}}(),l?u(l):(d.adapter=t.adapter,d.replicate={},d.replicate.from=function(e,t,r){return d.constructor.replicate(e,d,t,r)},d.replicate.to=function(e,t,r){return d.constructor.replicate(d,e,t,r)},d.sync=function(e,t,r){return d.constructor.sync(d,e,t,r)},d.replicate.sync=d.sync,s.adapters[t.adapter].call(d,t,function(e){return e?void(n&&(d.taskqueue.fail(e),n(e))):(i(d,t),d.emit("created",d),s.emit("created",t.originalName),d.taskqueue.ready(d),void n(null,d))}),t.skipSetup&&(d.taskqueue.ready(d),r.nextTick(function(){n(null,d)})),void(c.isCordova()&&cordova.fireWindowEvent(t.name+"_pouch",{})));

});h.then(function(e){p(null,e)},p),d.then=h.then.bind(h),d["catch"]=h["catch"].bind(h)}var a=e("debug"),u=e("./adapter"),c=e("./utils"),f=e("./taskqueue"),l=c.Promise;c.inherits(s,u),s.debug=a,t.exports=s}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":83,"./taskqueue":159,"./utils":160,_process:81,debug:163}],99:[function(e,t,r){"use strict";function n(e,t){function r(t,r,n){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(o){return n(o)}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?i.generateErrorFromResponse(e):e})),e.binary&&a(t,r),n(null,t,r)}function n(e,t){var r,n;if(e.code&&e.status){var o=new Error(e.message||e.code);return o.status=e.status,t(o)}try{r=JSON.parse(e.responseText),n=i.generateErrorFromResponse(r)}catch(s){n=i.generateErrorFromResponse(e)}t(n)}e=s.clone(e);var c={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return e=s.extend(!0,c,e),e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),o(e,function(o,s,a){if(o)return o.status=s?s.statusCode:400,n(o,t);var c,f=s.headers&&s.headers["content-type"],l=a||u();if(e.binary||!e.json&&e.processData||"object"==typeof l||!(/json/.test(f)||/^[\s]*\{/.test(l)&&/\}[\s]*$/.test(l))||(l=JSON.parse(l)),s.statusCode>=200&&s.statusCode<300)r(l,s,t);else{try{l=JSON.parse(l.toString())}catch(d){}c=i.generateErrorFromResponse(l),c.status=s.statusCode,t(c)}})}var o=e("request"),i=e("./../errors"),s=e("../../utils"),a=e("./applyTypeToBuffer"),u=e("./defaultBody");t.exports=n},{"../../utils":160,"./../errors":129,"./applyTypeToBuffer":100,"./defaultBody":103,request:107}],100:[function(e,t,r){"use strict";t.exports=function(){}},{}],101:[function(e,t,r){"use strict";var n=e("../binary/blob");t.exports=function(e,t){return n(e,{type:t})}},{"../binary/blob":113}],102:[function(e,t,r){"use strict";var n=e("../binary/binaryStringToArrayBuffer");t.exports=function(e){return n(e)}},{"../binary/binaryStringToArrayBuffer":111}],103:[function(e,t,r){"use strict";t.exports=function(){return""}},{}],104:[function(e,t,r){(function(e){"use strict";t.exports=function(t){"console"in e&&"info"in console&&console.info("The above 404 is totally normal. "+t)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],105:[function(e,t,r){"use strict";function n(e){e=u(e);var t=s(),r={};Object.keys(e._attachments).forEach(function(t){var n=e._attachments[t];if(!n.stub){var o=i(n.data);r[t]={type:n.content_type,data:o},n.length=o.length,n.follows=!0,delete n.digest,delete n.data}});var n="--"+t+"\r\nContent-Type: application/json\r\n\r\n",o=[n,JSON.stringify(e)];Object.keys(r).forEach(function(e){var n=r[e],i="\r\n--"+t+"\r\nContent-Disposition: attachment; filename="+JSON.stringify(e)+"\r\nContent-Type: "+n.type+"\r\nContent-Length: "+n.data.length+"\r\n\r\n";o.push(i),o.push(f(n.data))}),o.push("\r\n--"+t+"--");var a="multipart/related; boundary="+t,l=c(o,a);return{headers:{"Content-Type":a},body:l}}var o=e("./../binary/base64"),i=o.atob,s=e("./../uuid"),a=e("../../utils"),u=a.clone,c=e("./createBlobOrBufferFromParts"),f=e("./createMultipartPart");t.exports=n},{"../../utils":160,"./../binary/base64":109,"./../uuid":138,"./createBlobOrBufferFromParts":101,"./createMultipartPart":102}],106:[function(e,t,r){"use strict";var n=e("./ajax-core");t.exports=function(e,t){if(("POST"===e.method||"GET"===e.method)&&!e.cache){var r=-1!==e.url.indexOf("?");e.url+=(r?"&":"?")+"_nonce="+Date.now()}return n(e,t)}},{"./ajax-core":99}],107:[function(e,t,r){"use strict";function n(){for(var e={},t=new u.Promise(function(t,r){e.resolve=t,e.reject=r}),r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.promise=t,u.Promise.resolve().then(function(){return fetch.apply(null,r)}).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)}),e}function o(e,t){var r,o,i,s=new Headers,a={method:e.method,credentials:"include",headers:s};return e.json&&(s.set("Accept","application/json"),s.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.body instanceof Blob?c(e.body,function(e){a.body=e}):a.body=e.body&&e.processData&&"string"!=typeof e.body?JSON.stringify(e.body):"body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&s.set(t,e.headers[t])}),r=n(e.url,a),e.timeout>0&&(o=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(o),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):t(e,i)})["catch"](function(e){t(e,i)}),{abort:r.reject}}function i(e,t){var r,n,o,i=function(){r.abort()};r=e.xhr?new e.xhr:new XMLHttpRequest,r.open(e.method,e.url),r.withCredentials=!0,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(r.responseType="arraybuffer"),"body"in e||(e.body=null);for(var s in e.headers)e.headers.hasOwnProperty(s)&&r.setRequestHeader(s,e.headers[s]);return e.timeout>0&&(n=setTimeout(i,e.timeout),r.onprogress=function(){clearTimeout(n),n=setTimeout(i,e.timeout)},"undefined"==typeof o&&(o=-1!==Object.keys(r).indexOf("upload")&&"undefined"!=typeof r.upload),o&&(r.upload.onprogress=r.onprogress)),r.onreadystatechange=function(){if(4===r.readyState){var n={statusCode:r.status};if(r.status>=200&&r.status<300){var o;o=e.binary?a([r.response||""],{type:r.getResponseHeader("Content-Type")}):r.responseText,t(null,n,o)}else{var i={};try{i=JSON.parse(r.response)}catch(s){}t(i,n)}}},e.body&&e.body instanceof Blob?c(e.body,function(e){r.send(e)}):r.send(e.body),{abort:i}}function s(){try{return new XMLHttpRequest,!0}catch(e){return!1}}var a=e("./../binary/blob.js"),u=e("../../utils"),c=e("./../binary/readAsArrayBuffer"),f=s();t.exports=function(e,t){return f||e.xhr?i(e,t):o(e,t)}},{"../../utils":160,"./../binary/blob.js":113,"./../binary/readAsArrayBuffer":116}],108:[function(e,t,r){"use strict";t.exports=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,o=0;n>o;o++)t+=String.fromCharCode(r[o]);return t}},{}],109:[function(e,t,r){"use strict";var n=e("./buffer");r.atob="function"==typeof atob?function(e){return atob(e)}:function(e){var t=new n(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},r.btoa="function"==typeof btoa?function(e){return btoa(e)}:function(e){return new n(e,"binary").toString("base64")}},{"./buffer":115}],110:[function(e,t,r){"use strict";var n=e("./base64").atob,o=e("./binaryStringToBlobOrBuffer");t.exports=function(e,t){return o(n(e),t)}},{"./base64":109,"./binaryStringToBlobOrBuffer":112}],111:[function(e,t,r){"use strict";t.exports=function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),o=0;t>o;o++)n[o]=e.charCodeAt(o);return r}},{}],112:[function(e,t,r){"use strict";var n=e("./blob"),o=e("./binaryStringToArrayBuffer");t.exports=function(e,t){return n([o(e)],{type:t})}},{"./binaryStringToArrayBuffer":111,"./blob":113}],113:[function(e,t,r){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,o=new n,i=0;i<e.length;i+=1)o.append(e[i]);return o.getBlob(t.type)}}t.exports=n},{}],114:[function(e,t,r){"use strict";var n=e("../promise"),o=e("./readAsBinaryString"),i=e("./base64").btoa;t.exports=function(e){return new n(function(t){o(e,function(e){t(i(e))})})}},{"../promise":135,"./base64":109,"./readAsBinaryString":117}],115:[function(e,t,r){t.exports={}},{}],116:[function(e,t,r){"use strict";t.exports=function(e,t){var r=new FileReader;r.onloadend=function(e){var r=e.target.result||new ArrayBuffer(0);t(r)},r.readAsArrayBuffer(e)}},{}],117:[function(e,t,r){"use strict";var n=e("./arrayBufferToBinaryString");t.exports=function(e,t){var r=new FileReader,o="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var r=e.target.result||"";return o?t(r):void t(n(r))},o?r.readAsBinaryString(e):r.readAsArrayBuffer(e)}},{"./arrayBufferToBinaryString":108}],118:[function(e,t,r){"use strict";var n=e("argsarray");t.exports=n(function(e){var t=e.shift();t.apply(this,e)})},{argsarray:162}],119:[function(e,t,r){"use strict";function n(e,t){t||(t=o.winningRev(e));var r=t.indexOf("-");t=t.substring(r+1);var n=!1;return o.traverseRevTree(e.rev_tree,function(e,r,o,i,s){o===t&&(n=!!s.deleted)}),n}var o=e("../../merge");t.exports=n},{"../../merge":149}],120:[function(e,t,r){"use strict";function n(e){return/^_local/.test(e)}t.exports=n},{}],121:[function(e,t,r){"use strict";var n=e("./parseDdocFunctionName");t.exports=function(e){var t=n(e);return t?t.join("/"):null}},{"./parseDdocFunctionName":122}],122:[function(e,t,r){"use strict";t.exports=function(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}},{}],123:[function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function o(e){if(!/^\d+\-./.test(e))return s.error(s.INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function i(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,o=[n[0],t,[]],i=1,s=n.length;s>i;i++)o=[n[i],{status:"missing"},[o]];return[{pos:r,ids:o}]}var s=e("./../errors"),a=e("./../uuid"),u=n(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),c=n(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);r.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=s.error(s.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=s.error(s.RESERVED_ID)):t=s.error(s.MISSING_ID),t)throw t},r.parseDoc=function(e,t){var n,f,l,d={status:"available"};if(e._deleted&&(d.deleted=!0),t)if(e._id||(e._id=a()),f=a(32,16).toLowerCase(),e._rev){if(l=o(e._rev),l.error)return l;e._rev_tree=[{pos:l.prefix,ids:[l.id,{status:"missing"},[[f,d,[]]]]}],n=l.prefix+1}else e._rev_tree=[{pos:1,ids:[f,d,[]]}],n=1;else if(e._revisions&&(e._rev_tree=i(e._revisions,d),n=e._revisions.start,f=e._revisions.ids[0]),!e._rev_tree){if(l=o(e._rev),l.error)return l;n=l.prefix,f=l.id,e._rev_tree=[{pos:n,ids:[f,d,[]]}]}r.invalidIdError(e._id),e._rev=n+"-"+f;var p={metadata:{},data:{}};for(var h in e)if(e.hasOwnProperty(h)){var v="_"===h[0];if(v&&!u[h]){var y=s.error(s.DOC_VALIDATION,h);throw y.message=s.DOC_VALIDATION.message+": "+h,y}v&&!c[h]?p.metadata[h.slice(1)]=e[h]:p.data[h]=e[h]}return p}},{"./../errors":129,"./../uuid":138}],124:[function(e,t,r){"use strict";function n(e,t,r){function n(e){try{return o.atob(e)}catch(t){var r=u.error(u.BAD_ARG,"Attachments need to be base64 encoded");return{error:r}}}function f(e,r){if(e.stub)return r();if("string"==typeof e.data){var u=n(e.data);if(u.error)return r(u.error);e.length=u.length,e.data="blob"===t?a(u,e.content_type):"base64"===t?o.btoa(u):u,c(u).then(function(t){e.digest="md5-"+t,r()})}else s(e.data,function(n){"binary"===t?e.data=i(n):"base64"===t&&(e.data=o.btoa(i(n))),c(n).then(function(t){e.digest="md5-"+t,e.length=n.byteLength,r()})})}function l(){p++,e.length===p&&(d?r(d):r())}if(!e.length)return r();var d,p=0;e.forEach(function(e){function t(e){d=e,n++,n===r.length&&l()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],n=0;if(!r.length)return l();for(var o in e.data._attachments)e.data._attachments.hasOwnProperty(o)&&f(e.data._attachments[o],t)})}var o=e("../binary/base64"),i=e("../binary/arrayBufferToBinaryString"),s=e("../binary/readAsArrayBuffer"),a=e("../binary/binaryStringToBlobOrBuffer"),u=e("../errors"),c=e("../md5");t.exports=n},{"../binary/arrayBufferToBinaryString":108,"../binary/base64":109,"../binary/binaryStringToBlobOrBuffer":112,"../binary/readAsArrayBuffer":116,"../errors":129,"../md5":130}],125:[function(e,t,r){"use strict";function n(e,t,r,n,c,l,d,p){function h(e,t,r){var n=o.winningRev(e.metadata),s=a(e.metadata,n);if("was_delete"in d&&s)return c[t]=i.error(i.MISSING_DOC,"deleted"),r();var u=s?0:1;l(e,n,s,s,!1,u,t,r)}function v(){++m===g&&p&&p()}var y=d.new_edits,_=new f,m=0,g=e.length;e.forEach(function(e,r){if(e._id&&u(e._id))return void t[e._deleted?"_removeLocal":"_putLocal"](e,{ctx:n},function(e){c[r]=e?e:{ok:!0},v()});var o=e.metadata.id;_.has(o)?(g--,_.get(o).push([e,r])):_.set(o,[[e,r]])}),_.forEach(function(e,t){function n(){++i<e.length?o():v()}function o(){var o=e[i],a=o[0],u=o[1];r.has(t)?s(r.get(t),a,c,u,n,l,y):h(a,u,n)}var i=0;o()})}var o=e("../../merge"),i=e("../errors"),s=e("./updateDoc"),a=e("./isDeleted"),u=e("./isLocalId"),c=e("pouchdb-collections"),f=c.Map;t.exports=n},{"../../merge":149,"../errors":129,"./isDeleted":119,"./isLocalId":120,"./updateDoc":126,"pouchdb-collections":187}],126:[function(e,t,r){"use strict";function n(e,t){var r=!1;return i.traverseRevTree(e.rev_tree,function(e,n,o){n+"-"+o===t&&(r=!0)}),r}function o(e,t,r,o,c,f,l){if(n(e,t.metadata.rev))return r[o]=t,c();var d=i.winningRev(e),p=a(e,d),h=a(t.metadata),v=/^1-/.test(t.metadata.rev);if(p&&!h&&l&&v){var y=t.data;y._rev=d,y._id=t.metadata.id,t=u(y,l)}var _=i.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),m=l&&(p&&h||!p&&"new_leaf"!==_.conflicts||p&&!h&&"new_branch"===_.conflicts);if(m){var g=s.error(s.REV_CONFLICT);return r[o]=g,c()}var b=t.metadata.rev;t.metadata.rev_tree=_.tree,e.rev_map&&(t.metadata.rev_map=e.rev_map);var w=i.winningRev(t.metadata),S=a(t.metadata,w),E=p===S?0:S>p?-1:1,x=a(t.metadata,b);f(t,w,S,x,!0,E,o,c)}var i=e("../../merge"),s=e("../errors"),a=e("./isDeleted"),u=e("./parseDoc").parseDoc;t.exports=o},{"../../merge":149,"../errors":129,"./isDeleted":119,"./parseDoc":123}],127:[function(e,t,r){"use strict";var n,o=e("./isChromeApp");if(o())n=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),n=!!localStorage.getItem("_pouch_check_localstorage")}catch(i){n=!1}t.exports=function(){return n}},{"./isChromeApp":128}],128:[function(e,t,r){"use strict";t.exports=function(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}},{}],129:[function(e,t,r){"use strict";function n(e){Error.call(e.reason),this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}var o=e("inherits");o(n,Error),n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},r.UNAUTHORIZED=new n({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),r.MISSING_BULK_DOCS=new n({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),r.MISSING_DOC=new n({status:404,error:"not_found",reason:"missing"}),r.REV_CONFLICT=new n({status:409,error:"conflict",reason:"Document update conflict"}),r.INVALID_ID=new n({status:400,error:"invalid_id",reason:"_id field must contain a string"}),r.MISSING_ID=new n({status:412,error:"missing_id",reason:"_id is required for puts"}),r.RESERVED_ID=new n({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),r.NOT_OPEN=new n({status:412,error:"precondition_failed",reason:"Database not open"}),r.UNKNOWN_ERROR=new n({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),r.BAD_ARG=new n({status:500,error:"badarg",reason:"Some query argument is invalid"}),r.INVALID_REQUEST=new n({status:400,error:"invalid_request",reason:"Request was invalid"}),r.QUERY_PARSE_ERROR=new n({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),r.DOC_VALIDATION=new n({status:500,error:"doc_validation",reason:"Bad special document member"}),r.BAD_REQUEST=new n({status:400,error:"bad_request",reason:"Something wrong with the request"}),r.NOT_AN_OBJECT=new n({status:400,error:"bad_request",reason:"Document must be a JSON object"}),r.DB_MISSING=new n({status:404,error:"not_found",reason:"Database not found"}),r.IDB_ERROR=new n({status:500,error:"indexed_db_went_bad",reason:"unknown"}),r.WSQ_ERROR=new n({status:500,error:"web_sql_went_bad",reason:"unknown"}),r.LDB_ERROR=new n({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),r.FORBIDDEN=new n({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),r.INVALID_REV=new n({status:400,error:"bad_request",reason:"Invalid rev format"}),r.FILE_EXISTS=new n({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),r.MISSING_STUB=new n({status:412,error:"missing_stub"}),r.error=function(e,t,r){function o(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==r&&(this.name=r),void 0!==t&&(this.reason=t)}return o.prototype=n.prototype,new o(t)},r.getErrorTypeByProp=function(e,t,n){var o=r,i=Object.keys(o).filter(function(r){var n=o[r];return"function"!=typeof n&&n[e]===t}),s=n&&i.filter(function(e){var t=o[e];return t.message===n})[0]||i[0];return s?o[s]:null},r.generateErrorFromResponse=function(e){var t,n,o,i,s,a=r;return n=e.error===!0&&"string"==typeof e.name?e.name:e.error,s=e.reason,o=a.getErrorTypeByProp("name",n,s),e.missing||"missing"===s||"deleted"===s||"not_found"===n?o=a.MISSING_DOC:"doc_validation"===n?(o=a.DOC_VALIDATION,i=s):"bad_request"===n&&o.message!==s&&(o=a.BAD_REQUEST),o||(o=a.getErrorTypeByProp("status",e.status,s)||a.UNKNOWN_ERROR),t=a.error(o,s,n),i&&(t.message=i),e.id&&(t.id=e.id),e.status&&(t.status=e.status),e.missing&&(t.missing=e.missing),t}},{inherits:166}],130:[function(e,t,r){(function(r){"use strict";function n(e){return String.fromCharCode(255&e)+String.fromCharCode(e>>>8&255)+String.fromCharCode(e>>>16&255)+String.fromCharCode(e>>>24&255)}function o(e){for(var t="",r=0,o=e.length;o>r;r++)t+=n(e[r]);return u.btoa(t)}function i(e,t,r,n){(r>0||n<t.byteLength)&&(t=new Uint8Array(t,r,Math.min(n,t.byteLength)-r)),e.append(t)}function s(e,t,r,n){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t)}var a=e("./toPromise"),u=e("./binary/base64"),c=e("spark-md5"),f=r.setImmediate||r.setTimeout,l=32768;t.exports=a(function(e,t){function r(){var n=p*u,i=n+u;if(p++,d>p)v(h,e,n,i),f(r);else{v(h,e,n,i);var s=h.end(!0),a=o(s);t(null,a),h.destroy()}}var n="string"==typeof e,a=n?e.length:e.byteLength,u=Math.min(l,a),d=Math.ceil(a/u),p=0,h=n?new c:new c.ArrayBuffer,v=n?s:i;r()})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./binary/base64":109,"./toPromise":136,"spark-md5":190}],131:[function(e,t,r){"use strict";function n(e){var t=!1;return o(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}var o=e("argsarray");t.exports=n},{argsarray:162}],132:[function(e,t,r){"use strict";function n(e){return decodeURIComponent(window.escape(e))}function o(e){return 65>e?e-48:e-55}function i(e,t,r){for(var n="";r>t;)n+=String.fromCharCode(o(e.charCodeAt(t++))<<4|o(e.charCodeAt(t++)));return n}function s(e,t,r){for(var n="";r>t;)n+=String.fromCharCode(o(e.charCodeAt(t+2))<<12|o(e.charCodeAt(t+3))<<8|o(e.charCodeAt(t))<<4|o(e.charCodeAt(t+1))),t+=4;return n}function a(e,t){return"UTF-8"===t?n(i(e,0,e.length)):s(e,0,e.length)}t.exports=a},{}],133:[function(e,t,r){"use strict";function n(e){for(var t=a.exec(e),r={},n=14;n--;){var u=o[n],c=t[n]||"",f=-1!==["user","password"].indexOf(u);r[u]=f?decodeURIComponent(c):c}return r[i]={},r[o[12]].replace(s,function(e,t,n){t&&(r[i][t]=n)}),r}var o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],i="queryKey",s=/(?:^|&)([^&=]*)=?([^&]*)/g,a=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;t.exports=n},{}],134:[function(e,t,r){"use strict";t.exports=function(e,t){for(var r={},n=0,o=t.length;o>n;n++){var i=t[n];i in e&&(r[i]=e[i])}return r}},{}],135:[function(e,t,r){"use strict";t.exports="function"==typeof Promise?Promise:e("lie")},{lie:170}],136:[function(e,t,r){(function(r){"use strict";function n(e){return i(function(t){var n,i=this,a="function"==typeof t[t.length-1]?t.pop():!1;a&&(n=function(e,t){r.nextTick(function(){a(e,t)})});var u=new o(function(r,n){var o;try{var a=s(function(e,t){e?n(e):r(t)});t.push(a),o=e.apply(i,t),o&&"function"==typeof o.then&&r(o)}catch(u){n(u)}});return n&&u.then(function(e){n(null,e)},n),u})}var o=e("./promise"),i=e("argsarray"),s=e("./once");t.exports=n}).call(this,e("_process"))},{"./once":131,"./promise":135,_process:81,argsarray:162}],137:[function(e,t,r){"use strict";var n=e("pouchdb-upsert").upsert;t.exports=function(e,t,r,o){return n.call(e,t,r,o)}},{"pouchdb-upsert":189}],138:[function(e,t,r){"use strict";function n(e){return 0|Math.random()*e}function o(e,t){t=t||i.length;var r="",o=-1;if(e){for(;++o<e;)r+=i[n(t)];return r}for(;++o<36;)switch(o){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=i[3&n(16)|8];break;default:r+=i[n(16)]}return r}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.exports=o},{}],139:[function(require,module,exports){"use strict";function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],140:[function(require,module,exports){"use strict";function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],141:[function(e,t,r){"use strict";var n=e("./setup");t.exports=n,n.ajax=e("./deps/ajax/prequest"),n.utils=e("./utils"),n.Errors=e("./deps/errors"),n.replicate=e("./replicate").replicate,n.sync=e("./sync"),n.version=e("./version");var o=e("./adapters/http");n.adapter("http",o),n.adapter("https",o),n.plugin(e("./mapreduce"));var i=e("./adapters");Object.keys(i).forEach(function(e){n.adapter(e,i[e],!0)})},{"./adapters":84,"./adapters/http":85,"./deps/ajax/prequest":106,"./deps/errors":129,"./mapreduce":144,"./replicate":154,"./setup":157,"./sync":158,"./utils":160,"./version":161}],142:[function(e,t,r){"use strict";var n=e("./upsert"),o=e("./utils"),i=o.Promise;t.exports=function(e){var t=e.db,r=e.viewName,s=e.map,a=e.reduce,u=e.temporary,c=s.toString()+(a&&a.toString())+"undefined";if(!u&&t._cachedViews){var f=t._cachedViews[c];if(f)return i.resolve(f)}return t.info().then(function(e){function i(e){e.views=e.views||{};var t=r;-1===t.indexOf("/")&&(t=r+"/"+r);var n=e.views[t]=e.views[t]||{};if(!n[f])return n[f]=!0,e}var f=e.db_name+"-mrview-"+(u?"temp":o.MD5(c));return n(t,"_local/mrviews",i).then(function(){return t.registerDependentDatabase(f).then(function(e){var r=e.db;r.auto_compaction=!0;var n={name:f,db:r,sourceDB:t,adapter:t.adapter,mapFun:s,reduceFun:a};return n.db.get("_local/lastSeq")["catch"](function(e){if(404!==e.status)throw e}).then(function(e){return n.seq=e?e.seq:0,u||(t._cachedViews=t._cachedViews||{},t._cachedViews[c]=n,n.db.once("destroyed",function(){delete t._cachedViews[c]})),n})})})})}},{"./upsert":147,"./utils":148}],143:[function(require,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],144:[function(e,t,r){(function(t){"use strict";function n(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function o(e){return 1===e.length&&/^1-/.test(e[0].rev)}function i(e,t){try{e.emit("error",t)}catch(r){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(t)}}function s(e,t,r){try{return{output:t.apply(null,r)}}catch(n){return i(e,n),{error:n}}}function a(e,t){var r=N(e.key,t.key);return 0!==r?r:N(e.value,t.value)}function u(e,t,r){return r=r||0,"number"==typeof t?e.slice(r,t+r):r>0?e.slice(r):e}function c(e){var t=e.value,r=t&&"object"==typeof t&&t._id||e.id;return r}function f(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var r=t[e];t[e].data=R(r.data,r.content_type)})})}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&f(t),t}}function d(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new D(t)}function p(e){for(var t=0,r=0,n=e.length;n>r;r++){var o=e[r];if("number"!=typeof o){if(!Array.isArray(o))throw d("_sum");t="number"==typeof t?[t]:t;for(var i=0,s=o.length;s>i;i++){var a=o[i];if("number"!=typeof a)throw d("_sum");"undefined"==typeof t[i]?t.push(a):t[i]+=a}}else"number"==typeof t?t+=o:t[0]+=o}return t}function h(e,t,r,n){var o=t[e];"undefined"!=typeof o&&(n&&(o=encodeURIComponent(JSON.stringify(o))),r.push(e+"="+o))}function v(e,t){var r=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if("undefined"!=typeof e[r]&&"undefined"!=typeof e[n]&&N(e[r],e[n])>0)throw new A("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&e.reduce!==!1){if(e.include_docs)throw new A("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new A("Multi-key fetches for reduce views must use {group: true}")}if(e.group_level){if("number"!=typeof e.group_level)throw new A('Invalid value for integer: "'+e.group_level+'"');if(e.group_level<0)throw new A('Invalid value for positive integer: "'+e.group_level+'"')}}function y(e,t,r){var o,i=[],s="GET";if(h("reduce",r,i),h("include_docs",r,i),h("attachments",r,i),h("limit",r,i),h("descending",r,i),h("group",r,i),h("group_level",r,i),h("skip",r,i),h("stale",r,i),h("conflicts",r,i),h("startkey",r,i,!0),h("endkey",r,i,!0),h("inclusive_end",r,i),h("key",r,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof r.keys){var a=2e3,u="keys="+encodeURIComponent(JSON.stringify(r.keys));u.length+i.length+1<=a?i+=("?"===i[0]?"&":"?")+u:(s="POST","string"==typeof t?o=JSON.stringify({keys:r.keys}):t.keys=r.keys)}if("string"==typeof t){var c=n(t);return e.request({method:s,url:"_design/"+c[0]+"/_view/"+c[1]+i,body:o}).then(l(r))}return o=o||{},Object.keys(t).forEach(function(e){o[e]=Array.isArray(t[e])?t[e]:t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:o}).then(l(r))}function _(e){return function(t){if(404===t.status)return e;throw t}}function m(e,t,r){function n(){return o(l)?U.resolve(u):t.db.get(a)["catch"](_(u))}function i(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):U.resolve({rows:[]})}function s(e,t){for(var r=[],n={},o=0,i=t.rows.length;i>o;o++){var s=t.rows[o],a=s.doc;if(a&&(r.push(a),n[a._id]=!0,a._deleted=!f[a._id],!a._deleted)){var u=f[a._id];"value"in u&&(a.value=u.value)}}var c=Object.keys(f);return c.forEach(function(e){if(!n[e]){var t={_id:e},o=f[e];"value"in o&&(t.value=o.value),r.push(t)}}),e.keys=F.uniq(c.concat(e.keys)),r.push(e),r}var a="_local/doc_"+e,u={_id:a,keys:[]},c=r[e],f=c.indexableKeysToKeyValues,l=c.changes;return n().then(function(e){return i(e).then(function(t){return s(e,t)})})}function g(e,t,r){var n="_local/lastSeq";return e.db.get(n)["catch"](_({_id:n,seq:0})).then(function(n){var o=Object.keys(t);return U.all(o.map(function(r){return m(r,e,t)})).then(function(t){var o=F.flatten(t);return n.seq=r,o.push(n),e.db.bulkDocs({docs:o})})})}function b(e){var t="string"==typeof e?e:e.name,r=K[t];return r||(r=K[t]=new C),r}function w(e){return F.sequentialize(b(e),function(){return S(e)})()}function S(e){function t(e,t){var r={id:o._id,key:M(e)};"undefined"!=typeof t&&null!==t&&(r.value=M(t)),n.push(r)}function r(t,r){return function(){return g(e,t,r)}}var n,o,i;if("function"==typeof e.mapFun&&2===e.mapFun.length){var u=e.mapFun;i=function(e){return u(e,t)}}else i=z(e.mapFun.toString(),t,p,q,Array.isArray,JSON.parse);var c=e.seq||0,f=new C;return new U(function(t,u){function l(){f.finish().then(function(){e.seq=c,t()})}function d(){function t(e){u(e)}e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:c,limit:W}).on("complete",function(t){var u=t.results;if(!u.length)return l();for(var p={},h=0,v=u.length;v>h;h++){var y=u[h];if("_"!==y.doc._id[0]){n=[],o=y.doc,o._deleted||s(e.sourceDB,i,[o]),n.sort(a);for(var _,m={},g=0,b=n.length;b>g;g++){var w=n[g],S=[w.key,w.id];0===N(w.key,_)&&S.push(g);var E=$(S);m[E]=w,_=w.key}p[y.doc._id]={indexableKeysToKeyValues:m,changes:y.changes}}c=y.seq}return f.add(r(p,c)),u.length<W?l():d()}).on("error",t)}d()})}function E(e,t,r){0===r.group_level&&delete r.group_level;var n,o=r.group||r.group_level;n=H[e.reduceFun]?H[e.reduceFun]:z(e.reduceFun.toString(),null,p,q,Array.isArray,JSON.parse);var i=[],a=r.group_level;t.forEach(function(e){var t=i[i.length-1],r=o?e.key:null;return o&&Array.isArray(r)&&"number"==typeof a&&(r=r.length>a?r.slice(0,a):r),t&&0===N(t.key[0][0],r)?(t.key.push([r,e.id]),void t.value.push(e.value)):void i.push({key:[[r,e.id]],value:[e.value]})});for(var c=0,f=i.length;f>c;c++){var l=i[c],d=s(e.sourceDB,n,[l.key,l.value,!1]);if(d.error&&d.error instanceof D)throw d.error;l.value=d.error?null:d.output,l.key=l.key[0][0]}return{rows:u(i,r.limit,r.skip)}}function x(e,t){return F.sequentialize(b(e),function(){return T(e,t)})()}function T(e,t){function r(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return o=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),r=["id","key","value"];if(!(r>t||t>r))return e.doc.value}var n=B(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}})})}function n(r){var n;if(n=i?E(e,r,t):{total_rows:o,offset:s,rows:r},t.include_docs){var a=F.uniq(r.map(c));return e.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t={};return e.rows.forEach(function(e){e.doc&&(t["$"+e.id]=e.doc)}),r.forEach(function(e){var r=c(e),n=t["$"+r];n&&(e.doc=n)}),n})}return n}var o,i=e.reduceFun&&t.reduce!==!1,s=t.skip||0;"undefined"==typeof t.keys||t.keys.length||(t.limit=0,delete t.keys);var a=function(e){return e.reduce(function(e,t){return e.concat(t)})};if("undefined"!=typeof t.keys){var u=t.keys,f=u.map(function(e){var t={startkey:$([e]),endkey:$([e,{}])};return r(t)});return U.all(f).then(a).then(n)}var l={descending:t.descending};if("undefined"!=typeof t.startkey&&(l.startkey=$(t.descending?[t.startkey,{}]:[t.startkey])),"undefined"!=typeof t.endkey){var d=t.inclusive_end!==!1;t.descending&&(d=!d),l.endkey=$(d?[t.endkey,{}]:[t.endkey])}if("undefined"!=typeof t.key){var p=$([t.key]),h=$([t.key,{}]);l.descending?(l.endkey=p,l.startkey=h):(l.startkey=p,l.endkey=h)}return i||("number"==typeof t.limit&&(l.limit=t.limit),l.skip=s),r(l).then(n)}function k(e){return e.request({method:"POST",url:"_view_cleanup"})}function O(e){return e.get("_local/mrviews").then(function(t){var r={};Object.keys(t.views).forEach(function(e){var t=n(e),o="_design/"+t[0],i=t[1];r[o]=r[o]||{},r[o][i]=!0;

});var o={keys:Object.keys(r),include_docs:!0};return e.allDocs(o).then(function(n){var o={};n.rows.forEach(function(e){var n=e.key.substring(8);Object.keys(r[e.key]).forEach(function(r){var i=n+"/"+r;t.views[i]||(i=r);var s=Object.keys(t.views[i]),a=e.doc&&e.doc.views&&e.doc.views[r];s.forEach(function(e){o[e]=o[e]||a})})});var i=Object.keys(o).filter(function(e){return!o[e]}),s=i.map(function(t){return F.sequentialize(b(t),function(){return new e.constructor(t,e.__opts).destroy()})()});return U.all(s).then(function(){return{ok:!0}})})},_({ok:!0}))}function I(e,r,o){if("http"===e.type())return y(e,r,o);if("string"!=typeof r){v(o,r);var i={db:e,viewName:"temp_view/temp_view",map:r.map,reduce:r.reduce,temporary:!0};return J.add(function(){return P(i).then(function(e){function t(){return e.db.destroy()}return F.fin(w(e).then(function(){return x(e,o)}),t)})}),J.finish()}var s=r,a=n(s),u=a[0],c=a[1];return e.get("_design/"+u).then(function(r){var n=r.views&&r.views[c];if(!n||"string"!=typeof n.map)throw new j("ddoc "+u+" has no view named "+c);v(o,n);var i={db:e,viewName:s,map:n.map,reduce:n.reduce};return P(i).then(function(e){return"ok"===o.stale||"update_after"===o.stale?("update_after"===o.stale&&t.nextTick(function(){w(e)}),x(e,o)):w(e).then(function(){return x(e,o)})})})}function A(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,A)}catch(t){}}function j(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,j)}catch(t){}}function D(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,D)}catch(t){}}var q,R=e("../deps/binary/base64StringToBlobOrBuffer"),L=e("pouchdb-collate"),C=e("./taskqueue"),N=L.collate,$=L.toIndexableString,M=L.normalizeKey,B=L.parseIndexableString,P=e("./create-view"),z=e("./evalfunc");q="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var F=e("./utils"),U=F.Promise,K={},J=new C,W=50,H={_sum:function(e,t){return p(t)},_count:function(e,t){return t.length},_stats:function(e,t){function r(e){for(var t=0,r=0,n=e.length;n>r;r++){var o=e[r];t+=o*o}return t}return{sum:p(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:r(t)}}};r.viewCleanup=F.callbackify(function(){var e=this;return"http"===e.type()?k(e):O(e)}),r.query=function(e,t,r){"function"==typeof t&&(r=t,t={}),t=F.extend(!0,{},t),"function"==typeof e&&(e={map:e});var n=this,o=U.resolve().then(function(){return I(n,e,t)});return F.promisedCallback(o,r),o},F.inherits(A,Error),F.inherits(j,Error),F.inherits(D,Error)}).call(this,e("_process"))},{"../deps/binary/base64StringToBlobOrBuffer":110,"./create-view":142,"./evalfunc":143,"./taskqueue":146,"./utils":148,_process:81,"pouchdb-collate":185}],145:[function(e,t,r){"use strict";var n=e("spark-md5");t.exports=function(e){return n.hash(e)}},{"spark-md5":190}],146:[function(e,t,r){"use strict";function n(){this.promise=new o(function(e){e()})}var o=e("./utils").Promise;n.prototype.add=function(e){return this.promise=this.promise["catch"](function(){}).then(function(){return e()}),this.promise},n.prototype.finish=function(){return this.promise},t.exports=n},{"./utils":148}],147:[function(e,t,r){"use strict";var n=e("pouchdb-upsert").upsert;t.exports=function(e,t,r){return n.apply(e,[t,r])}},{"pouchdb-upsert":189}],148:[function(e,t,r){(function(t){"use strict";r.Promise=e("../deps/promise"),r.inherits=e("inherits"),r.extend=e("pouchdb-extend");var n=e("argsarray");r.promisedCallback=function(e,r){return r&&e.then(function(e){t.nextTick(function(){r(null,e)})},function(e){t.nextTick(function(){r(e)})}),e},r.callbackify=function(e){return n(function(t){var n=t.pop(),o=e.apply(this,t);return"function"==typeof n&&r.promisedCallback(o,n),o})},r.fin=function(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})},r.sequentialize=function(e,t){return function(){var r=arguments,n=this;return e.add(function(){return t.apply(n,r)})}},r.flatten=function(e){for(var t=[],r=0,n=e.length;n>r;r++)t=t.concat(e[r]);return t},r.uniq=function(e){for(var t={},r=0,n=e.length;n>r;r++)t["$"+e[r]]=!0;var o=Object.keys(t),i=new Array(o.length);for(r=0,n=o.length;n>r;r++)i[r]=o[r].substring(1);return i},r.MD5=e("./md5")}).call(this,e("_process"))},{"../deps/promise":135,"./md5":145,_process:81,argsarray:162,inherits:166,"pouchdb-extend":188}],149:[function(e,t,r){"use strict";function n(e,t,r){for(var n,o=0,i=e.length;i>o;)n=o+i>>>1,r(e[n],t)<0?o=n+1:i=n;return o}function o(e,t,r){var o=n(e,t,r);e.splice(o,0,t)}function i(e){for(var t,r=e.shift(),n=[r.id,r.opts,[]],o=n;e.length;)r=e.shift(),t=[r.id,r.opts,[]],o[2].push(t),o=t;return n}function s(e,t){return e[0]<t[0]?-1:1}function a(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var i=r.pop(),a=i.tree1,u=i.tree2;(a[1].status||u[1].status)&&(a[1].status="available"===a[1].status||"available"===u[1].status?"available":"missing");for(var c=0;c<u[2].length;c++)if(a[2][0]){for(var f=!1,l=0;l<a[2].length;l++)a[2][l][0]===u[2][c][0]&&(r.push({tree1:a[2][l],tree2:u[2][c]}),f=!0);f||(n="new_branch",o(a[2],u[2][c],s))}else n="new_leaf",a[2][0]=u[2][c]}return{conflicts:n,tree:e}}function u(e,t,r){var n,o=[],i=!1,s=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])n=a(e.ids,t.ids),o.push({pos:e.pos,ids:n.tree}),i=i||n.conflicts,s=!0;else if(r!==!0){var u=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,f=c.pos-u.pos,l=[],d=[];for(d.push({ids:u.ids,diff:f,parent:null,parentIdx:null});d.length>0;){var p=d.pop();0!==p.diff?p.ids&&p.ids[2].forEach(function(e,t){d.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})}):p.ids[0]===c.ids[0]&&l.push(p)}var h=l[0];h?(n=a(h.ids,c.ids),h.parent[2][h.parentIdx]=n.tree,o.push({pos:u.pos,ids:u.ids}),i=i||n.conflicts,s=!0):o.push(e)}else o.push(e)}),s||o.push(t),o.sort(function(e,t){return e.pos-t.pos}),{tree:o,conflicts:i||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function c(e,t){var r=l.rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:i(r)}});return r.reduce(function(e,t){return u(e,t,!0).tree},[r.shift()])}var f=e("pouchdb-extend"),l={};l.merge=function(e,t,r){e=f(!0,[],e),t=f(!0,{},t);var n=u(e,t);return{tree:c(n.tree,r),conflicts:n.conflicts}},l.winningRev=function(e){var t=[];return l.traverseRevTree(e.rev_tree,function(e,r,n,o,i){e&&t.push({pos:r,id:n,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},l.traverseRevTree=function(e,t){for(var r,n=e.slice();r=n.pop();)for(var o=r.pos,i=r.ids,s=i[2],a=t(0===s.length,o,i[0],r.ctx,i[1]),u=0,c=s.length;c>u;u++)n.push({pos:o+1,ids:s[u],ctx:a})},l.collectLeaves=function(e){var t=[];return l.traverseRevTree(e,function(e,r,n,o,i){e&&t.push({rev:r+"-"+n,pos:r,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.forEach(function(e){delete e.pos}),t},l.collectConflicts=function(e){var t=l.winningRev(e),r=l.collectLeaves(e.rev_tree),n=[];return r.forEach(function(e){e.rev===t||e.opts.deleted||n.push(e.rev)}),n},l.rootToLeaf=function(e){var t=[];return l.traverseRevTree(e,function(e,r,n,o,i){if(o=o?o.slice(0):[],o.push({id:n,opts:i}),e){var s=r+1-o.length;t.unshift({pos:s,ids:o})}return o}),t},t.exports=l},{"pouchdb-extend":188}],150:[function(e,t,r){"use strict";function n(e,t){e=parseInt(e,10),t=parseInt(t,10),e!==e&&(e=0),t!==t||e>=t?t=(e||1)<<1:t+=1;var r=Math.random(),n=t-e;return~~(n*r+e)}function o(e){var t=0;return e||(t=2e3),n(e,t)}function i(e,t,r,n){return e.retry===!1?(t.emit("error",r),void t.removeAllListeners()):("function"!=typeof e.back_off_function&&(e.back_off_function=o),t.emit("requestError",r),"active"===t.state&&(t.emit("paused",r),t.state="stopped",t.once("active",function(){e.current_back_off=s})),e.current_back_off=e.current_back_off||s,e.current_back_off=e.back_off_function(e.current_back_off),void setTimeout(n,e.current_back_off))}var s=0;t.exports=i},{}],151:[function(e,t,r){"use strict";function n(e,t,r,o,i){return e.get(t)["catch"](function(r){if(404===r.status)return"http"===e.type()&&c("PouchDB is just checking if a remote checkpoint exists."),{session_id:o,_id:t,history:[],replicator:p,version:d};throw r}).then(function(s){return i.cancelled?void 0:(s.history=(s.history||[]).filter(function(e){return e.session_id!==o}),s.history.unshift({last_seq:r,session_id:o}),s.history=s.history.slice(0,h),s.version=d,s.replicator=p,s.session_id=o,s.last_seq=r,e.put(s)["catch"](function(s){if(409===s.status)return n(e,t,r,o,i);throw s}))})}function o(e,t,r,n){this.src=e,this.target=t,this.id=r,this.returnValue=n}function i(e,t){if(e.session_id===t.session_id)return{last_seq:e.last_seq,history:e.history||[]};var r=e.history||[],n=t.history||[];return s(r,n)}function s(e,t){var r=e[0],n=e.slice(1),o=t[0],i=t.slice(1);if(!r||0===t.length)return{last_seq:v,history:[]};var u=r.session_id;if(a(u,t))return{last_seq:r.last_seq,history:e};var c=o.session_id;return a(c,n)?{last_seq:o.last_seq,history:i}:s(n,i)}function a(e,t){var r=t[0],n=t.slice(1);return e&&0!==t.length?e===r.session_id?!0:a(e,n):!1}var u=e("./../deps/promise"),c=e("./../deps/ajax/explain404"),f=e("pouchdb-collate"),l=f.collate,d=1,p="pouchdb",h=5,v=0;o.prototype.writeCheckpoint=function(e,t){var r=this;return this.updateTarget(e,t).then(function(){return r.updateSource(e,t)})},o.prototype.updateTarget=function(e,t){return n(this.target,this.id,e,t,this.returnValue)},o.prototype.updateSource=function(e,t){var r=this;return this.readOnlySource?u.resolve(!0):n(this.src,this.id,e,t,this.returnValue)["catch"](function(e){var t="number"==typeof e.status&&4===Math.floor(e.status/100);if(t)return r.readOnlySource=!0,!0;throw e})};var y={undefined:function(e,t){return 0===l(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return i(t,e).last_seq}};o.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.src.get(e.id).then(function(e){if(t.version!==e.version)return v;var r;return r=t.version?t.version.toString():"undefined",r in y?y[r](t,e):v},function(r){if(404===r.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:v}).then(function(){return v},function(r){return 401===r.status?(e.readOnlySource=!0,t.last_seq):v});throw r})})["catch"](function(e){if(404!==e.status)throw e;return v})},t.exports=o},{"./../deps/ajax/explain404":104,"./../deps/promise":135,"pouchdb-collate":185}],152:[function(e,t,r){"use strict";function n(e){return Object.keys(e).sort(s).reduce(function(t,r){return t[r]=e[r],t},{})}function o(e,t,r){var o=r.doc_ids?r.doc_ids.sort(s):"",a=r.filter?r.filter.toString():"",u="",c="";return r.filter&&r.query_params&&(u=JSON.stringify(n(r.query_params))),r.filter&&"_view"===r.filter&&(c=r.view.toString()),e.id().then(function(e){return t.id().then(function(t){var r=e+t+a+c+u+o;return i(r).then(function(e){return e=e.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+e})})})}var i=e("../deps/md5"),s=e("pouchdb-collate").collate;t.exports=o},{"../deps/md5":130,"pouchdb-collate":185}],153:[function(e,t,r){"use strict";function n(e){return/^1-/.test(e)}function o(e,t,r){function o(t,n){var o={revs:!0,open_revs:n,attachments:!0,binary:!0};return e.get(t,o).then(function(e){if(r.cancelled)throw new Error("cancelled");e.forEach(function(e){e.ok&&h.push(e.ok)})})}function i(e){for(var r=t[e].missing,n=[],i=0;i<r.length;i+=u){var s=r.slice(i,Math.min(r.length,i+u));n.push(s)}return a.all(n.map(function(t){return o(e,t)}))}function c(){var e=Object.keys(t);return a.all(e.map(i))}function f(e){return e._attachments&&Object.keys(e._attachments).length>0}function l(o){return e.allDocs({keys:o,include_docs:!0}).then(function(e){if(r.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){!e.deleted&&e.doc&&n(e.value.rev)&&!f(e.doc)&&(h.push(e.doc),delete t[e.id])})})}function d(){var e=Object.keys(t).filter(function(e){var r=t[e].missing;return 1===r.length&&n(r[0])});return e.length>0?l(e):void 0}function p(){return h}t=s(t);var h=[];return a.resolve().then(d).then(c).then(p)}var i=e("./../utils"),s=i.clone,a=i.Promise,u=50;t.exports=o},{"./../utils":160}],154:[function(e,t,r){"use strict";function n(e,t){var r=t.PouchConstructor;return"string"==typeof e?new r(e,t):e}function o(e,t,r,o){"function"==typeof r&&(o=r,r={}),"undefined"==typeof r&&(r={}),r.complete=o,r=i.clone(r),r.continuous=r.continuous||r.live,r.retry="retry"in r?r.retry:!1,r.PouchConstructor=r.PouchConstructor||this;var u=new a(r),c=n(e,r),f=n(t,r);return s(c,f,r,u),u}var i=e("../utils"),s=e("./replicate"),a=e("./replication");t.exports={replicate:o,toPouch:n}},{"../utils":160,"./replicate":155,"./replication":156}],155:[function(e,t,r){"use strict";function n(e,t,r,c,f){function l(){return O?o.Promise.resolve():a(e,t,r).then(function(r){k=r,O=new i(e,t,k,B)})}function d(){if(0!==T.docs.length){var e=T.docs;return t.bulkDocs({docs:e,new_edits:!1}).then(function(t){if(B.cancelled)throw g(),new Error("cancelled");var r=[],n={};t.forEach(function(e){e.error&&(f.doc_write_failures++,r.push(e),n[e.id]=e)}),P=P.concat(r),f.docs_written+=T.docs.length-r.length;var i=r.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name});if(z=[],e.forEach(function(e){var t=n[e._id];t?c.emit("denied",o.clone(t)):z.push(e)}),i.length>0){var s=new Error("bulkDocs error");throw s.other_errors=r,m("target.bulkDocs failed to write docs",s),new Error("bulkWrite partial failure")}},function(t){throw f.doc_write_failures+=e.length,t})}}function p(){return j=!0,O.writeCheckpoint(T.seq,F).then(function(){if(j=!1,B.cancelled)throw g(),new Error("cancelled");f.last_seq=R=T.seq;var e=o.clone(f);e.docs=z,c.emit("change",e),T=void 0,E()})["catch"](function(e){throw j=!1,m("writeCheckpoint completed with error",e),e})}function h(){var e={};return T.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(B.cancelled)throw g(),new Error("cancelled");T.diffs=e})}function v(){return u(e,T.diffs,B).then(function(e){e.forEach(function(e){delete T.diffs[e._id],f.docs_read++,T.docs.push(e)})})}function y(){if(!B.cancelled&&!T){if(0===I.length)return void _(!0);T=I.shift(),h().then(v).then(d).then(p).then(y)["catch"](function(e){m("batch processing terminated with error",e)})}}function _(e){return 0===A.changes.length?void(0!==I.length||T||((L&&U.live||D)&&(c.state="pending",c.emit("paused")),D&&g())):void((e||D||A.changes.length>=C)&&(I.push(A),A={seq:0,changes:[],docs:[]},("pending"===c.state||"stopped"===c.state)&&(c.state="active",c.emit("active")),y()))}function m(e,t){q||(t.message||(t.message=e),f.ok=!1,f.status="aborting",f.errors.push(t),P=P.concat(t),I=[],A={seq:0,changes:[],docs:[]},g())}function g(){if(!(q||B.cancelled&&(f.status="cancelled",j))){f.status=f.status||"complete",f.end_time=new Date,f.last_seq=R,q=B.cancelled=!0;var o=P.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name});if(o.length>0){var i=P.pop();P.length>0&&(i.other_errors=P),i.result=f,s(r,c,i,function(){n(e,t,r,c)})}else f.errors=P,c.emit("complete",f),c.removeAllListeners()}}function b(e){if(B.cancelled)return g();var t=o.filterChange(r)(e);t&&(A.seq=e.seq,A.changes.push(e),_(0===I.length))}function w(e){return $=!1,B.cancelled?g():(e.results.length>0?(U.since=e.last_seq,E()):L?(U.live=!0,E()):D=!0,void _(!0))}function S(e){return $=!1,B.cancelled?g():void m("changes rejected",e)}function E(){function t(){o.cancel()}function n(){c.removeListener("cancel",t)}if(!$&&!D&&I.length<N){$=!0,c._changes&&(c.removeListener("cancel",c._abortChanges),c._changes.cancel()),c.once("cancel",t);var o=e.changes(U).on("change",b);o.then(n,n),o.then(w)["catch"](S),r.retry&&(c._changes=o,c._abortChanges=t)}}function x(){l().then(function(){return B.cancelled?void g():O.getCheckpoint().then(function(e){R=e,U={since:R,limit:C,batch_size:C,style:"all_docs",doc_ids:M,returnDocs:!0},r.filter&&("string"!=typeof r.filter?U.include_docs=!0:U.filter=r.filter),r.query_params&&(U.query_params=r.query_params),r.view&&(U.view=r.view),E()})})["catch"](function(e){m("getCheckpoint rejected with ",e)})}var T,k,O,I=[],A={seq:0,changes:[],docs:[]},j=!1,D=!1,q=!1,R=0,L=r.continuous||r.live||!1,C=r.batch_size||100,N=r.batches_limit||10,$=!1,M=r.doc_ids,B={cancelled:!1},P=[],z=[],F=o.uuid();f=f||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var U={};return c.ready(e,t),c.cancelled?void g():(c._addedListeners||(c.once("cancel",g),"function"==typeof r.complete&&(c.once("error",r.complete),c.once("complete",function(e){r.complete(null,e)})),c._addedListeners=!0),void("undefined"==typeof r.since?x():l().then(function(){return j=!0,O.writeCheckpoint(r.since,F)}).then(function(){return j=!1,B.cancelled?void g():(R=r.since,void x())})["catch"](function(e){throw j=!1,m("writeCheckpoint completed with error",e),e})))}var o=e("./../utils"),i=e("./checkpointer"),s=e("./backoff"),a=e("./generateReplicationId"),u=e("./getDocs");t.exports=n},{"./../utils":160,"./backoff":150,"./checkpointer":151,"./generateReplicationId":152,"./getDocs":153}],156:[function(e,t,r){"use strict";function n(){i.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new s(function(t,r){e.once("complete",t),e.once("error",r)});e.then=function(e,r){return t.then(e,r)},e["catch"]=function(e){return t["catch"](e)},e["catch"](function(){})}var o=e("./../utils"),i=e("events").EventEmitter,s=o.Promise;o.inherits(n,i),n.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},n.prototype.ready=function(e,t){function r(){o.cancel()}function n(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}var o=this;o._readyCalled||(o._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),o.once("complete",n))},t.exports=n},{"./../utils":160,events:80}],157:[function(e,t,r){"use strict";function n(e){Object.keys(s.prototype).forEach(function(t){"function"==typeof s.prototype[t]&&(e[t]=u[t].bind(u))})}var o=e("./constructor"),i=e("./utils"),s=e("events").EventEmitter,a=e("./deps/env/hasLocalStorage");o.adapters={},o.preferredAdapters=[],o.prefix="_pouch_";var u=new s;n(o),o.parseAdapter=function(e,t){var r,n,i=e.match(/([a-z\-]*):\/\/(.*)/);if(i){if(e=/http(s?)/.test(i[1])?i[1]+"://"+i[2]:i[2],r=i[1],!o.adapters[r].valid())throw"Invalid adapter";return{name:e,adapter:i[1]}}var s="idb"in o.adapters&&"websql"in o.adapters&&a()&&localStorage["_pouch__websqldb_"+o.prefix+e];if(t.adapter)n=t.adapter;else if("undefined"!=typeof t&&t.db)n="leveldb";else for(var u=0;u<o.preferredAdapters.length;++u)if(n=o.preferredAdapters[u],n in o.adapters){if(s&&"idb"===n){console.log('PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}r=o.adapters[n];var c=r&&"use_prefix"in r?r.use_prefix:!0;return{name:c?o.prefix+e:e,adapter:n}},o.destroy=i.toPromise(function(e,t,r){console.log("PouchDB.destroy() is deprecated and will be removed. Please use db.destroy() instead."),("function"==typeof t||"undefined"==typeof t)&&(r=t,t={}),e&&"object"==typeof e&&(t=e,e=void 0),new o(e,t,function(e,t){return e?r(e):void t.destroy(r)})}),o.adapter=function(e,t,r){t.valid()&&(o.adapters[e]=t,r&&o.preferredAdapters.push(e))},o.plugin=function(e){return Object.keys(e).forEach(function(t){o.prototype[t]=e[t]}),o},o.defaults=function(e){function t(t,r,n){("function"==typeof r||"undefined"==typeof r)&&(n=r,r={}),t&&"object"==typeof t&&(r=t,t=void 0),r=i.extend(!0,{},e,r),o.call(this,t,r,n)}return i.inherits(t,o),t.destroy=i.toPromise(function(t,r,n){return("function"==typeof r||"undefined"==typeof r)&&(n=r,r={}),t&&"object"==typeof t&&(r=t,t=void 0),r=i.extend(!0,{},e,r),o.destroy(t,r,n)}),n(t),t.preferredAdapters=o.preferredAdapters.slice(),Object.keys(o).forEach(function(e){e in t||(t[e]=o[e])}),t},t.exports=o},{"./constructor":98,"./deps/env/hasLocalStorage":127,"./utils":160,events:80}],158:[function(e,t,r){"use strict";function n(e,t,r,n){return"function"==typeof r&&(n=r,r={}),"undefined"==typeof r&&(r={}),r=i.clone(r),r.PouchConstructor=r.PouchConstructor||this,e=s.toPouch(e,r),t=s.toPouch(t,r),new o(e,t,r,n)}function o(e,t,r,n){function o(e){p||(p=!0,d.emit("cancel",e))}function s(e){d.emit("change",{direction:"pull",change:e})}function u(e){d.emit("change",{direction:"push",change:e})}function c(e){d.emit("denied",{direction:"push",doc:e})}function f(e){d.emit("denied",{direction:"pull",doc:e})}function l(e){return function(t,r){var n="change"===t&&(r===s||r===u),i="cancel"===t&&r===o,a=t in h&&r===h[t];(n||i||a)&&(t in v||(v[t]={}),v[t][e]=!0,2===Object.keys(v[t]).length&&d.removeAllListeners(t))}}var d=this;this.canceled=!1,this.push=a(e,t,r),this.pull=a(t,e,r);var p=!1,h={},v={};r.live&&(this.push.on("complete",d.pull.cancel.bind(d.pull)),this.pull.on("complete",d.push.cancel.bind(d.push))),this.on("newListener",function(e){"change"===e?(d.pull.on("change",s),d.push.on("change",u)):"denied"===e?(d.pull.on("denied",f),d.push.on("denied",c)):"cancel"===e?(d.pull.on("cancel",o),d.push.on("cancel",o)):"error"===e||"removeListener"===e||"complete"===e||e in h||(h[e]=function(t){d.emit(e,t)},d.pull.on(e,h[e]),d.push.on(e,h[e]))}),this.on("removeListener",function(e){"change"===e?(d.pull.removeListener("change",s),d.push.removeListener("change",u)):"cancel"===e?(d.pull.removeListener("cancel",o),d.push.removeListener("cancel",o)):e in h&&"function"==typeof h[e]&&(d.pull.removeListener(e,h[e]),d.push.removeListener(e,h[e]),delete h[e])}),this.pull.on("removeListener",l("pull")),this.push.on("removeListener",l("push"));var y=i.Promise.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return d.emit("complete",t),n&&n(null,t),d.removeAllListeners(),t},function(e){throw d.cancel(),d.emit("error",e),n&&n(e),d.removeAllListeners(),e});this.then=function(e,t){return y.then(e,t)},this["catch"]=function(e){return y["catch"](e)}}var i=e("./utils"),s=e("./replicate"),a=s.replicate,u=e("events").EventEmitter;i.inherits(o,u),t.exports=n,o.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{"./replicate":154,"./utils":160,events:80}],159:[function(e,t,r){"use strict";function n(){this.isReady=!1,this.failed=!1,this.queue=[]}t.exports=n,n.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},n.prototype.fail=function(e){this.failed=e,this.execute()},n.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},n.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()}},{}],160:[function(e,t,r){var n=e("./merge");r.extend=e("pouchdb-extend"),r.ajax=e("./deps/ajax/prequest"),r.uuid=e("./deps/uuid"),r.getArguments=e("argsarray");var o=e("pouchdb-collections");r.Map=o.Map,r.Set=o.Set;var i=e("./deps/docs/parseDoc"),s=e("./deps/promise");r.Promise=s;var a=e("./deps/binary/base64");r.atob=a.atob,r.btoa=a.btoa;var u=e("./deps/binary/binaryStringToBlobOrBuffer");r.binaryStringToBlobOrBuffer=u,r.clone=function(e){return r.extend(!0,{},e)},r.pick=e("./deps/pick"),r.inherits=e("inherits"),r.call=e("./deps/call"),r.filterChange=function(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){if(n.doc||(n.doc={}),e.filter&&r&&!e.filter.call(this,n.doc,t))return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},r.parseDoc=i.parseDoc,r.invalidIdError=i.invalidIdError,r.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},r.Changes=e("./changesHandler"),r.once=e("./deps/once"),r.toPromise=e("./deps/toPromise"),r.adapterFun=function(t,n){function o(e,t,r){if(i.enabled){for(var n=[e._db_name,t],o=0;o<r.length-1;o++)n.push(r[o]);i.apply(null,n);var s=r[r.length-1];r[r.length-1]=function(r,n){var o=[e._db_name,t];o=o.concat(r?["error",r]:["success",n]),i.apply(null,o),s(r,n)}}}var i=e("debug")("pouchdb:api");return r.toPromise(r.getArguments(function(e){if(this._closed)return s.reject(new Error("database is closed"));var r=this;return o(r,t,e),this.taskqueue.isReady?n.apply(this,e):new s(function(n,o){r.taskqueue.addTask(function(i){i?o(i):n(r[t].apply(r,e))})})}))},r.explain404=e("./deps/ajax/explain404"),r.parseUri=e("./deps/parseUri"),r.compare=function(e,t){return t>e?-1:e>t?1:0},r.compactTree=function(e){var t=[];return n.traverseRevTree(e.rev_tree,function(e,r,n,o,i){"available"!==i.status||e||(t.push(r+"-"+n),i.status="missing")}),t};var c=e("vuvuzela");r.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return c.parse(e)}},r.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return c.stringify(e)}}},{"./changesHandler":97,"./deps/ajax/explain404":104,"./deps/ajax/prequest":106,"./deps/binary/base64":109,"./deps/binary/binaryStringToBlobOrBuffer":112,"./deps/call":118,"./deps/docs/parseDoc":123,"./deps/once":131,"./deps/parseUri":133,"./deps/pick":134,"./deps/promise":135,"./deps/toPromise":136,"./deps/uuid":138,"./merge":149,argsarray:162,debug:163,inherits:166,"pouchdb-collections":187,"pouchdb-extend":188,vuvuzela:191}],161:[function(e,t,r){t.exports="4.0.0"},{}],162:[function(e,t,r){"use strict";function n(e){return function(){var t=arguments.length;if(t){for(var r=[],n=-1;++n<t;)r[n]=arguments[n];return e.call(this,r)}return e.call(this,[])}}t.exports=n},{}],163:[function(e,t,r){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,n),e}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(t){}}function a(){var e;try{e=r.storage.debug}catch(t){}return e}function u(){try{return window.localStorage}catch(e){}}r=t.exports=e("./debug"),r.log=i,r.formatArgs=o,r.save=s,r.load=a,r.useColors=n,r.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){return JSON.stringify(e)},r.enable(a())},{"./debug":164}],164:[function(e,t,r){function n(){return r.colors[f++%r.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,i=t-(c||t);e.diff=i,e.prev=c,e.curr=t,c=t,null==e.useColors&&(e.useColors=r.useColors()),null==e.color&&e.useColors&&(e.color=n());var s=Array.prototype.slice.call(arguments);s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,n){if("%%"===t)return t;a++;var o=r.formatters[n];if("function"==typeof o){var i=s[a];t=o.call(e,i),s.splice(a,1),a--}return t}),"function"==typeof r.formatArgs&&(s=r.formatArgs.apply(e,s));var u=o.log||r.log||console.log.bind(console);u.apply(e,s)}t.enabled=!1,o.enabled=!0;var i=r.enabled(e)?o:t;return i.namespace=e,i}function i(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,o=0;n>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))}function s(){r.enable("")}function a(e){var t,n;for(t=0,n=r.skips.length;n>t;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;n>t;t++)if(r.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}r=t.exports=o,r.coerce=u,r.disable=s,r.enable=i,r.enabled=a,r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={};var c,f=0},{ms:165}],165:[function(e,t,r){function n(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*l;case"days":case"day":case"d":return r*f;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*u;case"seconds":case"second":case"secs":case"sec":case"s":return r*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function o(e){return e>=f?Math.round(e/f)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function i(e){return s(e,f,"day")||s(e,c,"hour")||s(e,u,"minute")||s(e,a,"second")||e+" ms"}function s(e,t,r){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var a=1e3,u=60*a,c=60*u,f=24*c,l=365.25*f;t.exports=function(e,t){return t=t||{},"string"==typeof e?n(e):t["long"]?i(e):o(e)}},{}],166:[function(e,t,r){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],167:[function(e,t,r){"use strict";function n(){}t.exports=n},{}],168:[function(e,t,r){"use strict";function n(e){function t(e,t){function o(e){c[t]=e,++f===r&!n&&(n=!0,u.resolve(d,c))}s(e).then(o,function(e){n||(n=!0,u.reject(d,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return s([]);for(var c=new Array(r),f=0,l=-1,d=new o(a);++l<r;)t(e[l],l);return d}var o=e("./promise"),i=e("./reject"),s=e("./resolve"),a=e("./INTERNAL"),u=e("./handlers");t.exports=n},{"./INTERNAL":167,"./handlers":169,"./promise":171,"./reject":174,"./resolve":175}],169:[function(e,t,r){"use strict";function n(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var o=e("./tryCatch"),i=e("./resolveThenable"),s=e("./states");r.resolve=function(e,t){var a=o(n,t);if("error"===a.status)return r.reject(e,a.value);var u=a.value;if(u)i.safely(e,u);else{e.state=s.FULFILLED,e.outcome=t;for(var c=-1,f=e.queue.length;++c<f;)e.queue[c].callFulfilled(t)}return e},r.reject=function(e,t){e.state=s.REJECTED,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e}},{"./resolveThenable":176,"./states":177,"./tryCatch":178}],170:[function(e,t,r){t.exports=r=e("./promise"),r.resolve=e("./resolve"),r.reject=e("./reject"),r.all=e("./all"),r.race=e("./race")},{"./all":168,"./promise":171,"./race":173,"./reject":174,"./resolve":175}],171:[function(e,t,r){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=a.PENDING,this.queue=[],this.outcome=void 0,e!==i&&s.safely(this,e)}var o=e("./unwrap"),i=e("./INTERNAL"),s=e("./resolveThenable"),a=e("./states"),u=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a.FULFILLED||"function"!=typeof t&&this.state===a.REJECTED)return this;var r=new n(i);if(this.state!==a.PENDING){var s=this.state===a.FULFILLED?e:t;o(r,s,this.outcome)}else this.queue.push(new u(r,e,t));return r}},{"./INTERNAL":167,"./queueItem":172,"./resolveThenable":176,"./states":177,"./unwrap":179}],
172:[function(e,t,r){"use strict";function n(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),i=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){o.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)}},{"./handlers":169,"./unwrap":179}],173:[function(e,t,r){"use strict";function n(e){function t(e){s(e).then(function(e){n||(n=!0,u.resolve(f,e))},function(e){n||(n=!0,u.reject(f,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return s([]);for(var c=-1,f=new o(a);++c<r;)t(e[c]);return f}var o=e("./promise"),i=e("./reject"),s=e("./resolve"),a=e("./INTERNAL"),u=e("./handlers");t.exports=n},{"./INTERNAL":167,"./handlers":169,"./promise":171,"./reject":174,"./resolve":175}],174:[function(e,t,r){"use strict";function n(e){var t=new o(i);return s.reject(t,e)}var o=e("./promise"),i=e("./INTERNAL"),s=e("./handlers");t.exports=n},{"./INTERNAL":167,"./handlers":169,"./promise":171}],175:[function(e,t,r){"use strict";function n(e){if(e)return e instanceof o?e:s.resolve(new o(i),e);var t=typeof e;switch(t){case"boolean":return a;case"undefined":return c;case"object":return u;case"number":return f;case"string":return l}}var o=e("./promise"),i=e("./INTERNAL"),s=e("./handlers");t.exports=n;var a=s.resolve(new o(i),!1),u=s.resolve(new o(i),null),c=s.resolve(new o(i),void 0),f=s.resolve(new o(i),0),l=s.resolve(new o(i),"")},{"./INTERNAL":167,"./handlers":169,"./promise":171}],176:[function(e,t,r){"use strict";function n(e,t){function r(t){a||(a=!0,o.reject(e,t))}function n(t){a||(a=!0,o.resolve(e,t))}function s(){t(n,r)}var a=!1,u=i(s);"error"===u.status&&r(u.value)}var o=e("./handlers"),i=e("./tryCatch");r.safely=n},{"./handlers":169,"./tryCatch":178}],177:[function(e,t,r){r.REJECTED=["REJECTED"],r.FULFILLED=["FULFILLED"],r.PENDING=["PENDING"]},{}],178:[function(e,t,r){"use strict";function n(e,t){var r={};try{r.value=e(t),r.status="success"}catch(n){r.status="error",r.value=n}return r}t.exports=n},{}],179:[function(e,t,r){"use strict";function n(e,t,r){o(function(){var n;try{n=t(r)}catch(o){return i.reject(e,o)}n===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,n)})}var o=e("immediate"),i=e("./handlers");t.exports=n},{"./handlers":169,immediate:180}],180:[function(e,t,r){"use strict";function n(){i=!0;for(var e,t,r=u.length;r;){for(t=u,u=[],e=-1;++e<r;)t[e]();r=u.length}i=!1}function o(e){1!==u.push(e)||i||s()}for(var i,s,a=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],u=[],c=-1,f=a.length;++c<f;)if(a[c]&&a[c].test&&a[c].test()){s=a[c].install(n);break}t.exports=o},{"./messageChannel":181,"./mutation.js":182,"./nextTick":79,"./stateChange":183,"./timeout":184}],181:[function(e,t,r){(function(e){"use strict";r.test=function(){return e.setImmediate?!1:"undefined"!=typeof e.MessageChannel},r.install=function(t){var r=new e.MessageChannel;return r.port1.onmessage=t,function(){r.port2.postMessage(0)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],182:[function(e,t,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(r){var n=0,o=new t(r),i=e.document.createTextNode("");return o.observe(i,{characterData:!0}),function(){i.data=n=++n%2}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],183:[function(e,t,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var r=e.document.createElement("script");return r.onreadystatechange=function(){t(),r.onreadystatechange=null,r.parentNode.removeChild(r),r=null},e.document.documentElement.appendChild(r),t}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],184:[function(e,t,r){"use strict";r.test=function(){return!0},r.install=function(e){return function(){setTimeout(e,0)}}},{}],185:[function(e,t,r){"use strict";function n(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return f(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),o=-1,i=n.length,s="";if(t)for(;++o<i;)s+=r.toIndexableString(n[o]);else for(;++o<i;){var a=n[o];s+=r.toIndexableString(a)+r.toIndexableString(e[a])}return s}return""}function o(e,t){var r,n=t,o="1"===e[t];if(o)r=0,t++;else{var i="0"===e[t];t++;var s="",a=e.substring(t,t+d),u=parseInt(a,10)+l;for(i&&(u=-u),t+=d;;){var c=e[t];if("\x00"===c)break;s+=c,t++}s=s.split("."),r=1===s.length?parseInt(s,10):parseFloat(s[0]+"."+s[1]),i&&(r-=10),0!==u&&(r=parseFloat(r+"e"+u))}return{num:r,length:t-n}}function i(e,t){var r=e.pop();if(t.length){var n=t[t.length-1];r===n.element&&(t.pop(),n=t[t.length-1]);var o=n.element,i=n.index;if(Array.isArray(o))o.push(r);else if(i===e.length-2){var s=e.pop();o[s]=r}else e.push(r)}}function s(e,t){for(var n=Math.min(e.length,t.length),o=0;n>o;o++){var i=r.collate(e[o],t[o]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function a(e,t){return e===t?0:e>t?1:-1}function u(e,t){for(var n=Object.keys(e),o=Object.keys(t),i=Math.min(n.length,o.length),s=0;i>s;s++){var a=r.collate(n[s],o[s]);if(0!==a)return a;if(a=r.collate(e[n[s]],t[o[s]]),0!==a)return a}return n.length===o.length?0:n.length>o.length?1:-1}function c(e){var t=["boolean","number","string","object"],r=t.indexOf(typeof e);return~r?null===e?1:Array.isArray(e)?5:3>r?r+2:r+3:Array.isArray(e)?5:void 0}function f(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),r=parseInt(t[1],10),n=0>e,o=n?"0":"2",i=(n?-r:r)-l,s=h.padLeft(i.toString(),"0",d);o+=p+s;var a=Math.abs(parseFloat(t[0]));n&&(a=10-a);var u=a.toFixed(20);return u=u.replace(/\.?0+$/,""),o+=p+u}var l=-324,d=3,p="",h=e("./utils");r.collate=function(e,t){if(e===t)return 0;e=r.normalizeKey(e),t=r.normalizeKey(t);var n=c(e),o=c(t);if(n-o!==0)return n-o;if(null===e)return 0;switch(typeof e){case"number":return e-t;case"boolean":return e===t?0:t>e?-1:1;case"string":return a(e,t)}return Array.isArray(e)?s(e,t):u(e,t)},r.normalizeKey=function(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-(1/0)||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var o=0;n>o;o++)e[o]=r.normalizeKey(t[o])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];"undefined"!=typeof s&&(e[i]=r.normalizeKey(s))}}}}return e},r.toIndexableString=function(e){var t="\x00";return e=r.normalizeKey(e),c(e)+p+n(e)+t},r.parseIndexableString=function(e){for(var t=[],r=[],n=0;;){var s=e[n++];if("\x00"!==s)switch(s){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var a=o(e,n);t.push(a.num),n+=a.length;break;case"4":for(var u="";;){var c=e[n];if("\x00"===c)break;u+=c,n++}u=u.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(u);break;case"5":var f={element:[],index:t.length};t.push(f.element),r.push(f);break;case"6":var l={element:{},index:t.length};t.push(l.element),r.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+s)}else{if(1===t.length)return t.pop();i(t,r)}}}},{"./utils":186}],186:[function(e,t,r){"use strict";function n(e,t,r){for(var n="",o=r-e.length;n.length<o;)n+=t;return n}r.padLeft=function(e,t,r){var o=n(e,t,r);return o+e},r.padRight=function(e,t,r){var o=n(e,t,r);return e+o},r.stringLexCompare=function(e,t){var r,n=e.length,o=t.length;for(r=0;n>r;r++){if(r===o)return 1;var i=e.charAt(r),s=t.charAt(r);if(i!==s)return s>i?-1:1}return o>n?-1:0},r.intToDecimalForm=function(e){var t=0>e,r="";do{var n=t?-Math.ceil(e%10):Math.floor(e%10);r=n+r,e=t?Math.ceil(e/10):Math.floor(e/10)}while(e);return t&&"0"!==r&&(r="-"+r),r}},{}],187:[function(e,t,r){"use strict";function n(){this.store={}}function o(e){if(this.store=new n,e&&Array.isArray(e))for(var t=0,r=e.length;r>t;t++)this.add(e[t])}r.Map=n,r.Set=o,n.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},n.prototype.unmangle=function(e){return e.substring(1)},n.prototype.get=function(e){var t=this.mangle(e);return t in this.store?this.store[t]:void 0},n.prototype.set=function(e,t){var r=this.mangle(e);return this.store[r]=t,!0},n.prototype.has=function(e){var t=this.mangle(e);return t in this.store},n.prototype["delete"]=function(e){var t=this.mangle(e);return t in this.store?(delete this.store[t],!0):!1},n.prototype.forEach=function(e){var t=this,r=Object.keys(t.store);r.forEach(function(r){var n=t.store[r];r=t.unmangle(r),e(n,r)})},o.prototype.add=function(e){return this.store.set(e,!0)},o.prototype.has=function(e){return this.store.has(e)},o.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],188:[function(e,t,r){"use strict";function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?c[p.call(e)]||"object":typeof e}function o(e){return null!==e&&e===e.window}function i(e){if(!e||"object"!==n(e)||e.nodeType||o(e))return!1;try{if(e.constructor&&!h.call(e,"constructor")&&!h.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var r;for(r in e);return void 0===r||h.call(e,r)}function s(e){return"function"===n(e)}function a(){for(var e=[],t=-1,r=arguments.length,n=new Array(r);++t<r;)n[t]=arguments[t];var o={};e.push({args:n,result:{container:o,key:"key"}});for(var i;i=e.pop();)u(e,i.args,i.result);return o.key}function u(e,t,r){var n,o,a,u,c,f,l,d=t[0]||{},p=1,h=t.length,y=!1,_=/\d+/;for("boolean"==typeof d&&(y=d,d=t[1]||{},p=2),"object"==typeof d||s(d)||(d={}),h===p&&(d=this,--p);h>p;p++)if(null!=(n=t[p])){l=v(n);for(o in n)if(!(o in Object.prototype)){if(l&&!_.test(o))continue;if(a=d[o],u=n[o],d===u)continue;y&&u&&(i(u)||(c=v(u)))?(c?(c=!1,f=a&&v(a)?a:[]):f=a&&i(a)?a:{},e.push({args:[y,f,u],result:{container:d,key:o}})):void 0!==u&&(v(n)&&s(u)||(d[o]=u))}}r.container[r.key]=d}for(var c={},f=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],l=0;l<f.length;l++){var d=f[l];c["[object "+d+"]"]=d.toLowerCase()}var p=c.toString,h=c.hasOwnProperty,v=Array.isArray||function(e){return"array"===n(e)};t.exports=a},{}],189:[function(e,t,r){(function(t){"use strict";function n(e,t,r){return new i(function(n,i){return"string"!=typeof t?i(new Error("doc id is required")):void e.get(t,function(s,a){if(s){if(404!==s.status)return i(s);a={}}var u=a._rev,c=r(a);return c?(c._id=t,c._rev=u,void n(o(e,c,r))):n({updated:!1,rev:u})})})}function o(e,t,r){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(o){if(409!==o.status)throw o;return n(e,t._id,r)})}var i;i="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof t.Promise?t.Promise:e("lie"),r.upsert=function(e,t,r){var o=this,i=n(o,e,t);return"function"!=typeof r?i:void i.then(function(e){r(null,e)},r)},r.putIfNotExists=function(e,t,r){var o=this;"string"!=typeof e&&(r=t,t=e,e=t._id);var i=function(e){return e._rev?!1:t},s=n(o,e,i);return"function"!=typeof r?s:void s.then(function(e){r(null,e)},r)},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(r)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{lie:170}],190:[function(e,t,r){!function(e){if("object"==typeof r)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;try{n=window}catch(o){n=self}n.SparkMD5=e()}}(function(e){"use strict";var t=function(e,t){return e+t&4294967295},r=function(e,r,n,o,i,s){return r=t(t(r,e),t(o,s)),t(r<<i|r>>>32-i,n)},n=function(e,t,n,o,i,s,a){return r(t&n|~t&o,e,t,i,s,a)},o=function(e,t,n,o,i,s,a){return r(t&o|n&~o,e,t,i,s,a)},i=function(e,t,n,o,i,s,a){return r(t^n^o,e,t,i,s,a)},s=function(e,t,n,o,i,s,a){return r(n^(t|~o),e,t,i,s,a)},a=function(e,r){var a=e[0],u=e[1],c=e[2],f=e[3];a=n(a,u,c,f,r[0],7,-680876936),f=n(f,a,u,c,r[1],12,-389564586),c=n(c,f,a,u,r[2],17,606105819),u=n(u,c,f,a,r[3],22,-1044525330),a=n(a,u,c,f,r[4],7,-176418897),f=n(f,a,u,c,r[5],12,1200080426),c=n(c,f,a,u,r[6],17,-1473231341),u=n(u,c,f,a,r[7],22,-45705983),a=n(a,u,c,f,r[8],7,1770035416),f=n(f,a,u,c,r[9],12,-1958414417),c=n(c,f,a,u,r[10],17,-42063),u=n(u,c,f,a,r[11],22,-1990404162),a=n(a,u,c,f,r[12],7,1804603682),f=n(f,a,u,c,r[13],12,-40341101),c=n(c,f,a,u,r[14],17,-1502002290),u=n(u,c,f,a,r[15],22,1236535329),a=o(a,u,c,f,r[1],5,-165796510),f=o(f,a,u,c,r[6],9,-1069501632),c=o(c,f,a,u,r[11],14,643717713),u=o(u,c,f,a,r[0],20,-373897302),a=o(a,u,c,f,r[5],5,-701558691),f=o(f,a,u,c,r[10],9,38016083),c=o(c,f,a,u,r[15],14,-660478335),u=o(u,c,f,a,r[4],20,-405537848),a=o(a,u,c,f,r[9],5,568446438),f=o(f,a,u,c,r[14],9,-1019803690),c=o(c,f,a,u,r[3],14,-187363961),u=o(u,c,f,a,r[8],20,1163531501),a=o(a,u,c,f,r[13],5,-1444681467),f=o(f,a,u,c,r[2],9,-51403784),c=o(c,f,a,u,r[7],14,1735328473),u=o(u,c,f,a,r[12],20,-1926607734),a=i(a,u,c,f,r[5],4,-378558),f=i(f,a,u,c,r[8],11,-2022574463),c=i(c,f,a,u,r[11],16,1839030562),u=i(u,c,f,a,r[14],23,-35309556),a=i(a,u,c,f,r[1],4,-1530992060),f=i(f,a,u,c,r[4],11,1272893353),c=i(c,f,a,u,r[7],16,-155497632),u=i(u,c,f,a,r[10],23,-1094730640),a=i(a,u,c,f,r[13],4,681279174),f=i(f,a,u,c,r[0],11,-358537222),c=i(c,f,a,u,r[3],16,-722521979),u=i(u,c,f,a,r[6],23,76029189),a=i(a,u,c,f,r[9],4,-640364487),f=i(f,a,u,c,r[12],11,-421815835),c=i(c,f,a,u,r[15],16,530742520),u=i(u,c,f,a,r[2],23,-995338651),a=s(a,u,c,f,r[0],6,-198630844),f=s(f,a,u,c,r[7],10,1126891415),c=s(c,f,a,u,r[14],15,-1416354905),u=s(u,c,f,a,r[5],21,-57434055),a=s(a,u,c,f,r[12],6,1700485571),f=s(f,a,u,c,r[3],10,-1894986606),c=s(c,f,a,u,r[10],15,-1051523),u=s(u,c,f,a,r[1],21,-2054922799),a=s(a,u,c,f,r[8],6,1873313359),f=s(f,a,u,c,r[15],10,-30611744),c=s(c,f,a,u,r[6],15,-1560198380),u=s(u,c,f,a,r[13],21,1309151649),a=s(a,u,c,f,r[4],6,-145523070),f=s(f,a,u,c,r[11],10,-1120210379),c=s(c,f,a,u,r[2],15,718787259),u=s(u,c,f,a,r[9],21,-343485551),e[0]=t(a,e[0]),e[1]=t(u,e[1]),e[2]=t(c,e[2]),e[3]=t(f,e[3])},u=function(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r},c=function(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r},f=function(e){var t,r,n,o,i,s,c=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(f,u(e.substring(t-64,t)));for(e=e.substring(t-64),r=e.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(a(f,n),t=0;16>t;t+=1)n[t]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),s=parseInt(o[1],16)||0,n[14]=i,n[15]=s,a(f,n),f},l=function(e){var t,r,n,o,i,s,u=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(t=64;u>=t;t+=64)a(f,c(e.subarray(t-64,t)));for(e=u>t-64?e.subarray(t-64):new Uint8Array(0),r=e.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(a(f,n),t=0;16>t;t+=1)n[t]=0;return o=8*u,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),s=parseInt(o[1],16)||0,n[14]=i,n[15]=s,a(f,n),f},d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(e){var t,r="";for(t=0;4>t;t+=1)r+=d[e>>8*t+4&15]+d[e>>8*t&15];return r},h=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")},v=function(e){return h(f(e))},y=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==v("hello")&&(t=function(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}),y.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},y.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;r>=t;t+=64)a(this._state,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},y.prototype.end=function(e){var t,r,n=this._buff,o=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;o>t;t+=1)i[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(i,o),r=e?this._state:h(this._state),this.reset(),r},y.prototype._finish=function(e,t){var r,n,o,i=t;if(e[i>>2]|=128<<(i%4<<3),i>55)for(a(this._state,e),i=0;16>i;i+=1)e[i]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=n,e[15]=o,a(this._state,e)},y.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},y.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var r=f(e);return t?r:h(r)},y.hashBinary=function(e,t){var r=f(e);return t?r:h(r)},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(e){var t,r=this._concatArrayBuffer(this._buff,e),n=r.length;for(this._length+=e.byteLength,t=64;n>=t;t+=64)a(this._state,c(r.subarray(t-64,t)));return this._buff=n>t-64?r.subarray(t-64):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,o=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;o>t;t+=1)i[t>>2]|=n[t]<<(t%4<<3);return this._finish(i,o),r=e?this._state:h(this._state),this.reset(),r},y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var r=e.length,n=new Uint8Array(r+t.byteLength);return n.set(e),n.set(new Uint8Array(t),r),n},y.ArrayBuffer.hash=function(e,t){var r=l(new Uint8Array(e));return t?r:h(r)},y})},{}],191:[function(e,t,r){"use strict";function n(e,t,r){var n=r[r.length-1];e===n.element&&(r.pop(),n=r[r.length-1]);var o=n.element,i=n.index;if(Array.isArray(o))o.push(e);else if(i===t.length-2){var s=t.pop();o[s]=e}else t.push(e)}r.stringify=function(e){var t=[];t.push({obj:e});for(var r,n,o,i,s,a,u,c,f,l,d,p="";r=t.pop();)if(n=r.obj,o=r.prefix||"",i=r.val||"",p+=o,i)p+=i;else if("object"!=typeof n)p+="undefined"==typeof n?null:JSON.stringify(n);else if(null===n)p+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),s=n.length-1;s>=0;s--)a=0===s?"":",",t.push({obj:n[s],prefix:a});t.push({val:"["})}else{u=[];for(c in n)n.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),s=u.length-1;s>=0;s--)f=u[s],l=n[f],d=s>0?",":"",d+=JSON.stringify(f)+":",t.push({obj:l,prefix:d});t.push({val:"{"})}return p},r.parse=function(e){for(var t,r,o,i,s,a,u,c,f,l=[],d=[],p=0;;)if(t=e[p++],"}"!==t&&"]"!==t&&"undefined"!=typeof t)switch(t){case" ":case"	":case"\n":case":":case",":break;case"n":p+=3,n(null,l,d);break;case"t":p+=3,n(!0,l,d);break;case"f":p+=4,n(!1,l,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(r="",p--;;){if(o=e[p++],!/[\d\.\-e\+]/.test(o)){p--;break}r+=o}n(parseFloat(r),l,d);break;case'"':for(i="",s=void 0,a=0;;){if(u=e[p++],'"'===u&&("\\"!==s||a%2!==1))break;i+=u,s=u,"\\"===s?a++:a=0}n(JSON.parse('"'+i+'"'),l,d);break;case"[":c={element:[],index:l.length},l.push(c.element),d.push(c);break;case"{":f={element:{},index:l.length},l.push(f.element),d.push(f);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===l.length)return l.pop();n(l.pop(),l,d)}}},{}],192:[function(e,t,r){!function(t,n){if("function"==typeof define&&define.amd)define(["exports","./record","./list","./typed"],n);else if("undefined"!=typeof r)n(r,e("./record"),e("./list"),e("./typed"));else{var o={exports:{}};n(o.exports,t.record,t.list,t.typed),t.index=o.exports}}(this,function(e,t,r,n){"use strict";Object.defineProperty(e,"Record",{enumerable:!0,get:function(){return t.Record}}),Object.defineProperty(e,"List",{enumerable:!0,get:function(){return r.List}}),Object.defineProperty(e,"Typed",{enumerable:!0,get:function(){return n.Typed}}),Object.defineProperty(e,"typeOf",{enumerable:!0,get:function(){return n.typeOf}}),Object.defineProperty(e,"Type",{enumerable:!0,get:function(){return n.Type}}),Object.defineProperty(e,"Any",{enumerable:!0,get:function(){return n.Any}}),Object.defineProperty(e,"Union",{enumerable:!0,get:function(){return n.Union}}),Object.defineProperty(e,"Maybe",{enumerable:!0,get:function(){return n.Maybe}})})},{"./list":193,"./record":194,"./typed":195}],193:[function(e,t,r){!function(t,n){if("function"==typeof define&&define.amd)define(["exports","./typed","immutable"],n);else if("undefined"!=typeof r)n(r,e("./typed"),e("immutable"));else{var o={exports:{}};n(o.exports,t.typed,t.Immutable),t.list=o.exports}}(this,function(e,t,r){"use strict";function n(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&n(e,t)}function a(){}var u=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){o=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=function(e,t,r){for(var n=!0;n;){var o=e,i=t,s=r;a=c=u=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,r=s,n=!0}},l=r.List,d=r.Iterable.Indexed,p=t.Typed.store,h=t.Typed.type,v=t.Typed.read,y=t.Typed.step,_=t.Typed.init,m=t.Typed.result,g=t.Typed.label,b=t.Typed.typeName,w=t.Typed.empty,S=function(e,r){var n=r(e[p]);if(n===e[p])return e;var o=e.__ownerID?e:t.construct(e);return o[p]=n,o.size=n.size,o},E=function(e){return e.clear()},x=function(e){return e.pop()},T=function(e){return e.shift()},k=function(e){function r(){i(this,r),f(Object.getPrototypeOf(r.prototype),"constructor",this).apply(this,arguments)}return s(r,e),c(r,[{key:t.Typed.typeName,value:function(){return"TypeInferer"}},{key:t.Typed.read,value:function(e){var r=t.typeOf(e).constructor.prototype;return this.type=this.type?t.Union(this.type,r):r,e}}]),r}(t.Type);a.prototype=l.prototype;var O=function(e){function r(e){return i(this,r),f(Object.getPrototypeOf(r.prototype),"constructor",this).call(this),r.prototype[v](e)}return s(r,e),c(r,null,[{key:"from",value:function(e){var r=t.construct(this.prototype);return r[p]=e[p],r.size=e.size,r}}]),c(r,[{key:t.Typed.init,value:function(){var e=t.construct(this).asMutable();return e[h]=new k,e}},{key:t.Typed.result,value:function(e){var t=e.asImmutable();return t[h]=e[h].type,t}},{key:t.Typed.read,value:function(e){var r=this.constructor;if(null===e||void 0===e){if(!this[w]){var n=t.construct(this);n[p]=l(),n.size=0,this[w]=n}return this[w]}if(e instanceof r&&e&&e.constructor===r)return e;var o=d(e),i=0===o.size;if(i&&this[w])return this[w];var s=this[_]();return s.size=o.size,o.forEach(function(e,t){s.set(t,e)}),s=this[m](s),i&&(this[w]=s),s}},{key:t.Typed.step,value:function(e,t){var r=u(t,2),n=r[0],o=r[1];return S(e,function(){var e=arguments.length<=0||void 0===arguments[0]?l():arguments[0];return e.set(n,o)})}},{key:t.Typed.typeName,value:function(){return this[g]||"Typed.List("+this[h][b]()+")"}},{key:"toString",value:function(){return this.__toString(this[b]()+"([","])")}},{key:"has",value:function(e){return this[p].has(e)}},{key:"get",value:function(e,t){return this[p]?this[p].get(e,t):t}},{key:"clear",value:function(){return this.__ownerID?S(this,E):this[w]||this[v]()}},{key:"remove",value:function(e){return S(this,function(t){return t&&t.remove(e)})}},{key:"set",value:function(e,t){if(e>this.size)throw TypeError('Index "'+e+'" is out of bound');var r=this[h][v](t);if(r instanceof TypeError)throw TypeError("Invalid value: "+r.message);return this[y](this,[e,r])}},{key:"push",value:function(){for(var e=this[h],t=[],r=arguments.length,n=Array(r),o=0;r>o;o++)n[o]=arguments[o];for(var i=n.length,s=0;i>s;){var a=n[s],u=e[v](a);if(u instanceof TypeError)throw TypeError("Invalid value: "+u.message);t.push(u),s+=1}return S(this,function(e){return e?e.push.apply(e,t):l.apply(void 0,t)})}},{key:"pop",value:function(){return S(this,x)}},{key:"unshift",value:function(){for(var e=this[h],t=[],r=arguments.length,n=Array(r),o=0;r>o;o++)n[o]=arguments[o];for(var i=n.length,s=0;i>s;){var a=n[s],u=e[v](a);if(u instanceof TypeError)throw TypeError("Invalid value: "+u.message);t.push(u),s+=1}return S(this,function(e){return e?e.unshift.apply(e,t):l.apply(void 0,t)})}},{key:"shift",value:function(){return S(this,T)}},{key:"setSize",value:function(e){if(e>this.size)throw TypeError("setSize may only downsize");return S(this,function(t){return t.setSize(e)})}},{key:"slice",value:function(e,t){return S(this,function(r){return r&&r.slice(e,t)})}},{key:"wasAltered",value:function(){return this[p].wasAltered()}},{key:"__ensureOwner",value:function(e){var r=this.__ownerID===e?this:e?t.construct(this):this;return r.__ownerID=e,r[p]=this[p]?this[p].__ensureOwner(e):l().__ensureOwner(e),r.size=r[p].size,r}},{key:"__iterator",value:function(e,t){var r=this;return d(this[p]).map(function(e,t){return r.get(t)}).__iterator(e,t)}},{key:"__iterate",value:function(e,t){var r=this;return d(this[p]).map(function(e,t){return r.get(t)}).__iterate(e,t)}}]),r}(a);O.prototype[t.Typed.DELETE]=O.prototype.remove;var I=function(){};I.prototype=O.prototype;var A=function(e){function r(){i(this,r),f(Object.getPrototypeOf(r.prototype),"constructor",this).call(this)}return s(r,e),c(r,[{key:t.Typed.init,value:function(){return t.construct(this).asMutable()}},{key:t.Typed.result,value:function(e){return e.asImmutable()}},{key:"map",value:function(e,r){if(0===this.size)return this;var n=O.from(this).map(e,r);if(this[p]===n[p])return this;if(n[h]===this[h]){var o=t.construct(this);return o[p]=n[p],o.size=n.size,o}return n}}]),r}(I),j=function(e,n){var i;if(void 0===e)throw TypeError("Typed.List must be passed a type descriptor");if(e===t.Any)return r.List;var s=t.typeOf(e);if(s===t.Any)throw TypeError("Typed.List was passed an invalid type descriptor: ${descriptor}");var a=function u(e){var t=this instanceof u,r=t?this.constructor:u;if(e instanceof r)return e;var n=r.prototype[v](e);if(n instanceof TypeError)throw n;return!t||this[p]?n:(this[p]=n[p],this.size=n.size,this)};return a.of=l.of,a.prototype=Object.create(D,(i={constructor:{value:a}},o(i,h,{value:s}),o(i,g,{value:n}),i)),a};e.List=j,j.Type=A,j.prototype=A.prototype;var D=A.prototype})},{"./typed":195,immutable:82}],194:[function(e,t,r){!function(t,n){if("function"==typeof define&&define.amd)define(["exports","./typed","immutable"],n);else if("undefined"!=typeof r)n(r,e("./typed"),e("immutable"));else{var o={exports:{}};n(o.exports,t.typed,t.immutable),t.record=o.exports}}(this,function(e,t,r){"use strict";function n(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&n(e,t)}var a=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){o=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function(e,t,r){for(var n=!0;n;){var o=e,i=t,s=r;a=c=u=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,r=s,n=!0}},f=r.Iterable.Keyed,l=function(e){return function(){return this.get(e)}},d=function(e){return function(t){if(!this.__ownerID)throw TypeError("Cannot set on an immutable record.");this.set(e,t)}},p=t.Typed.store,h=t.Typed.type,v=t.Typed.step,y=t.Typed.init,_=t.Typed.result,m=t.Typed.read,g=t.Typed.label,b=t.Typed.empty,w=t.Typed.typeName,S=t.Typed.typeSignature,E=function(){};E.prototype=r.Iterable.Keyed.prototype;var x=function(e){function n(){i(this,n),c(Object.getPrototypeOf(n.prototype),"constructor",this).call(this)}return s(n,e),u(n,[{key:t.Typed.init,value:function(){return t.construct(this).asMutable()}},{key:t.Typed.result,value:function(e){return e.asImmutable()}},{key:t.Typed.read,value:function o(e){var t=this.constructor;if(e instanceof t&&e&&e.constructor===t)return e;if(null===e||e&&"object"!=typeof e)return TypeError('Invalid data structure "'+e+'" was passed to '+this[w]());var n=r.Seq(e),i=this[h],s=0===n.size;if(s&&this[b])return this[b];var a=void 0;for(var u in i){var c=i[u],o=n.has(u)?n.get(u):this.get(u),f=c[m](o);if(f instanceof TypeError)return TypeError('Invalid value for "'+u+'" field:\n '+f.message);a=this[v](a||this[y](),[u,f])}return a=this[_](a),s&&(this[b]=a),a}},{key:t.Typed.step,value:function(e,n){var o=a(n,2),i=o[0],s=o[1],u=e[p]?e[p].set(i,s):new r.Map([[i,s]]);if(e[p]===u)return e;var c=e.__ownerID?e:t.construct(e);return c[p]=u,c}},{key:t.Typed.typeSignature,value:function(){var e=this[h],t=[];for(var r in e)t.push(r+": "+e[r][w]());return"Typed.Record({"+t.join(", ")+"})"}},{key:t.Typed.typeName,value:function(){return this[g]||this[S]()}},{key:"toString",value:function(){return this.__toString(this[w]()+"({","})")}},{key:"has",value:function(e){return!!this[h][e]}},{key:"get",value:function(e,t){return this[h][e]&&this[p]?this[p].get(e,t):t}},{key:"clear",value:function(){return this.__ownerID?(this[p]&&this[p].clear(),
this):this[b]||(this[b]=new this.constructor)}},{key:"remove",value:function(e){return this[h][e]?this.set(e,void 0):this}},{key:"set",value:function(e,t){var r=this[h][e];if(!r)throw TypeError('Cannot set unknown field "'+e+'" on "'+this[w]()+'"');var n=r[m](t);if(n instanceof TypeError)throw TypeError("Invalid value for "+e+" field: "+n.message);return this[v](this,[e,n])}},{key:"__iterator",value:function(e,t){var r=this;return f(this[h]).map(function(e,t){return r.get(t)}).__iterator(e,t)}},{key:"__iterate",value:function(e,t){var r=this;return f(this[h]).map(function(e,t){return r.get(t)}).__iterate(e,t)}},{key:"__ensureOwner",value:function(e){if(e===this.__ownerID)return this;var r=this[p]&&this[p].__ensureOwner(e),n=e?t.construct(this):this;return n.__ownerID=e,n[p]=r,n}},{key:"wasAltered",value:function(){return this[p].wasAltered()}}]),n}(E),T=function(e,r){if(!e||"object"!=typeof e)throw TypeError("Typed.Record must be passed a descriptor of fields");var n=Object.create(null),i=Object.keys(e),s=i.length;if(!(s>0))throw TypeError("Typed.Record descriptor must define at least on field");var a,u=function(){for(var u=(a={size:{value:s}},o(a,h,{value:n}),o(a,g,{value:r}),a),c=0;s>c;){var f=i[c],v=t.typeOf(e[f]);if(!v)throw TypeError('Invalid field descriptor provided for a "'+f+'" field');n[f]=v,u[f]={get:l(f),set:d(f),enumerable:!0},c+=1}var y=function _(e){var t=this instanceof _,r=t?this.constructor:_;if(e instanceof r)return e;var n=r.prototype,o=n[m](e);if(o instanceof TypeError)throw o;return t?void(this[p]=o[p]):o};u.constructor={value:y},y.prototype=Object.create(k,u);y.prototype;return{v:y}}();return"object"==typeof u?u.v:void 0};e.Record=T,T.Type=x,T.prototype=x.prototype;var k=x.prototype;k[t.Typed.DELETE]=k.remove,k.deleteIn=r.Map.prototype.deleteIn,k.removeIn=r.Map.prototype.removeIn,k.merge=r.Map.prototype.merge,k.mergeWith=r.Map.prototype.mergeWith,k.mergeIn=r.Map.prototype.mergeIn,k.mergeDeep=r.Map.prototype.mergeDeep,k.mergeDeepWith=r.Map.prototype.mergeDeepWith,k.mergeDeepIn=r.Map.prototype.mergeDeepIn,k.setIn=r.Map.prototype.setIn,k.update=r.Map.prototype.update,k.updateIn=r.Map.prototype.updateIn,k.withMutations=r.Map.prototype.withMutations,k.asMutable=r.Map.prototype.asMutable,k.asImmutable=r.Map.prototype.asImmutable,k.map=void 0,k.filter=void 0,k.filterNot=void 0,k.flip=void 0,k.mapKeys=void 0,k.mapEntries=void 0,k.sort=void 0,k.sortBy=void 0,k.reverse=void 0,k.slice=void 0,k.butLast=void 0,k.flatMap=void 0,k.flatten=void 0,k.rest=void 0,k.skip=void 0,k.skipLast=void 0,k.skipWhile=void 0,k.skipUntil=void 0,k.sortBy=void 0,k.take=void 0,k.takeLast=void 0,k.takeWhile=void 0,k.takeUntil=void 0})},{"./typed":195,immutable:82}],195:[function(e,t,r){!function(t,n){if("function"==typeof define&&define.amd)define(["exports","immutable"],n);else if("undefined"!=typeof r)n(r,e("immutable"));else{var o={exports:{}};n(o.exports,t.Immutable),t.typed=o.exports}}(this,function(e,t){"use strict";function r(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&r(e,t)}function i(){}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e,t,r){for(var n=!0;n;){var o=e,i=t,s=r;a=c=u=void 0,n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,r=s,n=!0}};if("undefined"==typeof u){var u=function(e){return"@@"+e};u["for"]=u}var c=function(e){return i.prototype=e.constructor.prototype,new i};e.construct=c;var f=u["for"]("typed/type"),l=u["for"]("typed/store"),d=u["for"]("typed/empty"),p=u["for"]("typed/type/maybe"),h=u["for"]("typed/type/default"),v=u["for"]("typed/type/label"),y=u["for"]("transducer/init"),_=u["for"]("transducer/result"),m=u["for"]("transducer/step"),g=u["for"]("typed/type/read"),b=u["for"]("typed/type/parse"),w=u("typed/type/name"),S=u("typed/type/signature"),E=function(e,t,r){var i=function(e){function t(e){n(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this[h]=e}return o(t,e),t}(T),s=i.prototype;s[h]=r,s[b]=t,s[v]=e;var u=function(e){return void 0===e?s:new i(e)};return u.prototype=s,u};e.Typed=E,E.label=v,E.defaultValue=h,E.read=g,E.typeName=w,E.typeSignature=S,E.type=f,E.store=l,E.init=y,E.result=_,E.step=m,E.DELETE="delete",E.empty=d;var x=function(e){return e[w]()},T=function(){function e(){n(this,e)}return s(e,[{key:E.read,value:function(){var e=arguments.length<=0||void 0===arguments[0]?this[h]:arguments[0];return this[b](e)}},{key:E.parse,value:function(e){throw TypeError('Type implementation must implement "[read.symbol]" method')}},{key:E.typeName,value:function(){var e=this[v],t=this[h];return void 0===t?e:e+"("+JSON.stringify(t)+")"}}]),e}();e.Type=T;var k=Object.prototype,O=Array.isArray||function(e){return"[object Array]"===k.toString.call(e)},I=function(e){return"[object RegExp]"===k.toString.call(e)},A=function(e){var t=arguments.length<=1||void 0===arguments[1]?typeof e:arguments[1];return function(){return void 0===e?e:null===e?e:e[g]?e:e.prototype&&e.prototype[g]?e.prototype:"number"===t?new E.Number(e):"string"===t?new E.String(e):"boolean"===t?new E.Boolean(e):"symbol"===t?new E.Symbol(e):O(e)?E.Array(e):I(e)?new E.RegExp(e):e===String?E.String.prototype:e===Number?E.Number.prototype:e===Boolean?E.Boolean.prototype:e===RegExp?E.RegExp.prototype:e===Array?E.Array.prototype:e===u?E.Symbol.prototype:e===Date?E.Date.prototype:j}()};e.typeOf=A;var j=E("Any",function(e){return e})();e.Any=j,E.Any=j,E.Number=E("Number",function(e){return"number"==typeof e?e:TypeError('"'+e+'" is not a number')}),E.String=E("String",function(e){return"string"==typeof e?e:TypeError('"'+e+'" is not a string')}),E.Symbol=E("Symbol",function(e){return"symbol"==typeof e?e:TypeError('"'+e+'" is not a symbol')}),E.Array=E("Array",function(e){return O(e)?e:TypeError('"'+e+'" is not an array')}),E.RegExp=E("RegExp",function(e){return e instanceof RegExp?e:TypeError('"'+e+'" is not a regexp')}),E.Boolean=E("Boolean",function(e){return e===!0?!0:e===!1?!1:TypeError('"'+e+'" is not a boolean')});var D=function(e){function t(e){n(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this[f]=e}return o(t,e),s(t,[{key:E.typeName,value:function(){return"Maybe("+this[f][w]()+")"}},{key:E.read,value:function(e){var t=null==e?null:this[f][g](e);return t instanceof TypeError?TypeError('"'+e+'" is not nully nor it is of '+this[f][w]()+" type"):t}}]),t}(T),q=function(e){var t=A(e);if(t===j)throw TypeError(e+" is not a valid type");return t[p]||(t[p]=new D(t))};e.Maybe=q,q.Type=D;var R=function(e){function t(e){n(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this[f]=e}return o(t,e),s(t,[{key:E.typeName,value:function(){return"Union("+this[f].map(x).join(", ")+")"}},{key:E.read,value:function(e){for(var t=this[f],r=t.length,n=0;r>n;){var o=t[n];if(e instanceof o.constructor)return e;n+=1}for(n=0;r>n;){var i=t[n][g](e);if(!(i instanceof TypeError))return i;n+=1}return TypeError('"'+e+'" does not satisfy '+this[w]()+" type")}}]),t}(T),L=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})},C=function(e,t){if(e.length>t.length){var r=L(t,e);return 0===r.length?e:e.concat(r)}var r=L(e,t);return 0===r.length?t:r.concat(t)},N=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=t.length;if(0===n)throw TypeError("Union must be of at at least one type");for(var o=null,i=null,s=0;n>s;){var a=A(t[s]);if(a===j)return j;if(o){if(o.indexOf(a)<0)if(a instanceof R){var u=C(o,a[f]);u===a[f]?(i=a,o=u):u!==o&&(i=null,o=u)}else i=null,o.push(a)}else i=a,o=i instanceof R?i[f]:[a];s+=1}return i?i:new R(o)};e.Union=N,N.Type=R,E.Number.Range=function(e,t,r){return void 0===t&&(t=+(1/0)),E("Typed.Number.Range("+e+".."+t+")",function(r){return"number"!=typeof r?TypeError('"'+r+'" is not a number'):r>=e&&t>=r?r:TypeError('"'+r+"\" isn't in the range of "+e+".."+t)},r)}})},{immutable:82}],196:[function(e,t,r){"use strict";{var n,o,i,s,a,u=e("babel-runtime/helpers/define-property")["default"],c=e("babel-runtime/helpers/create-class")["default"],f=e("babel-runtime/helpers/class-call-check")["default"],l=e("babel-runtime/regenerator")["default"],d=e("babel-runtime/core-js/object/assign")["default"],p=e("babel-runtime/core-js/promise")["default"],h=e("pouchdb"),v=e("../lang/task"),y=v.spawn,_=v.async,m=v.schedule,g=e("../lang/functional"),b=g.identity,w=e("typed-immutable"),S=w.Record,E=w.List,x=w.Maybe,T=w.Any;w.Union}h.id="_id",h.revision="_rev";var k=String,O=String,I=Number,A=String,j=String,D=String,q=T,R=function(e){return(new TextEncoder).encode(e)},L=function(e){return crypto.subtle.digest("SHA-256",R(e)).then(btoa)},C=_(l.mark(function H(e,t){var r;return l.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.get(t[h.id]);case 3:return r=n.sent,n.abrupt("return",new t.constructor(r));case 7:if(n.prev=7,n.t0=n["catch"](0),404===n.t0.status){n.next=11;break}throw n.t0;case 11:return n.abrupt("return",t);case 12:case"end":return n.stop()}},H,this,[[0,7]])})),N=l.mark(function V(e,t,r){var n;return l.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=3,C(e,t);case 3:return n=o.sent,o.prev=4,o.abrupt("return",e.put(r(n).toJSON()));case 8:if(o.prev=8,o.t0=o["catch"](4),409===o.t0.status){o.next=12;break}throw o.t0;case 12:o.next=0;break;case 14:case"end":return o.stop()}},V,this,[[4,8]])}),$=function(e){return function(t){return t.push(e)}},M=function(e){return function(t){var r=t.indexOf(e);return 0>r?t:0==r?t.rest():r+1==t.size?t.butLast():t.take(r).concat(t.skip(r+1))}},B=function(e){return function(t){return t.indexOf(e)<0?t.push(e):t}},P=S({type:A("Visit"),start:I,end:x(I),id:String,device:String("Desktop")}),z=S((n={},u(n,h.id,k),u(n,h.revision,x(O)),u(n,"type",A("Page")),u(n,"uri",j),u(n,"title",x(String)),u(n,"visits",E(P)),u(n,"tags",E(D)),u(n,"icon",x(j)),u(n,"image",q),n));z.frequency=function(e){var t=e.visits;return t.count()},z.from=function(e){var t,r=e.uri,n=e.title;return z((t={},u(t,h.id,"Page/"+r),u(t,"uri",r),u(t,"title",n),t))},z.beginVisit=function(e){var t=e.time,r=e.id,n=e.device;return function(e){return e.update("visits",$(P({start:t,id:r,device:n})))}},z.endVisit=function(e){var t=e.id,r=e.time;return function(e){var n=e.visits.findIndex(function(e){return e.id===t});return 0>n?e:e.setIn(["visits",n,"end"],r)}};var F=S((o={},u(o,h.id,k),u(o,h.revision,x(O)),u(o,"type",A("Quote")),u(o,"uri",j),u(o,"content",String),u(o,"tags",E(D)),o));F.construct=_(l.mark(function G(e){var t,r,n=e.uri,o=e.content;return l.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(o);case 2:return r=e.sent,e.abrupt("return",F((t={},u(t,h.id,"Quote/"+n+"/"+r),u(t,"uri",n),u(t,"content",o),t)));case 4:case"end":return e.stop()}},G,this)}));var U=S((i={},u(i,h.id,k),u(i,h._rev,x(O)),u(i,"type",A("Tag")),u(i,"name",D),u(i,"items",E(k)),i));U.add=function(e,t){return e.update("items",B(t[h.id]))},U.remove=function(e,t){return e.update("items",M(t[h.id]))},U.tag=function(e,t){return e.update("tags",B(t))},U.untag=function(e,t){return e.update("tags",M(t))};var K=S((s={},u(s,h.id,k("TopPages")),u(s,h.revision,x(O)),u(s,"type",A("TopPages")),u(s,"pages",E(z)),s));K.sample=function(e,t){return function(r){return r.update("pages",function(r){var n=r.findIndex(function(t){return t[h.id]===e[h.id]});return r.set(0>n?r.size:n,e).sortBy(z.frequency).take(t)})}};var J=S((a={},u(a,h.id,k("PopularSitesImported")),u(a,h.revision,x(O)),u(a,"value",Boolean(!1)),a)),W=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];f(this,e),this.onPageChange=this.onPageChange.bind(this),this.options=d(e.defaults(),t),this.db=new h(this.options),this.trackTopPages(),this.importPopularSites()}return c(e,null,[{key:"defaults",value:function(){return{name:"history",topPageLimit:6,address:null}}}]),c(e,[{key:"importPopularSites",value:function(){y.call(this,l.mark(function e(){var t,r,n,o;return l.wrap(function(e){for(var i=this;;)switch(e.prev=e.next){case 0:return e.next=2,C(this.db,J());case 2:if(t=e.sent,t.value){e.next=15;break}return e.next=6,fetch("../../src/alexa.json");case 6:return r=e.sent,e.next=9,r.json();case 9:return n=e.sent,o=n.map(function(e){return i.edit(z.from({uri:"http://"+e+"/",title:e}),b)}),e.next=13,p.all(o);case 13:return e.next=15,this.edit(t,function(e){return e.set("value",!0)});case 15:case"end":return e.stop()}},e,this)}))}},{key:"trackTopPages",value:function(){this.pagesChangeFeed=this.db.changes({since:"now",live:!0,filter:function(e){var t=e[h.id];return t.startsWith("Page/")},include_docs:!0}),this.pagesChangeFeed.on("change",this.onPageChange)}},{key:"edit",value:function(e,t){return m(e[h.id],N,this.db,e,t)}},{key:"clear",value:function(){return this.db.destroy()}},{key:"query",value:function(e){var t=e.type,r=e.docs;return this.db.allDocs({include_docs:r,startkey:t&&t+"/",endkey:t&&t+"/￿"})}},{key:"onPageChange",value:function(e){var t=e.doc,r=z(t);this.edit(K(),K.sample(r,this.options.topPageLimit)),this.options.address&&this.options.address.send(r)}}]),e}();r.History=W,r.Page=z,r.Tag=U,r.TopPages=K,r.Quote=F},{"../lang/functional":198,"../lang/task":199,"babel-runtime/core-js/object/assign":2,"babel-runtime/core-js/promise":5,"babel-runtime/helpers/class-call-check":8,"babel-runtime/helpers/create-class":9,"babel-runtime/helpers/define-property":10,"babel-runtime/regenerator":77,pouchdb:141,"typed-immutable":192}],197:[function(e,t,r){"use strict";var n=function(e){return!!(d.exec(e)||[])[0]},o=function(e){return new URL(e).origin},i=function(){return new URL("./",location)},s=function(e){return new URL(e).hostname},a=function(e){return s(e).replace(/^www\./,"")},u=function(e){return new URL(e).protocol},c=function(){return new URL("./manifest.webapp",i())},f=function(e){try{return"about:"==new URL(e).protocol}catch(t){return!1}},l=function(e){return e&&e.startsWith(new URL("./src/about/",i()))},d=/^(?:[a-z\u00a1-\uffff0-9-+]+)(?::|:\/\/)/i,p=function(e){var t=e.trim(),r=/^(\?)|(\?.+\s)/,o=/[\?\.\s\:]/,i=/^\w+\:\/*$/;if("localhost"==t)return!1;if(r.test(t)||!o.test(t)||i.test(t))return!0;n(e)||(t="http://"+t);try{return new URL(t),!1}catch(s){return!0}},h=function(e){return"https://duckduckgo.com/?q="+encodeURIComponent(e)},v=function(e){return i()+"src/about/"+e.replace("about:","")+"/index.html"},y=function(e){return p(e)?h(e):n(e)?e:"http://"+e},_=function(e){return f(e)?v(e):e};r.resolve=_,r.read=y,r.hasScheme=n,r.getOrigin=o,r.getBaseURI=i,r.getHostname=s,r.getDomainName=a,r.getProtocol=u,r.getManifestURL=c,r.isAboutURL=f,r.isPrivileged=l,r.isNotURL=p},{}],198:[function(e,t,r){"use strict";var n=e("babel-runtime/helpers/to-consumable-array")["default"],o=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(){for(var e=t.length,r=t[--e].apply(t,arguments);--e>=0;)r=t[e](r);return r}},i=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];return e.apply(void 0,r.concat(n))}},s=function g(e,t,r){return void 0===t&&(t=e.length),function(){return function(){for(var o=arguments.length,i=Array(o),s=0;o>s;s++)i[s]=arguments[s];var a=r?[].concat(n(r),i):i;return a.length>=t?e.apply(void 0,n(a)):g(e,t,a)}}()},a=function(e,t){return function(){for(var r=arguments.length,o=Array(r),i=0;r>i;i++)o[i]=arguments[i];return t.apply(void 0,n(o.slice(0,e)))}},u=function(e,t){return function(){return t[e].apply(t,arguments)}},c=function(e){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;r>o;o++)n[o-1]=arguments[o];return t[e].apply(t,n)}},f=function(e){return e},l=function(e){return function(){return e}},d=l(!0),p=l(!1),h=function(e){return function(){return!e.apply(void 0,arguments)}},v=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(){for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];return t.every(function(e){return e.apply(void 0,r)})}},y=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(){for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];return t.some(function(e){return e.apply(void 0,r)})}},_=function(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=null,i=null,s=null,a=0,u=r.leading,c=r.trailing,f=function(){a=u===!1?0:Date.now(),s=null,i=e.apply(void 0,n(o)),o=null};return function(){for(var r=arguments.length,l=Array(r),d=0;r>d;d++)l[d]=arguments[d];var p=Date.now();a||u!==!1||(a=p);var h=t-(p-a);return o=l,0>=h?(clearTimeout(s),s=null,a=p,i=e.apply(void 0,n(o)),o=null):s||c===!1||(s=setTimeout(f,h)),i}},m=function(e,t,r){var o=null,i=null,s=null,a=null,u=function c(){for(var i=arguments.length,u=Array(i),f=0;i>f;f++)u[f]=arguments[f];var l=Date.now()-s;t>l&&l>=0?o=setTimeout(c,t-l):(o=null,r||(a=e.apply(void 0,n(u)),o||(u=null)))};return function(){for(var c=arguments.length,f=Array(c),l=0;c>l;l++)f[l]=arguments[l];i=f,s=Date.now();var d=r&&!o;return o||(o=setTimeout(u,t)),d&&(a=e.apply(void 0,n(i)),i=null),a}};r.compose=o,r.partial=i,r.curry=s,r.arity=a,r.invokerFrom=u,r.invokerOf=c,r.identity=f,r.constant=l,r.True=d,r.False=p,r.not=h,r.and=v,r.or=y,r.throttle=_,r.debounce=m},{"babel-runtime/helpers/to-consumable-array":11}],199:[function(e,t,r){"use strict";var n=e("babel-runtime/core-js/promise")["default"],o=e("babel-runtime/regenerator")["default"],i=e("babel-runtime/core-js/object/create")["default"],s=function(e){var t=arguments.length<=1||void 0===arguments[1]?"next":arguments[1];return function(r){try{return e[t](r)}catch(n){return{error:n}}}},a=function(e){for(var t=this,r=arguments.length,o=Array(r>1?r-1:0),i=1;r>i;i++)o[i-1]=arguments[i];return new n(function(r,i){var a=e.call.apply(e,[t].concat(o)),u=s(a,"throw"),c=s(a,"next"),f=function l(e){var t=e.done,o=e.error,s=e.value;o?i(o):t?r(s):n.resolve(s).then(c,u).then(l)};f(c())})};r.spawn=a;var u=function(e){return function(){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return a.call.apply(a,[this,e].concat(r))}};r.async=u;var c=function f(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];var s=f.d[e];return f.d[e]=a(o.mark(function u(){return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s;case 3:return e.prev=3,e.abrupt("return",a.apply(void 0,[t].concat(n)));case 6:case"end":return e.stop()}},u,this,[[0,,3,6]])}))};c.d=i(null),r.schedule=c},{"babel-runtime/core-js/object/create":3,"babel-runtime/core-js/promise":5,"babel-runtime/regenerator":77}],200:[function(e,t,r){"use strict";var n=e("babel-runtime/regenerator")["default"],o=e("../common/history"),i=o.Page,s=o.History,a=e("../lang/task"),u=a.async,c=e("../common/url-helper"),f=function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?.3:arguments[2],n=arguments.length<=3||void 0===arguments[3]?.25:arguments[3],o=1-r-n,i=String(t),s=i.length,a=e.exec(i);return a?r+n*Math.sqrt(a[0].length/s)+o*(1-a.index/s):-1},l=function v(e){var t=arguments.length<=1||void 0===arguments[1]?"i":arguments[1];try{return RegExp(e,t)}catch(r){if(r instanceof SyntaxError)return RegExp(v.escape(e),t);throw r}};l.escape=function(e){return e.replace(/[\.\?\*\+\^\$\|\(\)\{\[\]\\]/g,"\\$&")};var d=function(e){return e.isTopHit},p=u(n.mark(function y(e,t){var r,o,i,s,a,u,p,h,v=t.id,_=t.input,m=t.limit;return n.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.query({docs:!0,type:"Page"});case 2:return r=t.sent,o=r.rows,i=_.split(/\s+/g),s=1===i.length?l(i[0]):null,a=l(i.join("[\\s\\S]+")+"|"+i.join("|")),u=o.map(function(e){var t=e.doc,r=c.getDomainName(t.uri),n=1-.7/(1+t.visits.length),o=f(a,t.title),i=f(a,t.uri),u=s?f(s,r):0;return t.frequencyScore=n,t.titleScore=o,t.domainScore=u,t.uriScore=i,t.domain=r,t.score=6*n/15+3*o/15+2*i/15+4*u/15,t.isTopHit=s&&r.startsWith(s.source),t}).filter(function(e){return e.score>0&&e.title}).sort(function(e,t){return e.score>t.score?-1:e.score<t.score?1:0}),p=u.findIndex(d),h=0>p?null:u.splice(p,1)[0],t.abrupt("return",{type:"PageResult",action:{id:v,topHit:h,matches:u.slice(0,m)}});case 11:case"end":return t.stop()}},y,this)})),h=new s({trackTopPages:!0});onmessage=function(e){var t=e.data,r=t.type,n=t.id,o=t.action;"LoadEnded"===r&&h.edit(i.from({uri:o.uri}),i.beginVisit({id:n,time:o.timeStamp})),"LocationChanged"===r&&h.edit(i.from({uri:o.uri}),i.endVisit({id:n,time:o.timeStamp})),"TitleChanged"===r&&h.edit(i.from({uri:o.uri}),function(e){return e.set("title",o.title)}),"ThumbnailChanged"===r&&h.edit(i.from({uri:o.uri}),function(e){return e.set("image",o.image)}),"IconChanged"===r&&h.edit(i.from({uri:o.uri}),function(e){return e.set("icon",o.icon.href)}),"PageQuery"===r&&p(h,o).then(postMessage)}},{"../common/history":196,"../common/url-helper":197,"../lang/task":199,"babel-runtime/regenerator":77}]},{},[200]);
//# sourceMappingURL=../service/history-worker.js.map